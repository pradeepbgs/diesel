import{b,G as T,r as u,u as D,f as M,c as g,j as e,s as z,a as P,g as C,t as B,N as U,F as G,h as H,i as I,L as A,k as O,m as J,n as R,o as W,p as q}from"./index-g6IK7Mpq.js";import{t as K}from"./subscribeToggle-X_gwL1Mm.js";const Q=async(c,o)=>{try{return await b.post(`/api/v1/comments/${o}`,{content:JSON.stringify(c)},{withCredentials:!0})}catch(t){console.log(t)}};function X(c){return T({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(c)}const _=c=>{const o=new Date(c),t=new Date;if(isNaN(o.getTime()))return"Unable to determine time elapsed.";const i=t.getTime()-o.getTime(),d=Math.floor(i/1e3),h=Math.floor(d/60),a=Math.floor(h/60),m=Math.floor(a/24);let x;return m>0?x=m+(m>1?" days":" day"):a>0?x=a+(a>1?" hours":" hour"):h>0?x=h+(h>1?" minutes":" minute"):x=d+(d>1?" seconds":" second"),x},Y=()=>{const[c,o]=u.useState(!1),[t,i]=u.useState(!1),[d,h]=u.useState(""),[a,m]=u.useState(!1),[x,k]=u.useState(null),L=D(),{videoId:f}=M(),n=g(s=>s.auth.user),{comments:l}=g(s=>s.video),j=async()=>{try{const s=await b.get(`/api/v1/comments/${f}`,{withCredentials:!0});if(s){const r=s.data.data;console.log(r),L(z(r))}}catch(s){console.error("Error fetching data:",s)}},v=async s=>{s.preventDefault(),await Q(d,f)&&(o(p=>!p),h(""))},N=async s=>{var r;((r=s==null?void 0:s.owner)==null?void 0:r._id)===(n==null?void 0:n._id)?await b.delete(`/api/v1/comments/c/${s==null?void 0:s._id}`,{withCredentials:!0})&&(o(w=>!w),i(!1)):alert("this is not your comment so you cant delete  it")},y=s=>{k(s),i(r=>!r)};return u.useEffect(()=>{j()},[c]),console.log(l),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border rounded-md mt-3",children:[e.jsxs("div",{className:" px-3 mt-5 ml-1 rounded-lg",children:[e.jsx("p",{className:"mt-3",children:Array.isArray(l)&&(l!=null&&l.length)?" Comments":"No Comments"}),e.jsxs("form",{className:"mt-3 mb-4 px-2 flex",children:[e.jsx("img",{className:"w-8 h-8 rounded-full mr-4",src:`${n==null?void 0:n.avatar}`,alt:"user"}),e.jsx("input",{onChange:s=>h(s.target.value),value:d,className:"w-[70%] border bg-transparent text-white py-1 px-5 mr-3",type:"text",name:"content",placeholder:"Add a Comment"}),e.jsx("button",{type:"submit",onClick:v,disabled:!n,className:"border px-4 py-1 ml-4 font-semibold hover:bg-gray-800",children:"Add"})]})]}),e.jsx("div",{className:" w-[100%]  justify-between ",children:Array.isArray(l)&&(l==null?void 0:l.length)>0&&(l==null?void 0:l.map((s,r)=>{var p,w,S,F,$;return e.jsxs("div",{className:"flex justify-between hover:bg-zinc-900 border border-l-0 border-r-0 border-b-0 py-3 px-2",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{className:"w-9 h-9 rounded-full",src:`${(p=s==null?void 0:s.owner)==null?void 0:p.avatar}`,alt:""}),e.jsxs("div",{className:"px-3",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("span",{className:"text-gray-300",children:[e.jsx("p",{className:"font-semibold",children:(w=s==null?void 0:s.owner)==null?void 0:w.fullname}),e.jsxs("p",{children:["@",(S=s==null?void 0:s.owner)==null?void 0:S.username]})]}),e.jsxs("p",{className:"ml-3 text-gray-300",children:["· ",_(s==null?void 0:s.createdAt)]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{value:a?d:s==null?void 0:s.content,disabled:!a,onChange:E=>h(E.target.value),className:"mt-2 bg-transparent "})})]})]}),e.jsxs("div",{className:"flex",children:[(n==null?void 0:n._id)===((F=s==null?void 0:s.owner)==null?void 0:F._id)&&e.jsx("div",{className:" h-fit w-fit mr-5 flex",children:t&&x===(s==null?void 0:s._id)&&!a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(!0),className:"bg-green-500 px-3",children:"edit"}),e.jsx("button",{className:"bg-red-500 px-3 ml-2",onClick:()=>N(s),children:"delete"})]})}),(n==null?void 0:n._id)===(($=s==null?void 0:s.owner)==null?void 0:$._id)&&e.jsx("div",{className:"cursor-pointer",onClick:()=>y(s==null?void 0:s._id),children:e.jsx(X,{})})]})]},r)}))})]})})},Z=({videoFile:c})=>e.jsx("video",{className:"rounded-xl h-[34vw] w-[100%]",controls:!0,children:e.jsx("source",{src:`${c}`,type:"video/mp4"})}),V=async c=>{try{return await b.post(`/api/v1/likes/toggle/v/${c}`,{},{withCredentials:!0})}catch(o){console.log(o)}},ae=()=>{var l,j,v,N,y;const[c,o]=u.useState(!1),t=D();P();const{videoId:i}=M(),d=g(s=>s.toggle.description),{Likes:h,video:a}=g(s=>s.video),{user:m}=g(s=>s.auth),x=(l=a==null?void 0:a.owner)==null?void 0:l._id,k=async()=>{m?await K(x,t):alert("Please login to like and subscribe")},L=async()=>{var s;if(m){const r=await V(i);((s=r==null?void 0:r.data)==null?void 0:s.message)==="liked video"?(t(C({...a,isLiked:!0})),t(R())):(t(C({...a,isLiked:!1})),t(W()))}else alert("Please login to like and subscribe")},f=async()=>{try{o(!0);const s=await b.get(`/api/v1/videos/${i}`,{withCredentials:!0});if(s){const r=s.data.data;console.log("Fetched video:",r),t(C(r)),t(q(r==null?void 0:r.likesCount))}}catch(s){console.error("Error fetching data:",s)}finally{o(!1)}};u.useEffect(()=>{console.log("videoId changed:",i),i&&(t(C(null)),f())},[i]),u.useEffect(()=>{t(B())},[t]);const n=_(a==null?void 0:a.createdAt);return e.jsxs("div",{className:"text-white h-screen flex justify-between",children:[e.jsxs("div",{className:"w-[67%] px-2 py-3",children:[e.jsx("div",{className:"px-2",children:c?e.jsx("p",{children:"Loading..."}):a&&e.jsx(Z,{videoFile:a==null?void 0:a.videoFile})}),a&&e.jsxs("div",{className:"border ml-1 px-4 py-2 mt-2 rounded-md bg-black bg-opacity-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"w-[90%]",children:[e.jsx("h1",{className:"text-[1.3rem] font-semibold",children:a==null?void 0:a.title}),e.jsxs("p",{children:[a==null?void 0:a.views," Views · ",n]})]}),e.jsxs("div",{className:"py-2 flex h-[30%]",children:[e.jsxs(U,{onClick:L,className:`px-4 py-2 border border-gray-400 flex items-center hover:bg-gray-900 ${a!=null&&a.isLiked?"text-blue-500":""}`,children:[e.jsx("p",{className:"mr-2",children:h}),e.jsx(G,{})]}),e.jsxs("button",{className:"px-4 py-2 border border-gray-400 ml-2 flex items-center hover:bg-gray-900",children:[e.jsx(H,{}),e.jsx("p",{className:"ml-2"})]}),e.jsxs("button",{className:"px-4 py-2 border border-gray-400 ml-2 flex items-center hover:bg-gray-900",children:[e.jsx(I,{}),"save"]})]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{to:`/channel/${(j=a==null?void 0:a.owner)==null?void 0:j.username}`,children:e.jsx("img",{className:"w-10 h-10 rounded-full",src:`${(v=a==null?void 0:a.owner)==null?void 0:v.avatar}`})}),e.jsxs("div",{className:"ml-3",children:[e.jsx(A,{to:`/channel/${(N=a==null?void 0:a.owner)==null?void 0:N.username}`,className:"font-semibold",children:(y=a==null?void 0:a.owner)==null?void 0:y.fullname}),e.jsxs("p",{className:"text-gray-300",children:[a==null?void 0:a.subscribersCount," subscribers"]})]})]}),e.jsxs("button",{onClick:k,className:"flex items-center bg-gray-100 hover:bg-gray-300 text-black px-2 rounded-full",children:[e.jsx("p",{className:"mr-3 font-semibold",children:a!=null&&a.isSubscribed?"subscribed":"subscribe"}),e.jsx(O,{})]})]}),e.jsxs("div",{className:`mt-4 ${d?"h-full":"h-[17vh]"} border border-b-0 border-l-0 border-r-0 py-2 px-3 overflow-hidden`,children:[e.jsx("button",{onClick:()=>{t(J())},className:"ml-2 border px-3",children:d?"Hide":"Show"}),e.jsx("p",{className:"h-[10]",children:a!=null&&a.description?a==null?void 0:a.description:"No description"})]})]}),e.jsx(Y,{})]}),e.jsx("div",{className:"w-[40%]"})]})};export{ae as default};
