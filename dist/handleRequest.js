var L1=Object.create;var{getPrototypeOf:F1,defineProperty:U,getOwnPropertyNames:h,getOwnPropertyDescriptor:O1}=Object,u=Object.prototype.hasOwnProperty;var D1=(f,z,g)=>{g=f!=null?L1(F1(f)):{};let Y=z||!f||!f.__esModule?U(g,"default",{value:f,enumerable:!0}):g;for(let Z of h(f))if(!u.call(Y,Z))U(Y,Z,{get:()=>f[Z],enumerable:!0});return Y},m=new WeakMap,S1=(f)=>{var z=m.get(f),g;if(z)return z;if(z=U({},"__esModule",{value:!0}),f&&typeof f==="object"||typeof f==="function")h(f).map((Y)=>!u.call(z,Y)&&U(z,Y,{get:()=>f[Y],enumerable:!(g=O1(f,Y))||g.enumerable}));return m.set(f,z),z},E=(f,z)=>()=>(z||f((z={exports:{}}).exports,z),z.exports);var E1=(f,z)=>{for(var g in z)U(f,g,{get:z[g],enumerable:!0,configurable:!0,set:(Y)=>z[g]=()=>Y})};var b1=(f,z)=>()=>(f&&(z=f(f=0)),z);var _1=((f)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(f,{get:(z,g)=>(typeof require!=="undefined"?require:z)[g]}):f)(function(f){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+f+'" is not supported')});var z1={};E1(z1,{sep:()=>e,resolve:()=>L,relative:()=>r,posix:()=>g1,parse:()=>t,normalize:()=>b,join:()=>n,isAbsolute:()=>i,format:()=>a,extname:()=>s,dirname:()=>o,delimiter:()=>f1,default:()=>q1,basename:()=>p,_makeLong:()=>l});function M(f){if(typeof f!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function d(f,z){var g="",Y=0,Z=-1,$=0,J;for(var V=0;V<=f.length;++V){if(V<f.length)J=f.charCodeAt(V);else if(J===47)break;else J=47;if(J===47){if(Z===V-1||$===1);else if(Z!==V-1&&$===2){if(g.length<2||Y!==2||g.charCodeAt(g.length-1)!==46||g.charCodeAt(g.length-2)!==46){if(g.length>2){var G=g.lastIndexOf("/");if(G!==g.length-1){if(G===-1)g="",Y=0;else g=g.slice(0,G),Y=g.length-1-g.lastIndexOf("/");Z=V,$=0;continue}}else if(g.length===2||g.length===1){g="",Y=0,Z=V,$=0;continue}}if(z){if(g.length>0)g+="/..";else g="..";Y=2}}else{if(g.length>0)g+="/"+f.slice(Z+1,V);else g=f.slice(Z+1,V);Y=V-Z-1}Z=V,$=0}else if(J===46&&$!==-1)++$;else $=-1}return g}function R1(f,z){var g=z.dir||z.root,Y=z.base||(z.name||"")+(z.ext||"");if(!g)return Y;if(g===z.root)return g+Y;return g+f+Y}function L(){var f="",z=!1,g;for(var Y=arguments.length-1;Y>=-1&&!z;Y--){var Z;if(Y>=0)Z=arguments[Y];else{if(g===void 0)g=process.cwd();Z=g}if(M(Z),Z.length===0)continue;f=Z+"/"+f,z=Z.charCodeAt(0)===47}if(f=d(f,!z),z)if(f.length>0)return"/"+f;else return"/";else if(f.length>0)return f;else return"."}function b(f){if(M(f),f.length===0)return".";var z=f.charCodeAt(0)===47,g=f.charCodeAt(f.length-1)===47;if(f=d(f,!z),f.length===0&&!z)f=".";if(f.length>0&&g)f+="/";if(z)return"/"+f;return f}function i(f){return M(f),f.length>0&&f.charCodeAt(0)===47}function n(){if(arguments.length===0)return".";var f;for(var z=0;z<arguments.length;++z){var g=arguments[z];if(M(g),g.length>0)if(f===void 0)f=g;else f+="/"+g}if(f===void 0)return".";return b(f)}function r(f,z){if(M(f),M(z),f===z)return"";if(f=L(f),z=L(z),f===z)return"";var g=1;for(;g<f.length;++g)if(f.charCodeAt(g)!==47)break;var Y=f.length,Z=Y-g,$=1;for(;$<z.length;++$)if(z.charCodeAt($)!==47)break;var J=z.length,V=J-$,G=Z<V?Z:V,W=-1,A=0;for(;A<=G;++A){if(A===G){if(V>G){if(z.charCodeAt($+A)===47)return z.slice($+A+1);else if(A===0)return z.slice($+A)}else if(Z>G){if(f.charCodeAt(g+A)===47)W=A;else if(A===0)W=0}break}var Q=f.charCodeAt(g+A),X=z.charCodeAt($+A);if(Q!==X)break;else if(Q===47)W=A}var j="";for(A=g+W+1;A<=Y;++A)if(A===Y||f.charCodeAt(A)===47)if(j.length===0)j+="..";else j+="/..";if(j.length>0)return j+z.slice($+W);else{if($+=W,z.charCodeAt($)===47)++$;return z.slice($)}}function l(f){return f}function o(f){if(M(f),f.length===0)return".";var z=f.charCodeAt(0),g=z===47,Y=-1,Z=!0;for(var $=f.length-1;$>=1;--$)if(z=f.charCodeAt($),z===47){if(!Z){Y=$;break}}else Z=!1;if(Y===-1)return g?"/":".";if(g&&Y===1)return"//";return f.slice(0,Y)}function p(f,z){if(z!==void 0&&typeof z!=="string")throw new TypeError('"ext" argument must be a string');M(f);var g=0,Y=-1,Z=!0,$;if(z!==void 0&&z.length>0&&z.length<=f.length){if(z.length===f.length&&z===f)return"";var J=z.length-1,V=-1;for($=f.length-1;$>=0;--$){var G=f.charCodeAt($);if(G===47){if(!Z){g=$+1;break}}else{if(V===-1)Z=!1,V=$+1;if(J>=0)if(G===z.charCodeAt(J)){if(--J===-1)Y=$}else J=-1,Y=V}}if(g===Y)Y=V;else if(Y===-1)Y=f.length;return f.slice(g,Y)}else{for($=f.length-1;$>=0;--$)if(f.charCodeAt($)===47){if(!Z){g=$+1;break}}else if(Y===-1)Z=!1,Y=$+1;if(Y===-1)return"";return f.slice(g,Y)}}function s(f){M(f);var z=-1,g=0,Y=-1,Z=!0,$=0;for(var J=f.length-1;J>=0;--J){var V=f.charCodeAt(J);if(V===47){if(!Z){g=J+1;break}continue}if(Y===-1)Z=!1,Y=J+1;if(V===46){if(z===-1)z=J;else if($!==1)$=1}else if(z!==-1)$=-1}if(z===-1||Y===-1||$===0||$===1&&z===Y-1&&z===g+1)return"";return f.slice(z,Y)}function a(f){if(f===null||typeof f!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof f);return R1("/",f)}function t(f){M(f);var z={root:"",dir:"",base:"",ext:"",name:""};if(f.length===0)return z;var g=f.charCodeAt(0),Y=g===47,Z;if(Y)z.root="/",Z=1;else Z=0;var $=-1,J=0,V=-1,G=!0,W=f.length-1,A=0;for(;W>=Z;--W){if(g=f.charCodeAt(W),g===47){if(!G){J=W+1;break}continue}if(V===-1)G=!1,V=W+1;if(g===46){if($===-1)$=W;else if(A!==1)A=1}else if($!==-1)A=-1}if($===-1||V===-1||A===0||A===1&&$===V-1&&$===J+1){if(V!==-1)if(J===0&&Y)z.base=z.name=f.slice(1,V);else z.base=z.name=f.slice(J,V)}else{if(J===0&&Y)z.name=f.slice(1,$),z.base=f.slice(1,V);else z.name=f.slice(J,$),z.base=f.slice(J,V);z.ext=f.slice($,V)}if(J>0)z.dir=f.slice(0,J-1);else if(Y)z.dir="/";return z}var e="/",f1=":",g1,q1;var Y1=b1(()=>{g1=((f)=>(f.posix=f,f))({resolve:L,normalize:b,isAbsolute:i,join:n,relative:r,_makeLong:l,dirname:o,basename:p,extname:s,format:a,parse:t,sep:e,delimiter:f1,win32:null,posix:null}),q1=g1});var A1=E((c1)=>{var T1=/[|\\{}()[\]^$+*?.]/g,P1=Object.prototype.hasOwnProperty,R=function(f,z){return P1.apply(f,[z])};c1.escapeRegExpChars=function(f){if(!f)return"";return String(f).replace(T1,"\\$&")};var I1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},k1=/[&<>'"]/g;function y1(f){return I1[f]||f}var x1=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;c1.escapeXML=function(f){return f==null?"":String(f).replace(k1,y1)};function Z1(){return Function.prototype.toString.call(this)+`;
`+x1}try{if(typeof Object.defineProperty==="function")Object.defineProperty(c1.escapeXML,"toString",{value:Z1});else c1.escapeXML.toString=Z1}catch(f){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}c1.shallowCopy=function(f,z){if(z=z||{},f!==null&&f!==void 0)for(var g in z){if(!R(z,g))continue;if(g==="__proto__"||g==="constructor")continue;f[g]=z[g]}return f};c1.shallowCopyFromList=function(f,z,g){if(g=g||[],z=z||{},f!==null&&f!==void 0)for(var Y=0;Y<g.length;Y++){var Z=g[Y];if(typeof z[Z]!="undefined"){if(!R(z,Z))continue;if(Z==="__proto__"||Z==="constructor")continue;f[Z]=z[Z]}}return f};c1.cache={_data:{},set:function(f,z){this._data[f]=z},get:function(f){return this._data[f]},remove:function(f){delete this._data[f]},reset:function(){this._data={}}};c1.hyphenToCamel=function(f){return f.replace(/-[a-z]/g,function(z){return z[1].toUpperCase()})};c1.createNullProtoObjWherePossible=function(){if(typeof Object.create=="function")return function(){return Object.create(null)};if(!({__proto__:null}instanceof Object))return function(){return{__proto__:null}};return function(){return{}}}();c1.hasOwnOnlyObject=function(f){var z=c1.createNullProtoObjWherePossible();for(var g in f)if(R(f,g))z[g]=f[g];return z}});var J1=E((O0,r1)=>{r1.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.10",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^4.0.2","lru-cache":"^4.0.1",mocha:"^10.2.0","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"npx jake test"}}});var N1=E((w1)=>{var P=(()=>({})),K=(Y1(),S1(z1)),B=A1(),V1=!1,l1=J1().version,o1="<",p1=">",s1="%",B1="locals",a1="ejs",t1="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",C1=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],e1=C1.concat("cache"),X1=/^\uFEFF/,q=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;w1.cache=B.cache;w1.fileLoader=P.readFileSync;w1.localsName=B1;w1.promiseImpl=new Function("return this;")().Promise;w1.resolveInclude=function(f,z,g){var{dirname:Y,extname:Z,resolve:$}=K,J=$(g?z:Y(z),f),V=Z(f);if(!V)J+=".ejs";return J};function G1(f,z){var g;if(z.some(function(Y){return g=w1.resolveInclude(f,Y,!0),P.existsSync(g)}))return g}function f0(f,z){var g,Y,Z=z.views,$=/^[A-Za-z]+:\\|^\//.exec(f);if($&&$.length)if(f=f.replace(/^\/*/,""),Array.isArray(z.root))g=G1(f,z.root);else g=w1.resolveInclude(f,z.root||"/",!0);else{if(z.filename){if(Y=w1.resolveInclude(f,z.filename),P.existsSync(Y))g=Y}if(!g&&Array.isArray(Z))g=G1(f,Z);if(!g&&typeof z.includer!=="function")throw new Error('Could not find the include file "'+z.escapeFunction(f)+'"')}return g}function N(f,z){var g,Y=f.filename,Z=arguments.length>1;if(f.cache){if(!Y)throw new Error("cache option requires a filename");if(g=w1.cache.get(Y),g)return g;if(!Z)z=Q1(Y).toString().replace(X1,"")}else if(!Z){if(!Y)throw new Error("Internal EJS error: no file name or template provided");z=Q1(Y).toString().replace(X1,"")}if(g=w1.compile(z,f),f.cache)w1.cache.set(Y,g);return g}function g0(f,z,g){var Y;if(!g)if(typeof w1.promiseImpl=="function")return new w1.promiseImpl(function(Z,$){try{Y=N(f)(z),Z(Y)}catch(J){$(J)}});else throw new Error("Please provide a callback function");else{try{Y=N(f)(z)}catch(Z){return g(Z)}g(null,Y)}}function Q1(f){return w1.fileLoader(f)}function z0(f,z){var g=B.shallowCopy(B.createNullProtoObjWherePossible(),z);if(g.filename=f0(f,g),typeof z.includer==="function"){var Y=z.includer(f,g.filename);if(Y){if(Y.filename)g.filename=Y.filename;if(Y.template)return N(g,Y.template)}}return N(g)}function W1(f,z,g,Y,Z){var $=z.split(`
`),J=Math.max(Y-3,0),V=Math.min($.length,Y+3),G=Z(g),W=$.slice(J,V).map(function(A,Q){var X=Q+J+1;return(X==Y?" >> ":"    ")+X+"| "+A}).join(`
`);throw f.path=G,f.message=(G||"ejs")+":"+Y+`
`+W+`

`+f.message,f}function j1(f){return f.replace(/;(\s*$)/,"$1")}w1.compile=function f(z,g){var Y;if(g&&g.scope){if(!V1)console.warn("`scope` option is deprecated and will be removed in EJS 3"),V1=!0;if(!g.context)g.context=g.scope;delete g.scope}return Y=new C(z,g),Y.compile()};w1.render=function(f,z,g){var Y=z||B.createNullProtoObjWherePossible(),Z=g||B.createNullProtoObjWherePossible();if(arguments.length==2)B.shallowCopyFromList(Z,Y,C1);return N(Z,f)(Y)};w1.renderFile=function(){var f=Array.prototype.slice.call(arguments),z=f.shift(),g,Y={filename:z},Z,$;if(typeof arguments[arguments.length-1]=="function")g=f.pop();if(f.length){if(Z=f.shift(),f.length)B.shallowCopy(Y,f.pop());else{if(Z.settings){if(Z.settings.views)Y.views=Z.settings.views;if(Z.settings["view cache"])Y.cache=!0;if($=Z.settings["view options"],$)B.shallowCopy(Y,$)}B.shallowCopyFromList(Y,Z,e1)}Y.filename=z}else Z=B.createNullProtoObjWherePossible();return g0(Y,Z,g)};w1.Template=C;w1.clearCache=function(){w1.cache.reset()};function C(f,z){var g=B.hasOwnOnlyObject(z),Y=B.createNullProtoObjWherePossible();if(this.templateText=f,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",Y.client=g.client||!1,Y.escapeFunction=g.escape||g.escapeFunction||B.escapeXML,Y.compileDebug=g.compileDebug!==!1,Y.debug=!!g.debug,Y.filename=g.filename,Y.openDelimiter=g.openDelimiter||w1.openDelimiter||o1,Y.closeDelimiter=g.closeDelimiter||w1.closeDelimiter||p1,Y.delimiter=g.delimiter||w1.delimiter||s1,Y.strict=g.strict||!1,Y.context=g.context,Y.cache=g.cache||!1,Y.rmWhitespace=g.rmWhitespace,Y.root=g.root,Y.includer=g.includer,Y.outputFunctionName=g.outputFunctionName,Y.localsName=g.localsName||w1.localsName||B1,Y.views=g.views,Y.async=g.async,Y.destructuredLocals=g.destructuredLocals,Y.legacyInclude=typeof g.legacyInclude!="undefined"?!!g.legacyInclude:!0,Y.strict)Y._with=!1;else Y._with=typeof g._with!="undefined"?g._with:!0;this.opts=Y,this.regex=this.createRegex()}C.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};C.prototype={createRegex:function(){var f=t1,z=B.escapeRegExpChars(this.opts.delimiter),g=B.escapeRegExpChars(this.opts.openDelimiter),Y=B.escapeRegExpChars(this.opts.closeDelimiter);return f=f.replace(/%/g,z).replace(/</g,g).replace(/>/g,Y),new RegExp(f)},compile:function(){var f,z,g=this.opts,Y="",Z="",$=g.escapeFunction,J,V=g.filename?JSON.stringify(g.filename):"undefined";if(!this.source){if(this.generateSource(),Y+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,g.outputFunctionName){if(!q.test(g.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");Y+="  var "+g.outputFunctionName+` = __append;
`}if(g.localsName&&!q.test(g.localsName))throw new Error("localsName is not a valid JS identifier.");if(g.destructuredLocals&&g.destructuredLocals.length){var G="  var __locals = ("+g.localsName+` || {}),
`;for(var W=0;W<g.destructuredLocals.length;W++){var A=g.destructuredLocals[W];if(!q.test(A))throw new Error("destructuredLocals["+W+"] is not a valid JS identifier.");if(W>0)G+=`,
  `;G+=A+" = __locals."+A}Y+=G+`;
`}if(g._with!==!1)Y+="  with ("+g.localsName+` || {}) {
`,Z+=`  }
`;Z+=`  return __output;
`,this.source=Y+this.source+Z}if(g.compileDebug)f=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+V+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`;else f=this.source;if(g.client){if(f="escapeFn = escapeFn || "+$.toString()+`;
`+f,g.compileDebug)f="rethrow = rethrow || "+W1.toString()+`;
`+f}if(g.strict)f=`"use strict";
`+f;if(g.debug)console.log(f);if(g.compileDebug&&g.filename)f=f+`
//# sourceURL=`+V+`
`;try{if(g.async)try{J=new Function("return (async function(){}).constructor;")()}catch(w){if(w instanceof SyntaxError)throw new Error("This environment does not support async/await");else throw w}else J=Function;z=new J(g.localsName+", escapeFn, include, rethrow",f)}catch(w){if(w instanceof SyntaxError){if(g.filename)w.message+=" in "+g.filename;if(w.message+=` while compiling ejs

`,w.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,w.message+="https://github.com/RyanZim/EJS-Lint",!g.async)w.message+=`
`,w.message+="Or, if you meant to create an async function, pass `async: true` as an option."}throw w}var Q=g.client?z:function w(H){var D=function(v1,c){var S=B.shallowCopy(B.createNullProtoObjWherePossible(),H);if(c)S=B.shallowCopy(S,c);return z0(v1,g)(S)};return z.apply(g.context,[H||B.createNullProtoObjWherePossible(),$,D,W1])};if(g.filename&&typeof Object.defineProperty==="function"){var X=g.filename,j=K.basename(X,K.extname(X));try{Object.defineProperty(Q,"name",{value:j,writable:!1,enumerable:!1,configurable:!0})}catch(w){}}return Q},generateSource:function(){var f=this.opts;if(f.rmWhitespace)this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"");this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var z=this,g=this.parseTemplateText(),Y=this.opts.delimiter,Z=this.opts.openDelimiter,$=this.opts.closeDelimiter;if(g&&g.length)g.forEach(function(J,V){var G;if(J.indexOf(Z+Y)===0&&J.indexOf(Z+Y+Y)!==0){if(G=g[V+2],!(G==Y+$||G=="-"+Y+$||G=="_"+Y+$))throw new Error('Could not find matching close tag for "'+J+'".')}z.scanLine(J)})},parseTemplateText:function(){var f=this.templateText,z=this.regex,g=z.exec(f),Y=[],Z;while(g){if(Z=g.index,Z!==0)Y.push(f.substring(0,Z)),f=f.slice(Z);Y.push(g[0]),f=f.slice(g[0].length),g=z.exec(f)}if(f)Y.push(f);return Y},_addOutput:function(f){if(this.truncate)f=f.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1;if(!f)return f;f=f.replace(/\\/g,"\\\\"),f=f.replace(/\n/g,"\\n"),f=f.replace(/\r/g,"\\r"),f=f.replace(/"/g,"\\\""),this.source+='    ; __append("'+f+`")
`},scanLine:function(f){var z=this,g=this.opts.delimiter,Y=this.opts.openDelimiter,Z=this.opts.closeDelimiter,$=0;switch($=f.split(`
`).length-1,f){case Y+g:case Y+g+"_":this.mode=C.modes.EVAL;break;case Y+g+"=":this.mode=C.modes.ESCAPED;break;case Y+g+"-":this.mode=C.modes.RAW;break;case Y+g+"#":this.mode=C.modes.COMMENT;break;case Y+g+g:this.mode=C.modes.LITERAL,this.source+='    ; __append("'+f.replace(Y+g+g,Y+g)+`")
`;break;case g+g+Z:this.mode=C.modes.LITERAL,this.source+='    ; __append("'+f.replace(g+g+Z,g+Z)+`")
`;break;case g+Z:case"-"+g+Z:case"_"+g+Z:if(this.mode==C.modes.LITERAL)this._addOutput(f);this.mode=null,this.truncate=f.indexOf("-")===0||f.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case C.modes.EVAL:case C.modes.ESCAPED:case C.modes.RAW:if(f.lastIndexOf("//")>f.lastIndexOf(`
`))f+=`
`}switch(this.mode){case C.modes.EVAL:this.source+="    ; "+f+`
`;break;case C.modes.ESCAPED:this.source+="    ; __append(escapeFn("+j1(f)+`))
`;break;case C.modes.RAW:this.source+="    ; __append("+j1(f)+`)
`;break;case C.modes.COMMENT:break;case C.modes.LITERAL:this._addOutput(f);break}}else this._addOutput(f)}if(z.opts.compileDebug&&$)this.currentLine+=$,this.source+="    ; __line = "+this.currentLine+`
`}};w1.escapeXML=B.escapeXML;w1.__express=w1.renderFile;w1.VERSION=l1;w1.name=a1;if(typeof window!="undefined")window.ejs=w1});function v(f){switch(f.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var I=null;async function Q0(){if(!I){let f=await Promise.resolve().then(() => D1(N1(),1));I=f.default||f}return I}function k(f,z,g,Y){let Z=null,$=null,J=null,V=null,G={},W=null;return{req:f,server:z,pathname:g,status:200,headers:new Headers,setHeader(A,Q){return this.headers.set(A,Q),this},removeHeader(A){return this.headers.delete(A),this},set(A,Q){return G[A]=Q,this},get(A){return G[A]},get ip(){return this.server.requestIP(f)?.address??null},get url(){if(!W)W=new URL(f.url);return W},get query(){if(!Z){if(!this.url.search)return{};Z=Object.fromEntries(this.url.searchParams)}return Z},get params(){if(!$&&Y)try{$=j0(Y,g)}catch(A){let Q=A instanceof Error?A.message:String(A);throw new Error(`Failed to extract route parameters: ${Q}`)}return $??{}},get body(){if(f.method==="GET")return Promise.resolve({});if(!V)V=(async()=>{try{let A=await B0(f);if(A.error)throw new Error(A.error);return Object.keys(A).length===0?null:A}catch(A){throw new Error("Invalid request body format")}})();return V},text(A,Q=200){return new Response(A,{status:Q,headers:this.headers})},send(A,Q=200){let X;if(A instanceof Uint8Array)X="Uint8Array";else if(A instanceof ArrayBuffer)X="ArrayBuffer";else X=typeof A;let j=X==="object"&&A!==null?JSON.stringify(A):A;return new Response(j,{status:Q,headers:this.headers})},json(A,Q=200){return Response.json(A,{status:Q,headers:this.headers})},file(A,Q,X=200){let j=Bun.file(A);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",Q??v(A));return new Response(j,{status:X,headers:this.headers})},async ejs(A,Q={},X=200){let j=await Q0();try{let w=await Bun.file(A).text(),H=j.render(w,Q),D=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(H,{status:X,headers:D})}catch(w){return console.error("EJS Rendering Error:",w),new Response("Error rendering template",{status:500})}},redirect(A,Q=302){return this.headers.set("Location",A),new Response(null,{status:Q,headers:this.headers})},stream(A){let Q=new Headers(this.headers),X=new ReadableStream({async start(j){await A(j),j.close()}});return new Response(X,{headers:Q})},yieldStream(A){return new Response("not working stream yet.")},setCookie(A,Q,X={}){let j=`${encodeURIComponent(A)}=${encodeURIComponent(Q)}`;if(X.maxAge)j+=`; Max-Age=${X.maxAge}`;if(X.expires)j+=`; Expires=${X.expires.toUTCString()}`;if(X.path)j+=`; Path=${X.path}`;if(X.domain)j+=`; Domain=${X.domain}`;if(X.secure)j+="; Secure";if(X.httpOnly)j+="; HttpOnly";if(X.sameSite)j+=`; SameSite=${X.sameSite}`;return this.headers.append("Set-Cookie",j),this},get cookies(){if(!J){let A=this.req.headers.get("cookie");J=A?W0(A):{}}return J}}}function W0(f){return Object.fromEntries(f.split(";").map((z)=>{let[g,...Y]=z.trim().split("=");return[g,decodeURIComponent(Y.join("="))]}))}function j0(f,z){let g={},Y=f.split("/"),[Z]=z.split("?"),$=Z.split("/");if(Y.length!==$.length)return null;for(let J=0;J<Y.length;J++){let V=Y[J];if(V.charCodeAt(0)===58)g[V.slice(1)]=$[J]}return g}async function B0(f){let z=f.headers.get("Content-Type")||"";if(!z)return{};if(f.headers.get("Content-Length")==="0"||!f.body)return{};if(z.startsWith("application/json"))return await f.json();if(z.startsWith("application/x-www-form-urlencoded")){let Y=await f.text();return Object.fromEntries(new URLSearchParams(Y))}if(z.startsWith("multipart/form-data")){let Y=await f.formData(),Z={};for(let[$,J]of Y.entries())Z[$]=J;return Z}return{error:"Unknown request body type"}}var C0=(f,z)=>{try{return z(f)}catch{return f.replace(/(?:%[0-9A-Fa-f]{2})+/g,(g)=>{try{return z(g)}catch{return g}})}},y=(f)=>C0(f,decodeURI),q0=(f)=>{let z=f.indexOf("/",f.indexOf(":")+4),g=z;for(;g<f.length;g++){let Y=f.charCodeAt(g);if(Y===37){let Z=f.indexOf("?",g),$=f.slice(z,Z===-1?void 0:Z);return y($.includes("%25")?$.replace(/%25/g,"%2525"):$)}else if(Y===63)break}return f.slice(z,g)};async function w0(f,z,g){let Y,Z=f.url.indexOf("/",f.url.indexOf(":")+4),$=Z;for(;$<f.url.length;$++){let A=f.url.charCodeAt($);if(A===37){let Q=f.url.indexOf("?",$),X=f.url.slice(Z,Q===-1?void 0:Q);Y=y(X.includes("%25")?X.replace(/%25/g,"%2525"):X);break}else if(A===63)break}if(!Y)Y=f.url.slice(Z,$);let J=g.trie.search(Y,f.method),V=k(f,z,Y,J?.path);if(g.hasOnReqHook)await x("onRequest",g.hooks.onRequest,[f,Y,z]);if(g.hasMiddleware){let A=await M0(g,Y,V);if(A)return A}if(g.hasFilterEnabled){let A=await U0(g,Y,V);if(A)return A}if(!J)return await N0(g,V,Y);if(g.hasPreHandlerHook){let A=await x("preHandler",g.hooks.preHandler,[V]);if(A)return A}let G=J.handler(V),W=G instanceof Promise?await G:G;if(g.hasOnSendHook){let A=await x("onSend",g.hooks.onSend,[V,W]);if(A)return A}if(W instanceof Response)return W;return H1(500,"No response returned from handler.")}async function x(f,z,g){if(!z?.length)return;for(let Y=0;Y<z.length;Y++){let Z=z[Y](...g),$=Z instanceof Promise?await Z:Z;if($&&f!=="onRequest")return $}}async function M0(f,z,g){let Y=f.globalMiddlewares;if(Y.length)for(let $ of Y){let J=await $(g);if(J)return J}let Z=f.middlewares.get(z);if(Z&&Z.length)for(let $ of Z){let J=await $(g);if(J)return J}return null}async function y0(f,z,g){for(let Y of f){let Z=await Y(z,g);if(Z)return Z}}async function U0(f,z,g){let Y=await K0(f,z,g),Z=Y instanceof Promise?await Y:Y;if(Z)return Z}async function K0(f,z,g){if(z.endsWith("/"))z=z.slice(0,-1);if(!f.filters.has(z))if(f.filterFunction.length)for(let Y of f.filterFunction){let Z=await Y(g);if(Z)return Z}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function x0(f,z,g,Y){if(!f.filters.has(z))if(f.filterFunction.length)for(let Z of f.filterFunction){let $=await Z(g,Y);if($)return $}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function N0(f,z,g){if(f.staticPath){let Z=await H0(f,g,z);if(Z)return Z;let $=f.trie.search("*",z.req.method);if($?.handler)return await $.handler(z)}return f.routeNotFoundFunc(z)||H1(404,`Route not found for ${g}`)}function H1(f,z){return new Response(JSON.stringify({error:z}),{status:f,headers:{"Content-Type":"application/json"}})}async function H0(f,z,g){if(!f.staticPath)return null;let Y=`${f.staticPath}${z}`;if(await Bun.file(Y).exists()){let $=v(Y);return g.file(Y,$,200)}return null}export{M0 as runMiddlewares,x as runHooks,U0 as runFilter,H0 as handleStaticFiles,N0 as handleRouteNotFound,K0 as handleFilterRequest,x0 as handleBunFilterRequest,H1 as generateErrorResponse,y0 as executeBunMiddlewares,w0 as default};
