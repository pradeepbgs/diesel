var bf=Object.create;var{getPrototypeOf:qf,defineProperty:M,getOwnPropertyNames:m,getOwnPropertyDescriptor:Tf}=Object,i=Object.prototype.hasOwnProperty;var _f=(f,w,g)=>{g=f!=null?bf(qf(f)):{};let A=w||!f||!f.__esModule?M(g,"default",{value:f,enumerable:!0}):g;for(let $ of m(f))if(!i.call(A,$))M(A,$,{get:()=>f[$],enumerable:!0});return A},u=new WeakMap,Pf=(f)=>{var w=u.get(f),g;if(w)return w;if(w=M({},"__esModule",{value:!0}),f&&typeof f==="object"||typeof f==="function")m(f).map((A)=>!i.call(w,A)&&M(w,A,{get:()=>f[A],enumerable:!(g=Tf(f,A))||g.enumerable}));return u.set(f,w),w},S=(f,w)=>()=>(w||f((w={exports:{}}).exports,w),w.exports);var If=(f,w)=>{for(var g in w)M(f,g,{get:w[g],enumerable:!0,configurable:!0,set:(A)=>w[g]=()=>A})};var cf=(f,w)=>()=>(f&&(w=f(f=0)),w);var xf=((f)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(f,{get:(w,g)=>(typeof require!=="undefined"?require:w)[g]}):f)(function(f){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+f+'" is not supported')});var Af={};If(Af,{sep:()=>ff,resolve:()=>H,relative:()=>l,posix:()=>wf,parse:()=>e,normalize:()=>b,join:()=>d,isAbsolute:()=>r,format:()=>t,extname:()=>a,dirname:()=>s,delimiter:()=>gf,default:()=>kf,basename:()=>p,_makeLong:()=>o});function j(f){if(typeof f!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function n(f,w){var g="",A=0,$=-1,z=0,Y;for(var Z=0;Z<=f.length;++Z){if(Z<f.length)Y=f.charCodeAt(Z);else if(Y===47)break;else Y=47;if(Y===47){if($===Z-1||z===1);else if($!==Z-1&&z===2){if(g.length<2||A!==2||g.charCodeAt(g.length-1)!==46||g.charCodeAt(g.length-2)!==46){if(g.length>2){var C=g.lastIndexOf("/");if(C!==g.length-1){if(C===-1)g="",A=0;else g=g.slice(0,C),A=g.length-1-g.lastIndexOf("/");$=Z,z=0;continue}}else if(g.length===2||g.length===1){g="",A=0,$=Z,z=0;continue}}if(w){if(g.length>0)g+="/..";else g="..";A=2}}else{if(g.length>0)g+="/"+f.slice($+1,Z);else g=f.slice($+1,Z);A=Z-$-1}$=Z,z=0}else if(Y===46&&z!==-1)++z;else z=-1}return g}function yf(f,w){var g=w.dir||w.root,A=w.base||(w.name||"")+(w.ext||"");if(!g)return A;if(g===w.root)return g+A;return g+f+A}function H(){var f="",w=!1,g;for(var A=arguments.length-1;A>=-1&&!w;A--){var $;if(A>=0)$=arguments[A];else{if(g===void 0)g=process.cwd();$=g}if(j($),$.length===0)continue;f=$+"/"+f,w=$.charCodeAt(0)===47}if(f=n(f,!w),w)if(f.length>0)return"/"+f;else return"/";else if(f.length>0)return f;else return"."}function b(f){if(j(f),f.length===0)return".";var w=f.charCodeAt(0)===47,g=f.charCodeAt(f.length-1)===47;if(f=n(f,!w),f.length===0&&!w)f=".";if(f.length>0&&g)f+="/";if(w)return"/"+f;return f}function r(f){return j(f),f.length>0&&f.charCodeAt(0)===47}function d(){if(arguments.length===0)return".";var f;for(var w=0;w<arguments.length;++w){var g=arguments[w];if(j(g),g.length>0)if(f===void 0)f=g;else f+="/"+g}if(f===void 0)return".";return b(f)}function l(f,w){if(j(f),j(w),f===w)return"";if(f=H(f),w=H(w),f===w)return"";var g=1;for(;g<f.length;++g)if(f.charCodeAt(g)!==47)break;var A=f.length,$=A-g,z=1;for(;z<w.length;++z)if(w.charCodeAt(z)!==47)break;var Y=w.length,Z=Y-z,C=$<Z?$:Z,X=-1,J=0;for(;J<=C;++J){if(J===C){if(Z>C){if(w.charCodeAt(z+J)===47)return w.slice(z+J+1);else if(J===0)return w.slice(z+J)}else if($>C){if(f.charCodeAt(g+J)===47)X=J;else if(J===0)X=0}break}var W=f.charCodeAt(g+J),V=w.charCodeAt(z+J);if(W!==V)break;else if(W===47)X=J}var F="";for(J=g+X+1;J<=A;++J)if(J===A||f.charCodeAt(J)===47)if(F.length===0)F+="..";else F+="/..";if(F.length>0)return F+w.slice(z+X);else{if(z+=X,w.charCodeAt(z)===47)++z;return w.slice(z)}}function o(f){return f}function s(f){if(j(f),f.length===0)return".";var w=f.charCodeAt(0),g=w===47,A=-1,$=!0;for(var z=f.length-1;z>=1;--z)if(w=f.charCodeAt(z),w===47){if(!$){A=z;break}}else $=!1;if(A===-1)return g?"/":".";if(g&&A===1)return"//";return f.slice(0,A)}function p(f,w){if(w!==void 0&&typeof w!=="string")throw new TypeError('"ext" argument must be a string');j(f);var g=0,A=-1,$=!0,z;if(w!==void 0&&w.length>0&&w.length<=f.length){if(w.length===f.length&&w===f)return"";var Y=w.length-1,Z=-1;for(z=f.length-1;z>=0;--z){var C=f.charCodeAt(z);if(C===47){if(!$){g=z+1;break}}else{if(Z===-1)$=!1,Z=z+1;if(Y>=0)if(C===w.charCodeAt(Y)){if(--Y===-1)A=z}else Y=-1,A=Z}}if(g===A)A=Z;else if(A===-1)A=f.length;return f.slice(g,A)}else{for(z=f.length-1;z>=0;--z)if(f.charCodeAt(z)===47){if(!$){g=z+1;break}}else if(A===-1)$=!1,A=z+1;if(A===-1)return"";return f.slice(g,A)}}function a(f){j(f);var w=-1,g=0,A=-1,$=!0,z=0;for(var Y=f.length-1;Y>=0;--Y){var Z=f.charCodeAt(Y);if(Z===47){if(!$){g=Y+1;break}continue}if(A===-1)$=!1,A=Y+1;if(Z===46){if(w===-1)w=Y;else if(z!==1)z=1}else if(w!==-1)z=-1}if(w===-1||A===-1||z===0||z===1&&w===A-1&&w===g+1)return"";return f.slice(w,A)}function t(f){if(f===null||typeof f!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof f);return yf("/",f)}function e(f){j(f);var w={root:"",dir:"",base:"",ext:"",name:""};if(f.length===0)return w;var g=f.charCodeAt(0),A=g===47,$;if(A)w.root="/",$=1;else $=0;var z=-1,Y=0,Z=-1,C=!0,X=f.length-1,J=0;for(;X>=$;--X){if(g=f.charCodeAt(X),g===47){if(!C){Y=X+1;break}continue}if(Z===-1)C=!1,Z=X+1;if(g===46){if(z===-1)z=X;else if(J!==1)J=1}else if(z!==-1)J=-1}if(z===-1||Z===-1||J===0||J===1&&z===Z-1&&z===Y+1){if(Z!==-1)if(Y===0&&A)w.base=w.name=f.slice(1,Z);else w.base=w.name=f.slice(Y,Z)}else{if(Y===0&&A)w.name=f.slice(1,z),w.base=f.slice(1,Z);else w.name=f.slice(Y,z),w.base=f.slice(Y,Z);w.ext=f.slice(z,Z)}if(Y>0)w.dir=f.slice(0,Y-1);else if(A)w.dir="/";return w}var ff="/",gf=":",wf,kf;var $f=cf(()=>{wf=((f)=>(f.posix=f,f))({resolve:H,normalize:b,isAbsolute:r,join:d,relative:l,_makeLong:o,dirname:s,basename:p,extname:a,format:t,parse:e,sep:ff,delimiter:gf,win32:null,posix:null}),kf=wf});var Yf=S((lf)=>{var hf=/[|\\{}()[\]^$+*?.]/g,uf=Object.prototype.hasOwnProperty,T=function(f,w){return uf.apply(f,[w])};lf.escapeRegExpChars=function(f){if(!f)return"";return String(f).replace(hf,"\\$&")};var mf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},nf=/[&<>'"]/g;function rf(f){return mf[f]||f}var df=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;lf.escapeXML=function(f){return f==null?"":String(f).replace(nf,rf)};function zf(){return Function.prototype.toString.call(this)+`;
`+df}try{if(typeof Object.defineProperty==="function")Object.defineProperty(lf.escapeXML,"toString",{value:zf});else lf.escapeXML.toString=zf}catch(f){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}lf.shallowCopy=function(f,w){if(w=w||{},f!==null&&f!==void 0)for(var g in w){if(!T(w,g))continue;if(g==="__proto__"||g==="constructor")continue;f[g]=w[g]}return f};lf.shallowCopyFromList=function(f,w,g){if(g=g||[],w=w||{},f!==null&&f!==void 0)for(var A=0;A<g.length;A++){var $=g[A];if(typeof w[$]!="undefined"){if(!T(w,$))continue;if($==="__proto__"||$==="constructor")continue;f[$]=w[$]}}return f};lf.cache={_data:{},set:function(f,w){this._data[f]=w},get:function(f){return this._data[f]},remove:function(f){delete this._data[f]},reset:function(){this._data={}}};lf.hyphenToCamel=function(f){return f.replace(/-[a-z]/g,function(w){return w[1].toUpperCase()})};lf.createNullProtoObjWherePossible=function(){if(typeof Object.create=="function")return function(){return Object.create(null)};if(!({__proto__:null}instanceof Object))return function(){return{__proto__:null}};return function(){return{}}}();lf.hasOwnOnlyObject=function(f){var w=lf.createNullProtoObjWherePossible();for(var g in f)if(T(f,g))w[g]=f[g];return w}});var Zf=S((O1,f1)=>{f1.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.10",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^4.0.2","lru-cache":"^4.0.1",mocha:"^10.2.0","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"npx jake test"}}});var Uf=S((jf)=>{var I=(()=>({})),N=($f(),Pf(Af)),G=Yf(),Vf=!1,g1=Zf().version,w1="<",A1=">",$1="%",Qf="locals",z1="ejs",J1="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",Bf=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],Y1=Bf.concat("cache"),Cf=/^\uFEFF/,_=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;jf.cache=G.cache;jf.fileLoader=I.readFileSync;jf.localsName=Qf;jf.promiseImpl=new Function("return this;")().Promise;jf.resolveInclude=function(f,w,g){var{dirname:A,extname:$,resolve:z}=N,Y=z(g?w:A(w),f),Z=$(f);if(!Z)Y+=".ejs";return Y};function Wf(f,w){var g;if(w.some(function(A){return g=jf.resolveInclude(f,A,!0),I.existsSync(g)}))return g}function Z1(f,w){var g,A,$=w.views,z=/^[A-Za-z]+:\\|^\//.exec(f);if(z&&z.length)if(f=f.replace(/^\/*/,""),Array.isArray(w.root))g=Wf(f,w.root);else g=jf.resolveInclude(f,w.root||"/",!0);else{if(w.filename){if(A=jf.resolveInclude(f,w.filename),I.existsSync(A))g=A}if(!g&&Array.isArray($))g=Wf(f,$);if(!g&&typeof w.includer!=="function")throw new Error('Could not find the include file "'+w.escapeFunction(f)+'"')}return g}function U(f,w){var g,A=f.filename,$=arguments.length>1;if(f.cache){if(!A)throw new Error("cache option requires a filename");if(g=jf.cache.get(A),g)return g;if(!$)w=Xf(A).toString().replace(Cf,"")}else if(!$){if(!A)throw new Error("Internal EJS error: no file name or template provided");w=Xf(A).toString().replace(Cf,"")}if(g=jf.compile(w,f),f.cache)jf.cache.set(A,g);return g}function V1(f,w,g){var A;if(!g)if(typeof jf.promiseImpl=="function")return new jf.promiseImpl(function($,z){try{A=U(f)(w),$(A)}catch(Y){z(Y)}});else throw new Error("Please provide a callback function");else{try{A=U(f)(w)}catch($){return g($)}g(null,A)}}function Xf(f){return jf.fileLoader(f)}function C1(f,w){var g=G.shallowCopy(G.createNullProtoObjWherePossible(),w);if(g.filename=Z1(f,g),typeof w.includer==="function"){var A=w.includer(f,g.filename);if(A){if(A.filename)g.filename=A.filename;if(A.template)return U(g,A.template)}}return U(g)}function Ff(f,w,g,A,$){var z=w.split(`
`),Y=Math.max(A-3,0),Z=Math.min(z.length,A+3),C=$(g),X=z.slice(Y,Z).map(function(J,W){var V=W+Y+1;return(V==A?" >> ":"    ")+V+"| "+J}).join(`
`);throw f.path=C,f.message=(C||"ejs")+":"+A+`
`+X+`

`+f.message,f}function Gf(f){return f.replace(/;(\s*$)/,"$1")}jf.compile=function f(w,g){var A;if(g&&g.scope){if(!Vf)console.warn("`scope` option is deprecated and will be removed in EJS 3"),Vf=!0;if(!g.context)g.context=g.scope;delete g.scope}return A=new Q(w,g),A.compile()};jf.render=function(f,w,g){var A=w||G.createNullProtoObjWherePossible(),$=g||G.createNullProtoObjWherePossible();if(arguments.length==2)G.shallowCopyFromList($,A,Bf);return U($,f)(A)};jf.renderFile=function(){var f=Array.prototype.slice.call(arguments),w=f.shift(),g,A={filename:w},$,z;if(typeof arguments[arguments.length-1]=="function")g=f.pop();if(f.length){if($=f.shift(),f.length)G.shallowCopy(A,f.pop());else{if($.settings){if($.settings.views)A.views=$.settings.views;if($.settings["view cache"])A.cache=!0;if(z=$.settings["view options"],z)G.shallowCopy(A,z)}G.shallowCopyFromList(A,$,Y1)}A.filename=w}else $=G.createNullProtoObjWherePossible();return V1(A,$,g)};jf.Template=Q;jf.clearCache=function(){jf.cache.reset()};function Q(f,w){var g=G.hasOwnOnlyObject(w),A=G.createNullProtoObjWherePossible();if(this.templateText=f,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",A.client=g.client||!1,A.escapeFunction=g.escape||g.escapeFunction||G.escapeXML,A.compileDebug=g.compileDebug!==!1,A.debug=!!g.debug,A.filename=g.filename,A.openDelimiter=g.openDelimiter||jf.openDelimiter||w1,A.closeDelimiter=g.closeDelimiter||jf.closeDelimiter||A1,A.delimiter=g.delimiter||jf.delimiter||$1,A.strict=g.strict||!1,A.context=g.context,A.cache=g.cache||!1,A.rmWhitespace=g.rmWhitespace,A.root=g.root,A.includer=g.includer,A.outputFunctionName=g.outputFunctionName,A.localsName=g.localsName||jf.localsName||Qf,A.views=g.views,A.async=g.async,A.destructuredLocals=g.destructuredLocals,A.legacyInclude=typeof g.legacyInclude!="undefined"?!!g.legacyInclude:!0,A.strict)A._with=!1;else A._with=typeof g._with!="undefined"?g._with:!0;this.opts=A,this.regex=this.createRegex()}Q.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};Q.prototype={createRegex:function(){var f=J1,w=G.escapeRegExpChars(this.opts.delimiter),g=G.escapeRegExpChars(this.opts.openDelimiter),A=G.escapeRegExpChars(this.opts.closeDelimiter);return f=f.replace(/%/g,w).replace(/</g,g).replace(/>/g,A),new RegExp(f)},compile:function(){var f,w,g=this.opts,A="",$="",z=g.escapeFunction,Y,Z=g.filename?JSON.stringify(g.filename):"undefined";if(!this.source){if(this.generateSource(),A+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,g.outputFunctionName){if(!_.test(g.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");A+="  var "+g.outputFunctionName+` = __append;
`}if(g.localsName&&!_.test(g.localsName))throw new Error("localsName is not a valid JS identifier.");if(g.destructuredLocals&&g.destructuredLocals.length){var C="  var __locals = ("+g.localsName+` || {}),
`;for(var X=0;X<g.destructuredLocals.length;X++){var J=g.destructuredLocals[X];if(!_.test(J))throw new Error("destructuredLocals["+X+"] is not a valid JS identifier.");if(X>0)C+=`,
  `;C+=J+" = __locals."+J}A+=C+`;
`}if(g._with!==!1)A+="  with ("+g.localsName+` || {}) {
`,$+=`  }
`;$+=`  return __output;
`,this.source=A+this.source+$}if(g.compileDebug)f=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+Z+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`;else f=this.source;if(g.client){if(f="escapeFn = escapeFn || "+z.toString()+`;
`+f,g.compileDebug)f="rethrow = rethrow || "+Ff.toString()+`;
`+f}if(g.strict)f=`"use strict";
`+f;if(g.debug)console.log(f);if(g.compileDebug&&g.filename)f=f+`
//# sourceURL=`+Z+`
`;try{if(g.async)try{Y=new Function("return (async function(){}).constructor;")()}catch(B){if(B instanceof SyntaxError)throw new Error("This environment does not support async/await");else throw B}else Y=Function;w=new Y(g.localsName+", escapeFn, include, rethrow",f)}catch(B){if(B instanceof SyntaxError){if(g.filename)B.message+=" in "+g.filename;if(B.message+=` while compiling ejs

`,B.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,B.message+="https://github.com/RyanZim/EJS-Lint",!g.async)B.message+=`
`,B.message+="Or, if you meant to create an async function, pass `async: true` as an option."}throw B}var W=g.client?w:function B(K){var O=function(Sf,h){var E=G.shallowCopy(G.createNullProtoObjWherePossible(),K);if(h)E=G.shallowCopy(E,h);return C1(Sf,g)(E)};return w.apply(g.context,[K||G.createNullProtoObjWherePossible(),z,O,Ff])};if(g.filename&&typeof Object.defineProperty==="function"){var V=g.filename,F=N.basename(V,N.extname(V));try{Object.defineProperty(W,"name",{value:F,writable:!1,enumerable:!1,configurable:!0})}catch(B){}}return W},generateSource:function(){var f=this.opts;if(f.rmWhitespace)this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"");this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var w=this,g=this.parseTemplateText(),A=this.opts.delimiter,$=this.opts.openDelimiter,z=this.opts.closeDelimiter;if(g&&g.length)g.forEach(function(Y,Z){var C;if(Y.indexOf($+A)===0&&Y.indexOf($+A+A)!==0){if(C=g[Z+2],!(C==A+z||C=="-"+A+z||C=="_"+A+z))throw new Error('Could not find matching close tag for "'+Y+'".')}w.scanLine(Y)})},parseTemplateText:function(){var f=this.templateText,w=this.regex,g=w.exec(f),A=[],$;while(g){if($=g.index,$!==0)A.push(f.substring(0,$)),f=f.slice($);A.push(g[0]),f=f.slice(g[0].length),g=w.exec(f)}if(f)A.push(f);return A},_addOutput:function(f){if(this.truncate)f=f.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1;if(!f)return f;f=f.replace(/\\/g,"\\\\"),f=f.replace(/\n/g,"\\n"),f=f.replace(/\r/g,"\\r"),f=f.replace(/"/g,"\\\""),this.source+='    ; __append("'+f+`")
`},scanLine:function(f){var w=this,g=this.opts.delimiter,A=this.opts.openDelimiter,$=this.opts.closeDelimiter,z=0;switch(z=f.split(`
`).length-1,f){case A+g:case A+g+"_":this.mode=Q.modes.EVAL;break;case A+g+"=":this.mode=Q.modes.ESCAPED;break;case A+g+"-":this.mode=Q.modes.RAW;break;case A+g+"#":this.mode=Q.modes.COMMENT;break;case A+g+g:this.mode=Q.modes.LITERAL,this.source+='    ; __append("'+f.replace(A+g+g,A+g)+`")
`;break;case g+g+$:this.mode=Q.modes.LITERAL,this.source+='    ; __append("'+f.replace(g+g+$,g+$)+`")
`;break;case g+$:case"-"+g+$:case"_"+g+$:if(this.mode==Q.modes.LITERAL)this._addOutput(f);this.mode=null,this.truncate=f.indexOf("-")===0||f.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case Q.modes.EVAL:case Q.modes.ESCAPED:case Q.modes.RAW:if(f.lastIndexOf("//")>f.lastIndexOf(`
`))f+=`
`}switch(this.mode){case Q.modes.EVAL:this.source+="    ; "+f+`
`;break;case Q.modes.ESCAPED:this.source+="    ; __append(escapeFn("+Gf(f)+`))
`;break;case Q.modes.RAW:this.source+="    ; __append("+Gf(f)+`)
`;break;case Q.modes.COMMENT:break;case Q.modes.LITERAL:this._addOutput(f);break}}else this._addOutput(f)}if(w.opts.compileDebug&&z)this.currentLine+=z,this.source+="    ; __line = "+this.currentLine+`
`}};jf.escapeXML=G.escapeXML;jf.__express=jf.renderFile;jf.VERSION=g1;jf.name=z1;if(typeof window!="undefined")window.ejs=jf});function R(f){switch(f.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var c=null;async function Kf(){if(!c){let f=await Promise.resolve().then(() => _f(Uf(),1));c=f.default||f}return c}class x{req;server;pathname;routePattern;headers=new Headers;parsedQuery=null;parsedParams=null;parsedCookies=null;parsedBody=null;contextData={};urlObject=null;constructor(f,w,g,A=""){this.req=f,this.server=w,this.pathname=g,this.routePattern=A}setHeader(f,w){return this.headers.set(f,w),this}removeHeader(f){return this.headers.delete(f),this}set(f,w){return this.contextData[f]=w,this}get(f){return this.contextData[f]}get ip(){return this.server.requestIP(this.req)?.address??null}get url(){if(!this.urlObject)this.urlObject=new URL(this.req.url);return this.urlObject}get query(){if(!this.parsedQuery)this.parsedQuery=this.url.search?Object.fromEntries(this.url.searchParams):{};return this.parsedQuery}get params(){if(!this.parsedParams&&this.routePattern)try{this.parsedParams=Df(this.routePattern,this.pathname)}catch(f){let w=f instanceof Error?f.message:String(f);throw new Error(`Failed to extract route parameters: ${w}`)}return this.parsedParams??{}}get body(){if(this.req.method==="GET")return Promise.resolve({});if(!this.parsedBody)this.parsedBody=(async()=>{try{let f=await Lf(this.req);if(f.error)throw new Error(f.error);return Object.keys(f).length===0?null:f}catch(f){throw new Error("Invalid request body format")}})();return this.parsedBody}text(f,w=200){return new Response(f,{status:w,headers:this.headers})}send(f,w=200){let g;if(f instanceof Uint8Array)g="Uint8Array";else if(f instanceof ArrayBuffer)g="ArrayBuffer";else g=typeof f;let A=g==="object"&&f!==null?JSON.stringify(f):f;return new Response(A,{status:w,headers:this.headers})}json(f,w=200){return Response.json(f,{status:w,headers:this.headers})}file(f,w,g=200){let A=Bun.file(f);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",w??R(f));return new Response(A,{status:g,headers:this.headers})}async ejs(f,w={},g=200){let A=await Kf();try{let $=await Bun.file(f).text(),z=A.render($,w),Y=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(z,{status:g,headers:Y})}catch($){return console.error("EJS Rendering Error:",$),new Response("Error rendering template",{status:500})}}redirect(f,w=302){return this.headers.set("Location",f),new Response(null,{status:w,headers:this.headers})}setCookie(f,w,g={}){let A=`${encodeURIComponent(f)}=${encodeURIComponent(w)}`;if(g.maxAge)A+=`; Max-Age=${g.maxAge}`;if(g.expires)A+=`; Expires=${g.expires.toUTCString()}`;if(g.path)A+=`; Path=${g.path}`;if(g.domain)A+=`; Domain=${g.domain}`;if(g.secure)A+="; Secure";if(g.httpOnly)A+="; HttpOnly";if(g.sameSite)A+=`; SameSite=${g.sameSite}`;return this.headers.append("Set-Cookie",A),this}get cookies(){if(!this.parsedCookies){let f=this.req.headers.get("cookie");this.parsedCookies=f?Hf(f):{}}return this.parsedCookies}stream(f){let w=new Headers(this.headers),g=new ReadableStream({async start(A){await f(A),A.close()}});return new Response(g,{headers:w})}yieldStream(f){return new Response}}function R1(f,w,g,A){let $=null,z=null,Y=null,Z=null,C={},X=null;return{req:f,server:w,pathname:g,headers:new Headers,setHeader(J,W){return this.headers.set(J,W),this},removeHeader(J){return this.headers.delete(J),this},set(J,W){return C[J]=W,this},get(J){return C[J]},get ip(){return this.server.requestIP(f)?.address??null},get url(){if(!X)X=new URL(f.url);return X},get query(){if(!$){if(!this.url.search)return{};$=Object.fromEntries(this.url.searchParams)}return $},get params(){if(!z&&A)try{z=Df(A,g)}catch(J){let W=J instanceof Error?J.message:String(J);throw new Error(`Failed to extract route parameters: ${W}`)}return z??{}},get body(){if(f.method==="GET")return Promise.resolve({});if(!Z)Z=(async()=>{try{let J=await Lf(f);if(J.error)throw new Error(J.error);return Object.keys(J).length===0?null:J}catch(J){throw new Error("Invalid request body format")}})();return Z},text(J,W=200){return new Response(J,{status:W,headers:this.headers})},send(J,W=200){let V;if(J instanceof Uint8Array)V="Uint8Array";else if(J instanceof ArrayBuffer)V="ArrayBuffer";else V=typeof J;let F=V==="object"&&J!==null?JSON.stringify(J):J;return new Response(F,{status:W,headers:this.headers})},json(J,W=200){return Response.json(J,{status:W,headers:this.headers})},file(J,W,V=200){let F=Bun.file(J);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",W??R(J));return new Response(F,{status:V,headers:this.headers})},async ejs(J,W={},V=200){let F=await Kf();try{let B=await Bun.file(J).text(),K=F.render(B,W),O=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(K,{status:V,headers:O})}catch(B){return console.error("EJS Rendering Error:",B),new Response("Error rendering template",{status:500})}},redirect(J,W=302){return this.headers.set("Location",J),new Response(null,{status:W,headers:this.headers})},stream(J){let W=new Headers(this.headers),V=new ReadableStream({async start(F){await J(F),F.close()}});return new Response(V,{headers:W})},yieldStream(J){return new Response("not working stream yet.")},setCookie(J,W,V={}){let F=`${encodeURIComponent(J)}=${encodeURIComponent(W)}`;if(V.maxAge)F+=`; Max-Age=${V.maxAge}`;if(V.expires)F+=`; Expires=${V.expires.toUTCString()}`;if(V.path)F+=`; Path=${V.path}`;if(V.domain)F+=`; Domain=${V.domain}`;if(V.secure)F+="; Secure";if(V.httpOnly)F+="; HttpOnly";if(V.sameSite)F+=`; SameSite=${V.sameSite}`;return this.headers.append("Set-Cookie",F),this},get cookies(){if(!Y){let J=this.req.headers.get("cookie");Y=J?Hf(J):{}}return Y}}}function Hf(f){return Object.fromEntries(f.split(";").map((w)=>{let[g,...A]=w.trim().split("=");return[g,decodeURIComponent(A.join("="))]}))}function Df(f,w){let g={},A=f.split("/"),[$]=w.split("?"),z=$.split("/");if(A.length!==z.length)return null;for(let Y=0;Y<A.length;Y++){let Z=A[Y];if(Z.charCodeAt(0)===58)g[Z.slice(1)]=z[Y]}return g}async function Lf(f){let w=f.headers.get("Content-Type")||"";if(!w)return{};if(f.headers.get("Content-Length")==="0"||!f.body)return{};if(w.startsWith("application/json"))return await f.json();if(w.startsWith("application/x-www-form-urlencoded")){let A=await f.text();return Object.fromEntries(new URLSearchParams(A))}if(w.startsWith("multipart/form-data")){let A=await f.formData(),$={};for(let[z,Y]of A.entries())$[z]=Y;return $}return{error:"Unknown request body type"}}var N1=(f,w)=>{try{return w(f)}catch{return f.replace(/(?:%[0-9A-Fa-f]{2})+/g,(g)=>{try{return w(g)}catch{return g}})}},y=(f)=>N1(f,decodeURI),P1=(f)=>{let w=f.indexOf("/",f.indexOf(":")+4),g=w;for(;g<f.length;g++){let A=f.charCodeAt(g);if(A===37){let $=f.indexOf("?",g),z=f.slice(w,$===-1?void 0:$);return y(z.includes("%25")?z.replace(/%25/g,"%2525"):z)}else if(A===63)break}return f.slice(w,g)};async function v(f,w,g){if(!w?.length)return;for(let A=0;A<w.length;A++){let $=w[A](...g),z=$ instanceof Promise?await $:$;if(z&&f!=="onRequest")return z}}async function vf(f,w,g){let A=f.globalMiddlewares;if(A.length)for(let z of A){let Y=await z(g);if(Y)return Y}let $=f.middlewares.get(w);if($&&$.length)for(let z of $){let Y=await z(g);if(Y)return Y}return null}async function x1(f,w,g){for(let A of f){let $=await A(w,g);if($)return $}}async function Of(f,w,g){let A=await U1(f,w,g),$=A instanceof Promise?await A:A;if($)return $}async function U1(f,w,g){if(w.endsWith("/"))w=w.slice(0,-1);if(!f.filters.has(w))if(f.filterFunction.length)for(let A of f.filterFunction){let $=await A(g);if($)return $}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function Ef(f,w,g){if(f.staticPath){let $=!0;if(f.staticRequestPath)$=g.startsWith(f.staticRequestPath);if($){let z=await K1(f,g,w);if(z)return z;let Y=f.trie.search("*",w.req.method);if(Y?.handler)return await Y.handler(w)}}let A=f.routeNotFoundFunc(w);return A instanceof Promise?await A:A||k(404,`404 Route not found for ${g}`)}function k(f,w){return new Response(JSON.stringify({error:w}),{status:f,headers:{"Content-Type":"application/json"}})}async function K1(f,w,g){if(!f.staticPath)return null;let A=`${f.staticPath}${w}`;if(await Bun.file(A).exists()){let z=R(A);return g.file(A,z,200)}return null}async function H1(f,w,g){let A,$=f.url.indexOf("/",f.url.indexOf(":")+4),z=$;for(;z<f.url.length;z++){let J=f.url.charCodeAt(z);if(J===37){let W=f.url.indexOf("?",z),V=f.url.slice($,W===-1?void 0:W);A=y(V.includes("%25")?V.replace(/%25/g,"%2525"):V);break}else if(J===63)break}if(!A)A=f.url.slice($,z);let Y=g.trie.search(A,f.method),Z=new x(f,w,A,Y?.path);if(g.hasOnReqHook)await v("onRequest",g.hooks.onRequest,[f,A,w]);if(g.hasMiddleware){let J=await vf(g,A,Z);if(J)return J}if(g.hasFilterEnabled){let J=await Of(g,A,Z);if(J)return J}if(!Y)return await Ef(g,Z,A);if(g.hasPreHandlerHook){let J=await v("preHandler",g.hooks.preHandler,[Z]);if(J)return J}let C=Y.handler(Z),X=C instanceof Promise?await C:C;if(g.hasOnSendHook){let J=await v("onSend",g.hooks.onSend,[Z,X]);if(J)return J}if(X instanceof Response)return X;return k(500,"No response returned from handler.")}export{H1 as default};
