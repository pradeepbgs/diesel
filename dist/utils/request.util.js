function f(e){switch(e.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var l=(e)=>e!==null&&typeof e==="object"&&typeof e.then==="function",p=(e)=>e!==null&&typeof e==="object"&&typeof e.status==="number"&&typeof e.headers==="object";async function x(e,t,o){if(!t?.length)return;for(let n=0;n<t.length;n++){let r=t[n](...o),s=r instanceof Promise?await r:r;if(s&&e!=="onRequest")return s}}async function T(e,t,o){let n=e.globalMiddlewares;if(n.length)for(let s of n){let i=await s(o);if(i)return i}let r=e.middlewares.get(t);if(r&&r.length)for(let s of r){let i=await s(o);if(i)return i}return null}async function F(e,t,o){for(let n of e){let r=await n(t,o);if(r)return r}}async function P(e,t,o){let n=await g(e,t,o),r=l(n)?await n:n;if(r)return r}async function g(e,t,o){if(t.endsWith("/"))t=t.slice(0,-1);if(!e.filters.has(t))if(e.filterFunction.length)for(let n of e.filterFunction){let r=await n(o);if(r)return r}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function j(e,t,o,n){if(!e.filters.has(t))if(e.filterFunction.length)for(let r of e.filterFunction){let s=await r(o,n);if(s)return s}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function q(e,t,o){if(e.staticPath){let u=!0;if(e.staticRequestPath)u=o.startsWith(e.staticRequestPath);if(u){let c=await y(e,o,t);if(c)return c}}let i=await(e.router.find(t.req.method,"*")?.handler).slice(-1)[0](t);if(p(i))return i;let a=e.routeNotFoundFunc(t);return a instanceof Promise?await a:a||d(404,`404 Route not found for ${o}`)}function d(e,t){return new Response(JSON.stringify({error:t}),{status:e,headers:{"Content-Type":"application/json"}})}async function y(e,t,o){if(!e.staticPath)return null;let n=`${e.staticPath}${t}`;if(await Bun.file(n).exists()){let s=f(n);return o.file(n,s,200)}return null}export{T as runMiddlewares,x as runHooks,P as runFilter,y as handleStaticFiles,q as handleRouteNotFound,g as handleFilterRequest,j as handleBunFilterRequest,d as generateErrorResponse,F as executeBunMiddlewares};
