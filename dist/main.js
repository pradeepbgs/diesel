var V0=Object.create;var{getPrototypeOf:G0,defineProperty:T,getOwnPropertyNames:B1,getOwnPropertyDescriptor:C0}=Object,U1=Object.prototype.hasOwnProperty;var W0=($,z,Z)=>{Z=$!=null?V0(G0($)):{};let X=z||!$||!$.__esModule?T(Z,"default",{value:$,enumerable:!0}):Z;for(let J of B1($))if(!U1.call(X,J))T(X,J,{get:()=>$[J],enumerable:!0});return X},K1=new WeakMap,K0=($)=>{var z=K1.get($),Z;if(z)return z;if(z=T({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")B1($).map((X)=>!U1.call(z,X)&&T(z,X,{get:()=>$[X],enumerable:!(Z=C0($,X))||Z.enumerable}));return K1.set($,z),z},p=($,z)=>()=>(z||$((z={exports:{}}).exports,z),z.exports);var B0=($,z)=>{for(var Z in z)T($,Z,{get:z[Z],enumerable:!0,configurable:!0,set:(X)=>z[Z]=()=>X})};var U0=($,z)=>()=>($&&(z=$($=0)),z);var D0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(z,Z)=>(typeof require!=="undefined"?require:z)[Z]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var _1={};B0(_1,{sep:()=>M1,resolve:()=>c,relative:()=>F1,posix:()=>I1,parse:()=>q1,normalize:()=>l,join:()=>N1,isAbsolute:()=>A1,format:()=>O1,extname:()=>H1,dirname:()=>L1,delimiter:()=>w1,default:()=>I,basename:()=>j1,_makeLong:()=>S1});function j($){if(typeof $!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify($))}function D1($,z){var Z="",X=0,J=-1,Q=0,Y;for(var V=0;V<=$.length;++V){if(V<$.length)Y=$.charCodeAt(V);else if(Y===47)break;else Y=47;if(Y===47){if(J===V-1||Q===1);else if(J!==V-1&&Q===2){if(Z.length<2||X!==2||Z.charCodeAt(Z.length-1)!==46||Z.charCodeAt(Z.length-2)!==46){if(Z.length>2){var C=Z.lastIndexOf("/");if(C!==Z.length-1){if(C===-1)Z="",X=0;else Z=Z.slice(0,C),X=Z.length-1-Z.lastIndexOf("/");J=V,Q=0;continue}}else if(Z.length===2||Z.length===1){Z="",X=0,J=V,Q=0;continue}}if(z){if(Z.length>0)Z+="/..";else Z="..";X=2}}else{if(Z.length>0)Z+="/"+$.slice(J+1,V);else Z=$.slice(J+1,V);X=V-J-1}J=V,Q=0}else if(Y===46&&Q!==-1)++Q;else Q=-1}return Z}function A0($,z){var Z=z.dir||z.root,X=z.base||(z.name||"")+(z.ext||"");if(!Z)return X;if(Z===z.root)return Z+X;return Z+$+X}function c(){var $="",z=!1,Z;for(var X=arguments.length-1;X>=-1&&!z;X--){var J;if(X>=0)J=arguments[X];else{if(Z===void 0)Z=process.cwd();J=Z}if(j(J),J.length===0)continue;$=J+"/"+$,z=J.charCodeAt(0)===47}if($=D1($,!z),z)if($.length>0)return"/"+$;else return"/";else if($.length>0)return $;else return"."}function l($){if(j($),$.length===0)return".";var z=$.charCodeAt(0)===47,Z=$.charCodeAt($.length-1)===47;if($=D1($,!z),$.length===0&&!z)$=".";if($.length>0&&Z)$+="/";if(z)return"/"+$;return $}function A1($){return j($),$.length>0&&$.charCodeAt(0)===47}function N1(){if(arguments.length===0)return".";var $;for(var z=0;z<arguments.length;++z){var Z=arguments[z];if(j(Z),Z.length>0)if($===void 0)$=Z;else $+="/"+Z}if($===void 0)return".";return l($)}function F1($,z){if(j($),j(z),$===z)return"";if($=c($),z=c(z),$===z)return"";var Z=1;for(;Z<$.length;++Z)if($.charCodeAt(Z)!==47)break;var X=$.length,J=X-Z,Q=1;for(;Q<z.length;++Q)if(z.charCodeAt(Q)!==47)break;var Y=z.length,V=Y-Q,C=J<V?J:V,W=-1,G=0;for(;G<=C;++G){if(G===C){if(V>C){if(z.charCodeAt(Q+G)===47)return z.slice(Q+G+1);else if(G===0)return z.slice(Q+G)}else if(J>C){if($.charCodeAt(Z+G)===47)W=G;else if(G===0)W=0}break}var K=$.charCodeAt(Z+G),B=z.charCodeAt(Q+G);if(K!==B)break;else if(K===47)W=G}var U="";for(G=Z+W+1;G<=X;++G)if(G===X||$.charCodeAt(G)===47)if(U.length===0)U+="..";else U+="/..";if(U.length>0)return U+z.slice(Q+W);else{if(Q+=W,z.charCodeAt(Q)===47)++Q;return z.slice(Q)}}function S1($){return $}function L1($){if(j($),$.length===0)return".";var z=$.charCodeAt(0),Z=z===47,X=-1,J=!0;for(var Q=$.length-1;Q>=1;--Q)if(z=$.charCodeAt(Q),z===47){if(!J){X=Q;break}}else J=!1;if(X===-1)return Z?"/":".";if(Z&&X===1)return"//";return $.slice(0,X)}function j1($,z){if(z!==void 0&&typeof z!=="string")throw new TypeError('"ext" argument must be a string');j($);var Z=0,X=-1,J=!0,Q;if(z!==void 0&&z.length>0&&z.length<=$.length){if(z.length===$.length&&z===$)return"";var Y=z.length-1,V=-1;for(Q=$.length-1;Q>=0;--Q){var C=$.charCodeAt(Q);if(C===47){if(!J){Z=Q+1;break}}else{if(V===-1)J=!1,V=Q+1;if(Y>=0)if(C===z.charCodeAt(Y)){if(--Y===-1)X=Q}else Y=-1,X=V}}if(Z===X)X=V;else if(X===-1)X=$.length;return $.slice(Z,X)}else{for(Q=$.length-1;Q>=0;--Q)if($.charCodeAt(Q)===47){if(!J){Z=Q+1;break}}else if(X===-1)J=!1,X=Q+1;if(X===-1)return"";return $.slice(Z,X)}}function H1($){j($);var z=-1,Z=0,X=-1,J=!0,Q=0;for(var Y=$.length-1;Y>=0;--Y){var V=$.charCodeAt(Y);if(V===47){if(!J){Z=Y+1;break}continue}if(X===-1)J=!1,X=Y+1;if(V===46){if(z===-1)z=Y;else if(Q!==1)Q=1}else if(z!==-1)Q=-1}if(z===-1||X===-1||Q===0||Q===1&&z===X-1&&z===Z+1)return"";return $.slice(z,X)}function O1($){if($===null||typeof $!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof $);return A0("/",$)}function q1($){j($);var z={root:"",dir:"",base:"",ext:"",name:""};if($.length===0)return z;var Z=$.charCodeAt(0),X=Z===47,J;if(X)z.root="/",J=1;else J=0;var Q=-1,Y=0,V=-1,C=!0,W=$.length-1,G=0;for(;W>=J;--W){if(Z=$.charCodeAt(W),Z===47){if(!C){Y=W+1;break}continue}if(V===-1)C=!1,V=W+1;if(Z===46){if(Q===-1)Q=W;else if(G!==1)G=1}else if(Q!==-1)G=-1}if(Q===-1||V===-1||G===0||G===1&&Q===V-1&&Q===Y+1){if(V!==-1)if(Y===0&&X)z.base=z.name=$.slice(1,V);else z.base=z.name=$.slice(Y,V)}else{if(Y===0&&X)z.name=$.slice(1,Q),z.base=$.slice(1,V);else z.name=$.slice(Y,Q),z.base=$.slice(Y,V);z.ext=$.slice(Q,V)}if(Y>0)z.dir=$.slice(0,Y-1);else if(X)z.dir="/";return z}var M1="/",w1=":",I1,I;var n=U0(()=>{I1=(($)=>($.posix=$,$))({resolve:c,normalize:l,isAbsolute:A1,join:N1,relative:F1,_makeLong:S1,dirname:L1,basename:j1,extname:H1,format:O1,parse:q1,sep:M1,delimiter:w1,win32:null,posix:null}),I=I1});var T1=p((O0)=>{var N0=/[|\\{}()[\]^$+*?.]/g,F0=Object.prototype.hasOwnProperty,r=function($,z){return F0.apply($,[z])};O0.escapeRegExpChars=function($){if(!$)return"";return String($).replace(N0,"\\$&")};var S0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},L0=/[&<>'"]/g;function j0($){return S0[$]||$}var H0=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;O0.escapeXML=function($){return $==null?"":String($).replace(L0,j0)};function f1(){return Function.prototype.toString.call(this)+`;
`+H0}try{if(typeof Object.defineProperty==="function")Object.defineProperty(O0.escapeXML,"toString",{value:f1});else O0.escapeXML.toString=f1}catch($){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}O0.shallowCopy=function($,z){if(z=z||{},$!==null&&$!==void 0)for(var Z in z){if(!r(z,Z))continue;if(Z==="__proto__"||Z==="constructor")continue;$[Z]=z[Z]}return $};O0.shallowCopyFromList=function($,z,Z){if(Z=Z||[],z=z||{},$!==null&&$!==void 0)for(var X=0;X<Z.length;X++){var J=Z[X];if(typeof z[J]!="undefined"){if(!r(z,J))continue;if(J==="__proto__"||J==="constructor")continue;$[J]=z[J]}}return $};O0.cache={_data:{},set:function($,z){this._data[$]=z},get:function($){return this._data[$]},remove:function($){delete this._data[$]},reset:function(){this._data={}}};O0.hyphenToCamel=function($){return $.replace(/-[a-z]/g,function(z){return z[1].toUpperCase()})};O0.createNullProtoObjWherePossible=function(){if(typeof Object.create=="function")return function(){return Object.create(null)};if(!({__proto__:null}instanceof Object))return function(){return{__proto__:null}};return function(){return{}}}();O0.hasOwnOnlyObject=function($){var z=O0.createNullProtoObjWherePossible();for(var Z in $)if(r($,Z))z[Z]=$[Z];return z}});var E1=p((w$,b0)=>{b0.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.10",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^4.0.2","lru-cache":"^4.0.1",mocha:"^10.2.0","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"npx jake test"}}});var o1=p((u1)=>{var e=(()=>({})),E=(n(),K0(_1)),A=T1(),R1=!1,T0=E1().version,E0="<",R0=">",P0="%",y1="locals",v0="ejs",g0="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",c1=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],k0=c1.concat("cache"),P1=/^\uFEFF/,a=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;u1.cache=A.cache;u1.fileLoader=e.readFileSync;u1.localsName=y1;u1.promiseImpl=new Function("return this;")().Promise;u1.resolveInclude=function($,z,Z){var{dirname:X,extname:J,resolve:Q}=E,Y=Q(Z?z:X(z),$),V=J($);if(!V)Y+=".ejs";return Y};function v1($,z){var Z;if(z.some(function(X){return Z=u1.resolveInclude($,X,!0),e.existsSync(Z)}))return Z}function x0($,z){var Z,X,J=z.views,Q=/^[A-Za-z]+:\\|^\//.exec($);if(Q&&Q.length)if($=$.replace(/^\/*/,""),Array.isArray(z.root))Z=v1($,z.root);else Z=u1.resolveInclude($,z.root||"/",!0);else{if(z.filename){if(X=u1.resolveInclude($,z.filename),e.existsSync(X))Z=X}if(!Z&&Array.isArray(J))Z=v1($,J);if(!Z&&typeof z.includer!=="function")throw new Error('Could not find the include file "'+z.escapeFunction($)+'"')}return Z}function R($,z){var Z,X=$.filename,J=arguments.length>1;if($.cache){if(!X)throw new Error("cache option requires a filename");if(Z=u1.cache.get(X),Z)return Z;if(!J)z=g1(X).toString().replace(P1,"")}else if(!J){if(!X)throw new Error("Internal EJS error: no file name or template provided");z=g1(X).toString().replace(P1,"")}if(Z=u1.compile(z,$),$.cache)u1.cache.set(X,Z);return Z}function y0($,z,Z){var X;if(!Z)if(typeof u1.promiseImpl=="function")return new u1.promiseImpl(function(J,Q){try{X=R($)(z),J(X)}catch(Y){Q(Y)}});else throw new Error("Please provide a callback function");else{try{X=R($)(z)}catch(J){return Z(J)}Z(null,X)}}function g1($){return u1.fileLoader($)}function c0($,z){var Z=A.shallowCopy(A.createNullProtoObjWherePossible(),z);if(Z.filename=x0($,Z),typeof z.includer==="function"){var X=z.includer($,Z.filename);if(X){if(X.filename)Z.filename=X.filename;if(X.template)return R(Z,X.template)}}return R(Z)}function k1($,z,Z,X,J){var Q=z.split(`
`),Y=Math.max(X-3,0),V=Math.min(Q.length,X+3),C=J(Z),W=Q.slice(Y,V).map(function(G,K){var B=K+Y+1;return(B==X?" >> ":"    ")+B+"| "+G}).join(`
`);throw $.path=C,$.message=(C||"ejs")+":"+X+`
`+W+`

`+$.message,$}function x1($){return $.replace(/;(\s*$)/,"$1")}u1.compile=function $(z,Z){var X;if(Z&&Z.scope){if(!R1)console.warn("`scope` option is deprecated and will be removed in EJS 3"),R1=!0;if(!Z.context)Z.context=Z.scope;delete Z.scope}return X=new S(z,Z),X.compile()};u1.render=function($,z,Z){var X=z||A.createNullProtoObjWherePossible(),J=Z||A.createNullProtoObjWherePossible();if(arguments.length==2)A.shallowCopyFromList(J,X,c1);return R(J,$)(X)};u1.renderFile=function(){var $=Array.prototype.slice.call(arguments),z=$.shift(),Z,X={filename:z},J,Q;if(typeof arguments[arguments.length-1]=="function")Z=$.pop();if($.length){if(J=$.shift(),$.length)A.shallowCopy(X,$.pop());else{if(J.settings){if(J.settings.views)X.views=J.settings.views;if(J.settings["view cache"])X.cache=!0;if(Q=J.settings["view options"],Q)A.shallowCopy(X,Q)}A.shallowCopyFromList(X,J,k0)}X.filename=z}else J=A.createNullProtoObjWherePossible();return y0(X,J,Z)};u1.Template=S;u1.clearCache=function(){u1.cache.reset()};function S($,z){var Z=A.hasOwnOnlyObject(z),X=A.createNullProtoObjWherePossible();if(this.templateText=$,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",X.client=Z.client||!1,X.escapeFunction=Z.escape||Z.escapeFunction||A.escapeXML,X.compileDebug=Z.compileDebug!==!1,X.debug=!!Z.debug,X.filename=Z.filename,X.openDelimiter=Z.openDelimiter||u1.openDelimiter||E0,X.closeDelimiter=Z.closeDelimiter||u1.closeDelimiter||R0,X.delimiter=Z.delimiter||u1.delimiter||P0,X.strict=Z.strict||!1,X.context=Z.context,X.cache=Z.cache||!1,X.rmWhitespace=Z.rmWhitespace,X.root=Z.root,X.includer=Z.includer,X.outputFunctionName=Z.outputFunctionName,X.localsName=Z.localsName||u1.localsName||y1,X.views=Z.views,X.async=Z.async,X.destructuredLocals=Z.destructuredLocals,X.legacyInclude=typeof Z.legacyInclude!="undefined"?!!Z.legacyInclude:!0,X.strict)X._with=!1;else X._with=typeof Z._with!="undefined"?Z._with:!0;this.opts=X,this.regex=this.createRegex()}S.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};S.prototype={createRegex:function(){var $=g0,z=A.escapeRegExpChars(this.opts.delimiter),Z=A.escapeRegExpChars(this.opts.openDelimiter),X=A.escapeRegExpChars(this.opts.closeDelimiter);return $=$.replace(/%/g,z).replace(/</g,Z).replace(/>/g,X),new RegExp($)},compile:function(){var $,z,Z=this.opts,X="",J="",Q=Z.escapeFunction,Y,V=Z.filename?JSON.stringify(Z.filename):"undefined";if(!this.source){if(this.generateSource(),X+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,Z.outputFunctionName){if(!a.test(Z.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");X+="  var "+Z.outputFunctionName+` = __append;
`}if(Z.localsName&&!a.test(Z.localsName))throw new Error("localsName is not a valid JS identifier.");if(Z.destructuredLocals&&Z.destructuredLocals.length){var C="  var __locals = ("+Z.localsName+` || {}),
`;for(var W=0;W<Z.destructuredLocals.length;W++){var G=Z.destructuredLocals[W];if(!a.test(G))throw new Error("destructuredLocals["+W+"] is not a valid JS identifier.");if(W>0)C+=`,
  `;C+=G+" = __locals."+G}X+=C+`;
`}if(Z._with!==!1)X+="  with ("+Z.localsName+` || {}) {
`,J+=`  }
`;J+=`  return __output;
`,this.source=X+this.source+J}if(Z.compileDebug)$=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+V+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`;else $=this.source;if(Z.client){if($="escapeFn = escapeFn || "+Q.toString()+`;
`+$,Z.compileDebug)$="rethrow = rethrow || "+k1.toString()+`;
`+$}if(Z.strict)$=`"use strict";
`+$;if(Z.debug)console.log($);if(Z.compileDebug&&Z.filename)$=$+`
//# sourceURL=`+V+`
`;try{if(Z.async)try{Y=new Function("return (async function(){}).constructor;")()}catch(F){if(F instanceof SyntaxError)throw new Error("This environment does not support async/await");else throw F}else Y=Function;z=new Y(Z.localsName+", escapeFn, include, rethrow",$)}catch(F){if(F instanceof SyntaxError){if(Z.filename)F.message+=" in "+Z.filename;if(F.message+=` while compiling ejs

`,F.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,F.message+="https://github.com/RyanZim/EJS-Lint",!Z.async)F.message+=`
`,F.message+="Or, if you meant to create an async function, pass `async: true` as an option."}throw F}var K=Z.client?z:function F(b){var H=function(L,o){var i=A.shallowCopy(A.createNullProtoObjWherePossible(),b);if(o)i=A.shallowCopy(i,o);return c0(L,Z)(i)};return z.apply(Z.context,[b||A.createNullProtoObjWherePossible(),Q,H,k1])};if(Z.filename&&typeof Object.defineProperty==="function"){var B=Z.filename,U=E.basename(B,E.extname(B));try{Object.defineProperty(K,"name",{value:U,writable:!1,enumerable:!1,configurable:!0})}catch(F){}}return K},generateSource:function(){var $=this.opts;if($.rmWhitespace)this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"");this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var z=this,Z=this.parseTemplateText(),X=this.opts.delimiter,J=this.opts.openDelimiter,Q=this.opts.closeDelimiter;if(Z&&Z.length)Z.forEach(function(Y,V){var C;if(Y.indexOf(J+X)===0&&Y.indexOf(J+X+X)!==0){if(C=Z[V+2],!(C==X+Q||C=="-"+X+Q||C=="_"+X+Q))throw new Error('Could not find matching close tag for "'+Y+'".')}z.scanLine(Y)})},parseTemplateText:function(){var $=this.templateText,z=this.regex,Z=z.exec($),X=[],J;while(Z){if(J=Z.index,J!==0)X.push($.substring(0,J)),$=$.slice(J);X.push(Z[0]),$=$.slice(Z[0].length),Z=z.exec($)}if($)X.push($);return X},_addOutput:function($){if(this.truncate)$=$.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1;if(!$)return $;$=$.replace(/\\/g,"\\\\"),$=$.replace(/\n/g,"\\n"),$=$.replace(/\r/g,"\\r"),$=$.replace(/"/g,"\\\""),this.source+='    ; __append("'+$+`")
`},scanLine:function($){var z=this,Z=this.opts.delimiter,X=this.opts.openDelimiter,J=this.opts.closeDelimiter,Q=0;switch(Q=$.split(`
`).length-1,$){case X+Z:case X+Z+"_":this.mode=S.modes.EVAL;break;case X+Z+"=":this.mode=S.modes.ESCAPED;break;case X+Z+"-":this.mode=S.modes.RAW;break;case X+Z+"#":this.mode=S.modes.COMMENT;break;case X+Z+Z:this.mode=S.modes.LITERAL,this.source+='    ; __append("'+$.replace(X+Z+Z,X+Z)+`")
`;break;case Z+Z+J:this.mode=S.modes.LITERAL,this.source+='    ; __append("'+$.replace(Z+Z+J,Z+J)+`")
`;break;case Z+J:case"-"+Z+J:case"_"+Z+J:if(this.mode==S.modes.LITERAL)this._addOutput($);this.mode=null,this.truncate=$.indexOf("-")===0||$.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case S.modes.EVAL:case S.modes.ESCAPED:case S.modes.RAW:if($.lastIndexOf("//")>$.lastIndexOf(`
`))$+=`
`}switch(this.mode){case S.modes.EVAL:this.source+="    ; "+$+`
`;break;case S.modes.ESCAPED:this.source+="    ; __append(escapeFn("+x1($)+`))
`;break;case S.modes.RAW:this.source+="    ; __append("+x1($)+`)
`;break;case S.modes.COMMENT:break;case S.modes.LITERAL:this._addOutput($);break}}else this._addOutput($)}if(z.opts.compileDebug&&Q)this.currentLine+=Q,this.source+="    ; __line = "+this.currentLine+`
`}};u1.escapeXML=A.escapeXML;u1.__express=u1.renderFile;u1.VERSION=T0;u1.name=v0;if(typeof window!="undefined")window.ejs=u1});class k{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class x{root;constructor(){this.root=new k}pushMidl($,...z){let Z=this.root,X=$.split("/").filter(Boolean);if($==="/"){Z.handler.push(...z);return}for(let J of X){let Q=J;if(J.startsWith(":"))Q=":";if(!Z.children[Q])Z.children[Q]=new k;Z=Z.children[Q]}Z.handler.push(...z)}insert($,z){let Z=this.root,X=$.split("/").filter(Boolean);if($==="/"){Z.isEndOfWord=!0,Z.handler.push(z.handler),Z.path=$,Z.method.push(z.method);return}for(let J of X){let Q=!1,Y=J;if(J.startsWith(":"))Q=!0,Y=":";if(!Z.children[Y])Z.children[Y]=new k;Z=Z.children[Y],Z.isDynamic=Q,Z.pattern=J}Z.isEndOfWord=!0,Z.path=$,Z.method.push(z.method),Z.handler.push(z.handler)}search($,z){let Z=this.root,X=$.split("/").filter(Boolean),J=X.length;for(let V of X){let C=V;if(!Z.children[C])if(Z.children[":"])Z=Z.children[":"];else return null;else Z=Z.children[C]}let Q=Z.path.split("/").filter(Boolean);if(J!==Q.length)return null;if(Z.method.indexOf(z)!==-1)return{path:Z.path,handler:Z.handler[0],pattern:Z.pattern};return null}}function y($){switch($.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var $1=null;async function n0(){if(!$1){let $=await Promise.resolve().then(() => W0(o1(),1));$1=$.default||$}return $1}function P($,z,Z,X){let J=null,Q=null,Y=null,V=null,C={},W=null;return{req:$,server:z,pathname:Z,status:200,headers:new Headers,setHeader(G,K){return this.headers.set(G,K),this},removeHeader(G){return this.headers.delete(G),this},set(G,K){return C[G]=K,this},get(G){return C[G]},get ip(){return this.server.requestIP($)?.address??null},get url(){if(!W)W=new URL($.url);return W},get query(){if(!J){if(!this.url.search)return{};J=Object.fromEntries(this.url.searchParams)}return J},get params(){if(!Q&&X)try{Q=r0(X,Z)}catch(G){let K=G instanceof Error?G.message:String(G);throw new Error(`Failed to extract route parameters: ${K}`)}return Q??{}},get body(){if($.method==="GET")return Promise.resolve({});if(!V)V=(async()=>{try{let G=await a0($);if(G.error)throw new Error(G.error);return Object.keys(G).length===0?null:G}catch(G){throw new Error("Invalid request body format")}})();return V},text(G,K=200){return new Response(G,{status:K,headers:this.headers})},send(G,K=200){let B;if(G instanceof Uint8Array)B="Uint8Array";else if(G instanceof ArrayBuffer)B="ArrayBuffer";else B=typeof G;let U=B==="object"&&G!==null?JSON.stringify(G):G;return new Response(U,{status:K,headers:this.headers})},json(G,K=200){return Response.json(G,{status:K,headers:this.headers})},file(G,K,B=200){let U=Bun.file(G);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",K??y(G));return new Response(U,{status:B,headers:this.headers})},async ejs(G,K={},B=200){let U=await n0();try{let F=await Bun.file(G).text(),b=U.render(F,K),H=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(b,{status:B,headers:H})}catch(F){return console.error("EJS Rendering Error:",F),new Response("Error rendering template",{status:500})}},redirect(G,K=302){return this.headers.set("Location",G),new Response(null,{status:K,headers:this.headers})},stream(G){let K=new Headers(this.headers),B=new ReadableStream({async start(U){await G(U),U.close()}});return new Response(B,{headers:K})},yieldStream(G){return new Response("not working stream yet.")},setCookie(G,K,B={}){let U=`${encodeURIComponent(G)}=${encodeURIComponent(K)}`;if(B.maxAge)U+=`; Max-Age=${B.maxAge}`;if(B.expires)U+=`; Expires=${B.expires.toUTCString()}`;if(B.path)U+=`; Path=${B.path}`;if(B.domain)U+=`; Domain=${B.domain}`;if(B.secure)U+="; Secure";if(B.httpOnly)U+="; HttpOnly";if(B.sameSite)U+=`; SameSite=${B.sameSite}`;return this.headers.append("Set-Cookie",U),this},get cookies(){if(!Y){let G=this.req.headers.get("cookie");Y=G?s0(G):{}}return Y}}}function s0($){return Object.fromEntries($.split(";").map((z)=>{let[Z,...X]=z.trim().split("=");return[Z,decodeURIComponent(X.join("="))]}))}function r0($,z){let Z={},X=$.split("/"),[J]=z.split("?"),Q=J.split("/");if(X.length!==Q.length)return null;for(let Y=0;Y<X.length;Y++){let V=X[Y];if(V.charCodeAt(0)===58)Z[V.slice(1)]=Q[Y]}return Z}async function a0($){let z=$.headers.get("Content-Type")||"";if(!z)return{};if($.headers.get("Content-Length")==="0"||!$.body)return{};if(z.startsWith("application/json"))return await $.json();if(z.startsWith("application/x-www-form-urlencoded")){let X=await $.text();return Object.fromEntries(new URLSearchParams(X))}if(z.startsWith("multipart/form-data")){let X=await $.formData(),J={};for(let[Q,Y]of X.entries())J[Q]=Y;return J}return{error:"Unknown request body type"}}var t0=($,z)=>{try{return z($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(Z)=>{try{return z(Z)}catch{return Z}})}},Z1=($)=>t0($,decodeURI),i1=($)=>{let z=$.indexOf("/",$.indexOf(":")+4),Z=z;for(;Z<$.length;Z++){let X=$.charCodeAt(Z);if(X===37){let J=$.indexOf("?",Z),Q=$.slice(z,J===-1?void 0:J);return Z1(Q.includes("%25")?Q.replace(/%25/g,"%2525"):Q)}else if(X===63)break}return $.slice(z,Z)};async function e0($,z,Z){let X,J=$.url.indexOf("/",$.url.indexOf(":")+4),Q=J;for(;Q<$.url.length;Q++){let G=$.url.charCodeAt(Q);if(G===37){let K=$.url.indexOf("?",Q),B=$.url.slice(J,K===-1?void 0:K);X=Z1(B.includes("%25")?B.replace(/%25/g,"%2525"):B);break}else if(G===63)break}if(!X)X=$.url.slice(J,Q);let Y=Z.trie.search(X,$.method),V=P($,z,X,Y?.path);if(Z.hasOnReqHook)await q("onRequest",Z.hooks.onRequest,[$,X,z]);if(Z.hasMiddleware){let G=await $$(Z,X,V);if(G)return G}if(Z.hasFilterEnabled){let G=await z1(Z,X,V);if(G)return G}if(!Y)return await X1(Z,V,X);if(Z.hasPreHandlerHook){let G=await q("preHandler",Z.hooks.preHandler,[V]);if(G)return G}let C=Y.handler(V),W=C instanceof Promise?await C:C;if(Z.hasOnSendHook){let G=await q("onSend",Z.hooks.onSend,[V,W]);if(G)return G}if(W instanceof Response)return W;return _(500,"No response returned from handler.")}async function q($,z,Z){if(!z?.length)return;for(let X=0;X<z.length;X++){let J=z[X](...Z),Q=J instanceof Promise?await J:J;if(Q&&$!=="onRequest")return Q}}async function $$($,z,Z){let X=$.globalMiddlewares;if(X.length)for(let Q of X){let Y=await Q(Z);if(Y)return Y}let J=$.middlewares.get(z);if(J&&J.length)for(let Q of J){let Y=await Q(Z);if(Y)return Y}return null}async function p1($,z,Z){for(let X of $){let J=await X(z,Z);if(J)return J}}async function z1($,z,Z){let X=await Z$($,z,Z),J=X instanceof Promise?await X:X;if(J)return J}async function Z$($,z,Z){if(z.endsWith("/"))z=z.slice(0,-1);if(!$.filters.has(z))if($.filterFunction.length)for(let X of $.filterFunction){let J=await X(Z);if(J)return J}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function k$($,z,Z,X){if(!$.filters.has(z))if($.filterFunction.length)for(let J of $.filterFunction){let Q=await J(Z,X);if(Q)return Q}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function X1($,z,Z){if($.staticPath){let J=await z$($,Z,z);if(J)return J;let Q=$.trie.search("*",z.req.method);if(Q?.handler)return await Q.handler(z)}return $.routeNotFoundFunc(z)||_(404,`Route not found for ${Z}`)}function _($,z){return new Response(JSON.stringify({error:z}),{status:$,headers:{"Content-Type":"application/json"}})}async function z$($,z,Z){if(!$.staticPath)return null;let X=`${$.staticPath}${z}`;if(await Bun.file(X).exists()){let Q=y(X);return Z.file(X,Q,200)}return null}var h=($)=>$.constructor.name==="AsyncFunction",J1=($,z,Z,...X)=>{if(z.length>5)$.push(`
      for (let i = 0; i < diesel.hooks.${Z}.length; i++) {
        const result = diesel.hooks.${Z}[i](${X});
        const finalResult = result instanceof Promise ? await result : result;
        if (finalResult && '${Z}' !== 'onRequest') return finalResult
    }
  `);else z?.forEach((J,Q)=>{if(h(J))$.push(`
            const ${Z}${Q}Result = await diesel.hooks.${Z}[${Q}](${X})
            if (${Z}${Q}Result && '${Z}' !== 'onRequest') return ${Z}${Q}Result
            `);else $.push(`
            const ${Z}${Q}Result = diesel.hooks.${Z}[${Q}](${X})
             if (${Z}${Q}Result && '${Z}' !== 'onRequest') return ${Z}${Q}Result
            `)})},X$=($)=>{$.push(`
    let pathname;
    const start = req.url.indexOf('/', req.url.indexOf(':') + 4);
    let i = start;
    for (; i < req.url.length; i++) {
        const charCode = req.url.charCodeAt(i);
        if (charCode === 37) { // percent-encoded
            const queryIndex = req.url.indexOf('?', i);
            const path = req.url.slice(start, queryIndex === -1 ? undefined : queryIndex);
            pathname = tryDecodeURI(path.includes('%25') ? path.replace(/%25/g, '%2525') : path);
            break;
        } else if (charCode === 63) { // ?
            break;
        }
    }
    if (!pathname) {
      pathname = req.url.slice(start, i);
    }
  `)},J$=($,z)=>{if(z.length<=5)for(let Z=0;Z<z.length;Z++)if(h(z[Z]))$.push(`
          const resultMiddleware${Z} = await globalMiddlewares[${Z}](ctx);
          if (resultMiddleware${Z}) return resultMiddleware${Z};
      `);else $.push(`
        const resultMiddleware${Z} = globalMiddlewares[${Z}](ctx);
        if (resultMiddleware${Z}) return resultMiddleware${Z};
    `);else $.push(`
    for (let i = 0; i < globalMiddlewares.length; i++) {
      const result = await globalMiddlewares[i](ctx);
      if (result) return result;
    }
  `)},l1=($,z)=>{let Z=[],X=z.globalMiddlewares||[],J=$?.hasOnReqHook?z.hooks.onRequest:[],Q=$?.hasPreHandlerHook?z.hooks.preHandler:[],Y=$?.hasOnSendHook?z.hooks.onSend:[];if(X$(Z),Z.push(`
      const routeHandler = diesel.trie.search(pathname, req.method);
    `),J&&J.length>0)J1(Z,J,"onRequest","req","pathname","server");if(Z.push(`
          const ctx = createCtx(req, server, pathname, routeHandler?.path);
    `),$?.hasMiddleware){if(X.length>0)J$(Z,X);if(z.middlewares.size>0)Z.push(`
      const local = diesel.middlewares.get(pathname)
      if (local && local.length) {
        for (const middleware of local) {
          const result = await middleware(ctx);
          if (result) return result;
        }
      }
        `)}if($.hasFilterEnabled)Z.push(`
        const filterResponse = await runFilter(diesel, pathname, ctx);
        if (filterResponse) return filterResponse;
      `);if(Z.push(`
      if (!routeHandler) return await handleRouteNotFound(diesel, ctx, pathname);
    `),$.hasPreHandlerHook)J1(Z,Q,"preHandler","ctx");if(Z.push(`
      const result = routeHandler.handler(ctx);
      const finalResult = result instanceof Promise ? await result : result;
    `),$.hasOnSendHook)J1(Z,Y,"onSend","ctx","finalResult");Z.push(`
      if (finalResult instanceof Response) return finalResult;
      return generateErrorResponse(500, "No response returned from handler.");
    `);let V=`
      return async function pipeline(req, server, diesel) {
          ${Z.join(`
`)}
      }
    `;return new Function("runFilter","handleRouteNotFound","generateErrorResponse","globalMiddlewares","createCtx",V)(z1,X1,_,X,P)},n1=($,z,Z,X,...J)=>{let Q=[],Y;if(typeof J[0]==="string"||typeof J[0]==="object")Y=J[0];let V=J,C=$?.hasMiddleware?z.globalMiddlewares:[],W=$?.hasMiddleware?z.middlewares.get(X)||[]:[],G=[...C,...W],K=$?.hasOnReqHook?z.hooks.onRequest:[],B=z.filters.has(X),U=z.filterFunction;if(K&&K?.length>0)Q.push(`
      const onRequestResult = await runHooks(
        "onRequest",
        onRequestHooks,
        [req, "${X}", server]
      );
      if (onRequestResult) return onRequestResult;
    `);if(G.length)Q.push(`
      const globalMiddlewareResponse = await executeBunMiddlewares(
        allMiddlewares,
        req,
        server
      );
      if (globalMiddlewareResponse) return globalMiddlewareResponse;
    `);if($.hasFilterEnabled){if(!B)Q.push(`if (${U.length}) {
        for (const filterFunction of filterFunctions) {
          const filterResult = await filterFunction(req, server);
          if (filterResult) return filterResult;
        }
      } else {
        return Response.json({ error: "Protected route, authentication required" }, { status: 401 });
      }`)}if(Q.push(`
            if ("${Z}" !== req.method)
        return new Response("Method Not Allowed", { status: 405 });
      `),typeof Y!=="undefined")if(typeof Y==="string")Q.push(`
        return new Response(${JSON.stringify(Y)});
      `);else{let H=JSON.stringify(Y);Q.push(`
        return new Response(${JSON.stringify(H)}, {
          headers: { "content-type": "application/json; charset=utf-8" }
        });
      `)}else if(V.length===1){let H=V[0];if(h(H))Q.push(`
        const response = await handlers[0](req, server);
        if (response instanceof Response) return response;
      `);else Q.push(`
        const response = handlers[0](req, server);
        if (response instanceof Response) return response;
      `)}else V.forEach((H,L)=>{if(h(H))Q.push(`
            const response${L} = await handlers[${L}](req, server);
            if (response${L} instanceof Response) return response${L};
        `);else Q.push(`
            const response${L} = handlers[${L}](req, server);
            if (response${L} instanceof Response) return response${L};
        `)});let F=`
    return async function(req, server) {
      ${Q.join(`
`)}
    }
  `;return new Function("executeBunMiddlewares","handlers","runHooks","filterFunctions","onRequestHooks","allMiddlewares",F)(p1,V,q,U,K,G)};n();var{default:W1}=(()=>({}));var N={reset:"\x1B[0m",info:"\x1B[36m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[34m",PUT:"\x1B[35m",DELETE:"\x1B[31m",PATCH:"\x1B[36m"}},Q1=($,z,Z)=>{let X=N[$]||N.reset,J=Z?.method?N.method[Z.method]||N.reset:N.reset,Q=Z?.status?Z.status>=500?N.error:Z.status>=400?N.warn:N.info:N.reset;console.log(`
${X}[${$.toUpperCase()}]${N.reset} ${z} - ${J}${Z?.method||""}${N.reset}`);let Y={timestamp:new Date().toISOString(),...Z,status:Z?.status?`${Q}${Z.status}${N.reset}`:void 0,method:Z?.method?`${J>X}${Z.method}${N.reset}`:void 0};console.log(JSON.stringify(Y,null,2)+`
`)},s1=($)=>{let{app:z,logger:Z,logLevel:X="info",onRequest:J,onSend:Q,onError:Y}=$||{};z?.addHooks("onRequest",(V,C)=>{V.startTime=Date.now(),Z?.()??Q1(X,"Incoming Request",{method:V.method,url:C,headers:{"user-agent":V.headers.get("user-agent"),"content-type":V.headers.get("content-type")}}),J?.(V,C)}),z?.addHooks("onSend",async(V,C)=>{let W=`${Date.now()-V.req.startTime}ms`;Z?.()??Q1(X,"Response Sent",{method:V.req.method,url:V.url.toString(),status:C.status,duration:W,reqId:V.get?.("requestId"),headers:{"content-type":C.headers.get("content-type")}});let G=await Q?.(V);if(G instanceof Response)return G}),z?.addHooks("onError",async(V,C,W)=>{Z?.()??Q1("error","Unhandled Error",{method:C.method,url:W,status:500,error:V.message});let G=await Y?.(V,C,W);if(G instanceof Response)return G})},Y1=($,z,Z,X=0,J,Q)=>{let Y=N.method[z]||N.reset,V=X>=500?N.error:X>=400?N.warn:N.info,C=Q?`[${Q}] `:"",W=$==="<--"?`${$} ${Y}${z}${N.reset} ${Z} ${C}`:`${$} ${Y}${z}${N.reset} ${Z} ${V}${X}${N.reset} ${J??""} ${C}`;console.log(W)},Q$=($)=>{let z=Date.now()-$;return z<1000?`${z}ms`:`${Math.round(z/1000)}s`},r1=($)=>{let{app:z,log:Z,onRequest:X,onSend:J,onError:Q}=$;z.addHooks("onRequest",(Y,V)=>{Y.startTime=Date.now(),Z?.()??Y1("<--",Y.method,V),X?.(Y,V)}),z.addHooks("onSend",async(Y,V)=>{let{method:C,url:W}=Y.req,G=new URL(W).pathname,K=Y.get?.("requestId");Z?.()??Y1("-->",C,G,V.status,Q$(Y.req.startTime),K);let B=await J?.(Y);if(B instanceof Response)return B}),z.addHooks("onError",async(Y,V,C)=>{Z?.()??Y1(Y.message,V.method,C,500);let W=await Q?.(Y,V,C);if(W instanceof Response)return W})};function a1($,z){if(!$)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(Z)=>{try{let X=Z.cookies?.accessToken??Z.req?.headers?.get("Authorization");if(!X)return Z.json({message:"Unauthorized",error:"No token provided"},401);if(X.startsWith("Bearer "))X=X.slice(7);let J=$?.verify(X,z);if(!J)return Z.json({message:"Unauthorized",error:"Token could not be decoded"},401);Z.set("user",J)}catch(X){let J="Invalid token";if(X.name==="TokenExpiredError")J="Token expired";else if(X.name==="JsonWebTokenError")J="Malformed or tampered token";return Z.json({message:"Unauthorized",error:J},401)}}}function t1($,z,Z){if(!$)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!z)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(X)=>{try{let J=X.cookies?.accessToken??X.req?.headers?.get("Authorization");if(!J)return X.json({message:"Unauthorized",error:"No token provided"},401);if(J.startsWith("Bearer "))J=J.slice(7);let Q=$?.verify(J,Z);if(!Q)return X.json({message:"Unauthorized",error:"Token could not be decoded"},401);let Y=await z.findById(Q._id).select("-password -refreshToken");if(!Y)return X.json({message:"Unauthorized: User not found"},404);X.set("user",Y);return}catch(J){let Q="Invalid token";if(J.name==="TokenExpiredError")Q="Token expired";else if(J.name==="JsonWebTokenError")Q="Malformed or tampered token";return X.json({message:"Unauthorized",error:Q},401)}}}var G1=Symbol.for,M=Symbol("kCapture"),z0=G1("events.errorMonitor"),Y$=Symbol("events.maxEventTargetListeners"),V$=Symbol("events.maxEventTargetListenersWarned"),e1=G1("nodejs.rejection"),G$=G1("nodejs.rejection"),$0=Array.prototype.slice,w=10,O=function $(z){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[M]=z?.captureRejections?Boolean(z?.captureRejections):D[M])this.emit=B$},D=O.prototype={};D._events=void 0;D._eventsCount=0;D._maxListeners=void 0;D.setMaxListeners=function $(z){return C1(z,"setMaxListeners",0),this._maxListeners=z,this};D.constructor=O;D.getMaxListeners=function $(){return this?._maxListeners??w};function X0($,z){var{_events:Z}=$;if(z[0]??=new Error("Unhandled error."),!Z)throw z[0];var X=Z[z0];if(X)for(var J of $0.call(X))J.apply($,z);var Q=Z.error;if(!Q)throw z[0];for(var J of $0.call(Q))J.apply($,z);return!0}function C$($,z,Z,X){z.then(void 0,function(J){queueMicrotask(()=>W$($,J,Z,X))})}function W$($,z,Z,X){if(typeof $[e1]==="function")$[e1](z,Z,...X);else try{$[M]=!1,$.emit("error",z)}finally{$[M]=!0}}var K$=function $(z,...Z){if(z==="error")return X0(this,Z);var{_events:X}=this;if(X===void 0)return!1;var J=X[z];if(J===void 0)return!1;let Q=J.length>1?J.slice():J;for(let Y=0,{length:V}=Q;Y<V;Y++){let C=Q[Y];switch(Z.length){case 0:C.call(this);break;case 1:C.call(this,Z[0]);break;case 2:C.call(this,Z[0],Z[1]);break;case 3:C.call(this,Z[0],Z[1],Z[2]);break;default:C.apply(this,Z);break}}return!0},B$=function $(z,...Z){if(z==="error")return X0(this,Z);var{_events:X}=this;if(X===void 0)return!1;var J=X[z];if(J===void 0)return!1;let Q=J.length>1?J.slice():J;for(let Y=0,{length:V}=Q;Y<V;Y++){let C=Q[Y],W;switch(Z.length){case 0:W=C.call(this);break;case 1:W=C.call(this,Z[0]);break;case 2:W=C.call(this,Z[0],Z[1]);break;case 3:W=C.call(this,Z[0],Z[1],Z[2]);break;default:W=C.apply(this,Z);break}if(W!==void 0&&typeof W?.then==="function"&&W.then===Promise.prototype.then)C$(this,W,z,Z)}return!0};D.emit=K$;D.addListener=function $(z,Z){v(Z);var X=this._events;if(!X)X=this._events={__proto__:null},this._eventsCount=0;else if(X.newListener)this.emit("newListener",z,Z.listener??Z);var J=X[z];if(!J)X[z]=[Z],this._eventsCount++;else{J.push(Z);var Q=this._maxListeners??w;if(Q>0&&J.length>Q&&!J.warned)J0(this,z,J)}return this};D.on=D.addListener;D.prependListener=function $(z,Z){v(Z);var X=this._events;if(!X)X=this._events={__proto__:null},this._eventsCount=0;else if(X.newListener)this.emit("newListener",z,Z.listener??Z);var J=X[z];if(!J)X[z]=[Z],this._eventsCount++;else{J.unshift(Z);var Q=this._maxListeners??w;if(Q>0&&J.length>Q&&!J.warned)J0(this,z,J)}return this};function J0($,z,Z){Z.warned=!0;let X=new Error(`Possible EventEmitter memory leak detected. ${Z.length} ${String(z)} listeners added to [${$.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);X.name="MaxListenersExceededWarning",X.emitter=$,X.type=z,X.count=Z.length,console.warn(X)}function Q0($,z,...Z){this.removeListener($,z),z.apply(this,Z)}D.once=function $(z,Z){v(Z);let X=Q0.bind(this,z,Z);return X.listener=Z,this.addListener(z,X),this};D.prependOnceListener=function $(z,Z){v(Z);let X=Q0.bind(this,z,Z);return X.listener=Z,this.prependListener(z,X),this};D.removeListener=function $(z,Z){v(Z);var{_events:X}=this;if(!X)return this;var J=X[z];if(!J)return this;var Q=J.length;let Y=-1;for(let V=Q-1;V>=0;V--)if(J[V]===Z||J[V].listener===Z){Y=V;break}if(Y<0)return this;if(Y===0)J.shift();else J.splice(Y,1);if(J.length===0)delete X[z],this._eventsCount--;return this};D.off=D.removeListener;D.removeAllListeners=function $(z){var{_events:Z}=this;if(z&&Z){if(Z[z])delete Z[z],this._eventsCount--}else this._events={__proto__:null};return this};D.listeners=function $(z){var{_events:Z}=this;if(!Z)return[];var X=Z[z];if(!X)return[];return X.map((J)=>J.listener??J)};D.rawListeners=function $(z){var{_events:Z}=this;if(!Z)return[];var X=Z[z];if(!X)return[];return X.slice()};D.listenerCount=function $(z){var{_events:Z}=this;if(!Z)return 0;return Z[z]?.length??0};D.eventNames=function $(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};D[M]=!1;function U$($,z,Z){var X=Z?.signal;if(Y0(X,"options.signal"),X?.aborted)throw new V1(void 0,{cause:X?.reason});let{resolve:J,reject:Q,promise:Y}=$newPromiseCapability(Promise),V=(G)=>{if($.removeListener(z,C),X!=null)d(X,"abort",W);Q(G)},C=(...G)=>{if(typeof $.removeListener==="function")$.removeListener("error",V);if(X!=null)d(X,"abort",W);J(G)};if(Z0($,z,C,{once:!0}),z!=="error"&&typeof $.once==="function")$.once("error",V);function W(){d($,z,C),d($,"error",V),Q(new V1(void 0,{cause:X?.reason}))}if(X!=null)Z0(X,"abort",W,{once:!0});return Y}function D$($,z){return $.listeners(z)}function A$($,...z){C1($,"setMaxListeners",0);var Z;if(z&&(Z=z.length))for(let X=0;X<Z;X++)z[X].setMaxListeners($);else w=$}function N$($,z){return $.listenerCount(z)}function d($,z,Z,X){if(typeof $.removeListener==="function")$.removeListener(z,Z);else $.removeEventListener(z,Z,X)}function Z0($,z,Z,X){if(typeof $.on==="function")if(X.once)$.once(z,Z);else $.on(z,Z);else $.addEventListener(z,Z,X)}class V1 extends Error{constructor($="The operation was aborted",z=void 0){if(z!==void 0&&typeof z!=="object")throw f("options","Object",z);super($,z);this.code="ABORT_ERR",this.name="AbortError"}}function f($,z,Z){let X=new TypeError(`The "${$}" argument must be of type ${z}. Received ${Z}`);return X.code="ERR_INVALID_ARG_TYPE",X}function F$($,z,Z){let X=new RangeError(`The "${$}" argument is out of range. It must be ${z}. Received ${Z}`);return X.code="ERR_OUT_OF_RANGE",X}function Y0($,z){if($!==void 0&&($===null||typeof $!=="object"||!("aborted"in $)))throw f(z,"AbortSignal",$)}function C1($,z,Z,X){if(typeof $!=="number")throw f(z,"number",$);if(Z!=null&&$<Z||X!=null&&$>X||(Z!=null||X!=null)&&Number.isNaN($))throw F$(z,`${Z!=null?`>= ${Z}`:""}${Z!=null&&X!=null?" && ":""}${X!=null?`<= ${X}`:""}`,$)}function v($){if(typeof $!=="function")throw new TypeError("The listener must be a function")}function S$($,z){if(typeof $!=="boolean")throw f(z,"boolean",$)}function L$($){return $?._maxListeners??w}function j$($,z){if($===void 0)throw f("signal","AbortSignal",$);if(Y0($,"signal"),typeof z!=="function")throw f("listener","function",z);let Z;if($.aborted)queueMicrotask(()=>z());else $.addEventListener("abort",z,{__proto__:null,once:!0}),Z=()=>{$.removeEventListener("abort",z)};return{__proto__:null,[Symbol.dispose](){Z?.()}}}Object.defineProperties(O,{captureRejections:{get(){return D[M]},set($){S$($,"EventEmitter.captureRejections"),D[M]=$},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return w},set:($)=>{C1($,"defaultMaxListeners",0),w=$}},kMaxEventTargetListeners:{value:Y$,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:V$,enumerable:!1,configurable:!1,writable:!1}});Object.assign(O,{once:U$,getEventListeners:D$,getMaxListeners:L$,setMaxListeners:A$,EventEmitter:O,usingDomains:!1,captureRejectionSymbol:G$,errorMonitor:z0,addAbortListener:j$,init:O,listenerCount:N$});class g{emitter;static instance;fecth;routes;tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;idleTimeOut;routeNotFoundFunc;prefixApiUrl;compileConfig;constructor({jwtSecret:$,baseApiUrl:z,enableFileRouting:Z,idleTimeOut:X,prefixApiUrl:J,onError:Q,logger:Y}={}){if(!g.instance)g.instance=this;if(this.emitter=new O,this.prefixApiUrl=J??"",this.fetch=this.fetch.bind(this),this.routes={},this.idleTimeOut=X??10,this.enableFileRouter=Z??!1,this.baseApiUrl=z||"",this.user_jwt_secret=$||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new x,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:[],preHandler:[],postHandler:[],onSend:[],onError:[],onClose:[]},Q)this.addHooks("onError",(V)=>{return console.log("got an exception ",V),new Response(JSON.stringify({error:V?.message??V,stack:V.stack}),{headers:{"Content-Type":"application/json"},status:500})});if(Y)this.useLogger({app:this,onError(V){return console.log("got an exception ",V),new Response(JSON.stringify({error:V?.message||V,stack:V.stack}),{headers:{"Content-Type":"application/json"},status:500})}});this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={},this.routeNotFoundFunc=()=>{},this.compileConfig=null}static router($){if(!this.instance)this.instance=new g;return new Proxy(this.instance,{get(z,Z,X){return(J,Q)=>{let Y=$+J;return z[Z](Y,Q)}}})}setupFilter(){return this.hasFilterEnabled=!0,{publicRoutes:(...$)=>{return this.FilterRoutes=$,this.setupFilter()},permitAll:()=>{for(let $ of this?.FilterRoutes){if($.endsWith("/"))$=$.slice(0,-1);this.filters.add($)}return this.FilterRoutes=null,this.setupFilter()},authenticate:($)=>{if($?.length)for(let z of $)this.filterFunction.push(z)},authenticateJwt:($)=>{this.filterFunction.push(a1($,this.user_jwt_secret))},authenticateJwtDB:($,z)=>{this.filterFunction.push(t1($,z,this.user_jwt_secret))}}}redirect($,z,Z){return this.any($,(X)=>{let J=X.params,Q=z;if(J)for(let V in J)Q=Q.replace(`:${V}`,J[V]);let Y=X.url.search;if(Y)Q+=Y;return X.redirect(Q,Z)}),this}serveStatic($){return this.staticPath=$,this}static($){return this.staticPath=$,this}staticHtml($){return this.staticFiles={...this.staticFiles,...$},this}addHooks($,z){if(typeof $!=="string")throw new Error("hookName must be a string");if(typeof z!=="function")throw new Error("callback must be a instance of function");switch($){case"onRequest":this.hooks.onRequest?.push(z);break;case"preHandler":this.hooks.preHandler?.push(z);break;case"postHandler":this.hooks.postHandler?.push(z);break;case"onSend":this.hooks.onSend?.push(z);break;case"onError":this.hooks.onError?.push(z);break;case"onClose":this.hooks.onClose?.push(z);break;default:throw new Error(`Unknown hook type: ${$}`)}return this}compile(){let $={hasMiddleware:!1,hasOnReqHook:!1,hasPreHandlerHook:!1,hasOnError:!1,hasPostHandlerHook:!1,hasOnSendHook:!1,hasFilterEnabled:!1};if(this.hasFilterEnabled)$.hasFilterEnabled=!0,this.hasFilterEnabled=!0;if(this?.globalMiddlewares?.length>0)$.hasMiddleware=!0,this.hasMiddleware=!0;for(let[z,Z]of this?.middlewares?.entries())if(Z.length>0){$.hasMiddleware=!0,this.hasMiddleware=!0;break}if(this?.enableFileRouter){let z=process.cwd(),Z=I.join(z,"src","routes");if(W1?.existsSync(Z))this.loadRoutes(Z,"")}if(this?.hooks?.onRequest&&this.hooks.onRequest.length>0)$.hasOnReqHook=!0,this.hasOnReqHook=!0;if(this?.hooks?.preHandler&&this.hooks.preHandler.length>0)$.hasPreHandlerHook=!0,this.hasPreHandlerHook=!0;if(this?.hooks?.postHandler&&this.hooks.postHandler?.length>0)$.hasPostHandlerHook=!0,this.hasPostHandlerHook=!0;if(this?.hooks?.onSend&&this.hooks.onSend?.length>0)$.hasOnSendHook=!0,this.hasOnSendHook=!0;if(this?.hooks?.onError&&this.hooks.onError?.length>0)$.hasOnError=!0,this.hasOnError=!0;return setTimeout(()=>{this.tempRoutes=null},2000),this.compileConfig=$,$}async registerFileRoutes($,z,Z){let X=await import($),J;if(Z===".ts")J=I.basename($,".ts");else if(Z===".js")J=I.basename($,".js");let Q=z+"/"+J;if(Q.endsWith("/index"))Q=z;else if(Q.endsWith("/api"))Q=z;Q=Q.replace(/\[(.*?)\]/g,":$1");let Y=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let V of Y)if(X[V]){let C=V.toLowerCase(),W=X[V];this[C](`${this.baseApiUrl}${Q}`,W)}}async loadRoutes($,z){let Z=await W1.promises.readdir($);for(let X of Z){let J=I.join($,X);if((await W1.promises.stat(J)).isDirectory())await this.loadRoutes(J,z+"/"+X);else if(X.endsWith(".ts"))await this.registerFileRoutes(J,z,".ts");else if(X.endsWith(".js"))await this.registerFileRoutes(J,z,".js")}}useLogger($){return r1($),this}useAdvancedLogger($){return s1($),this}BunRoute($,z,...Z){if(!z||typeof z!=="string")throw new Error("give a path in string format");if(!this.compileConfig)this.compile();let X;if(typeof Z[0]==="string"||typeof Z[0]==="object")X=Z[0];if(typeof X!=="undefined"){let Q=typeof X==="string"?X:JSON.stringify(X)}let J=n1(this.compileConfig,this,$.toUpperCase(),z,...Z);return this.routes[z]=J,this}listen($,...z){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let Z="0.0.0.0",X=void 0,J={};for(let Y of z)if(typeof Y==="string")Z=Y;else if(typeof Y==="function")X=Y;else if(typeof Y==="object"&&Y!==null)J=Y;let Q={port:$,hostname:Z,idleTimeOut:this.idleTimeOut,fetch:this.fetch(),static:this.staticFiles};if(this.routes&&Object.keys(this.routes).length>0)Q.routes=this.routes;if(J.cert&&J.key)Q.certFile=J.cert,Q.keyFile=J.key;if(this.serverInstance=Bun?.serve(Q),X)X();return this.serverInstance}fetch(){let $=this.compile(),z=l1($,this);return async(Z,X)=>{return z(Z,X,this).catch(async(J)=>{return console.error("Unhandled handler error:",J),await q("onError",this.hooks.onError,[J,Z,i1(Z.url),X])||_(500,"Internal Server Error")})}}close($){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,$?$():console.log("Server has been stopped");else console.warn("Server is not running.")}route($,z){$=$&&$.length>0?$:z?.prefixApiUrl;let Z=z?.tempRoutes??new Map;for(let[X,J]of Z.entries()){let Q=X.replace(/::\w+$/,""),Y=`${$}${Q}`;if(!this.middlewares.has(Y))this.middlewares.set(Y,[]);J.handlers.slice(0,-1).forEach((G)=>{let K=this.middlewares.get(Y);if(!K.includes(G))K.push(G)});let C=J.handlers[J.handlers.length-1],W=J.method;try{this.trie.insert(Y,{handler:C,method:W})}catch(G){console.error(`Error inserting ${Y}:`,G)}}return z=null,this}register($,z){return this.route($,z)}addRoute($,z,Z){if(typeof z!=="string")throw new Error(`Error in ${Z[Z.length-1]}: Path must be a string. Received: ${typeof z}`);if(typeof $!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof $}`);this.tempRoutes?.set(z+"::"+$,{method:$,handlers:Z});let X=Z.slice(0,-1),J=Z[Z.length-1];if(X.length>0){if(!this.middlewares.has(z))this.middlewares.set(z,[]);X.forEach((Q)=>{if(z==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...X])];else if(!this.middlewares.get(z)?.includes(Q))this.middlewares.get(z)?.push(Q)})}try{if($==="ANY"){let Q=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let Y of Q)this.trie.insert(z,{handler:J,method:Y})}this.trie.insert(z,{handler:J,method:$})}catch(Q){console.error(`Error inserting ${z}:`,Q)}}use($,z){if(Array.isArray($))$.forEach((X)=>{if(typeof X==="function")this.globalMiddlewares.push(X)});if(typeof $==="function"){if(this.globalMiddlewares.push($),Array.isArray(z))z.forEach((X)=>{this.globalMiddlewares.push(X)});return this}return(Array.isArray($)?$.filter((X)=>typeof X==="string"):[$].filter((X)=>typeof X==="string")).forEach((X)=>{if(!this.middlewares.has(X))this.middlewares.set(X,[]);if(z)(Array.isArray(z)?z:[z]).forEach((Q)=>{this.middlewares.get(X)?.push(Q)})}),this}get($,...z){return this.addRoute("GET",$,z),this}post($,...z){return this.addRoute("POST",$,z),this}put($,...z){return this.addRoute("PUT",$,z),this}patch($,...z){return this.addRoute("PATCH",$,z),this}delete($,...z){return this.addRoute("DELETE",$,z),this}any($,...z){return this.addRoute("ANY",$,z),this}head($,...z){return this.addRoute("HEAD",$,z),this}options($,...z){return this.addRoute("OPTIONS",$,z),this}propfind($,...z){return this.addRoute("PROPFIND",$,z),this}routeNotFound($){return this.routeNotFoundFunc=$,this}on($,z){this.emitter.on($,z)}emit($,...z){this.emitter.emit($,...z)}}export{g as default};
