var f0=Object.create;var{getPrototypeOf:F0,defineProperty:b,getOwnPropertyNames:F1,getOwnPropertyDescriptor:U0}=Object,U1=Object.prototype.hasOwnProperty;var D0=($,z,Z)=>{Z=$!=null?f0(F0($)):{};let J=z||!$||!$.__esModule?b(Z,"default",{value:$,enumerable:!0}):Z;for(let X of F1($))if(!U1.call(J,X))b(J,X,{get:()=>$[X],enumerable:!0});return J},f1=new WeakMap,N0=($)=>{var z=f1.get($),Z;if(z)return z;if(z=b({},"__esModule",{value:!0}),$&&typeof $==="object"||typeof $==="function")F1($).map((J)=>!U1.call(z,J)&&b(z,J,{get:()=>$[J],enumerable:!(Z=U0($,J))||Z.enumerable}));return f1.set($,z),z},s=($,z)=>()=>(z||$((z={exports:{}}).exports,z),z.exports);var A0=($,z)=>{for(var Z in z)b($,Z,{get:z[Z],enumerable:!0,configurable:!0,set:(J)=>z[Z]=()=>J})};var w0=($,z)=>()=>($&&(z=$($=0)),z);var S0=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(z,Z)=>(typeof require!=="undefined"?require:z)[Z]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var T1={};A0(T1,{sep:()=>q1,resolve:()=>y,relative:()=>w1,posix:()=>I1,parse:()=>O1,normalize:()=>r,join:()=>A1,isAbsolute:()=>N1,format:()=>M1,extname:()=>H1,dirname:()=>L1,delimiter:()=>R1,default:()=>R,basename:()=>j1,_makeLong:()=>S1});function S($){if(typeof $!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify($))}function D1($,z){var Z="",J=0,X=-1,Q=0,Y;for(var C=0;C<=$.length;++C){if(C<$.length)Y=$.charCodeAt(C);else if(Y===47)break;else Y=47;if(Y===47){if(X===C-1||Q===1);else if(X!==C-1&&Q===2){if(Z.length<2||J!==2||Z.charCodeAt(Z.length-1)!==46||Z.charCodeAt(Z.length-2)!==46){if(Z.length>2){var B=Z.lastIndexOf("/");if(B!==Z.length-1){if(B===-1)Z="",J=0;else Z=Z.slice(0,B),J=Z.length-1-Z.lastIndexOf("/");X=C,Q=0;continue}}else if(Z.length===2||Z.length===1){Z="",J=0,X=C,Q=0;continue}}if(z){if(Z.length>0)Z+="/..";else Z="..";J=2}}else{if(Z.length>0)Z+="/"+$.slice(X+1,C);else Z=$.slice(X+1,C);J=C-X-1}X=C,Q=0}else if(Y===46&&Q!==-1)++Q;else Q=-1}return Z}function L0($,z){var Z=z.dir||z.root,J=z.base||(z.name||"")+(z.ext||"");if(!Z)return J;if(Z===z.root)return Z+J;return Z+$+J}function y(){var $="",z=!1,Z;for(var J=arguments.length-1;J>=-1&&!z;J--){var X;if(J>=0)X=arguments[J];else{if(Z===void 0)Z=process.cwd();X=Z}if(S(X),X.length===0)continue;$=X+"/"+$,z=X.charCodeAt(0)===47}if($=D1($,!z),z)if($.length>0)return"/"+$;else return"/";else if($.length>0)return $;else return"."}function r($){if(S($),$.length===0)return".";var z=$.charCodeAt(0)===47,Z=$.charCodeAt($.length-1)===47;if($=D1($,!z),$.length===0&&!z)$=".";if($.length>0&&Z)$+="/";if(z)return"/"+$;return $}function N1($){return S($),$.length>0&&$.charCodeAt(0)===47}function A1(){if(arguments.length===0)return".";var $;for(var z=0;z<arguments.length;++z){var Z=arguments[z];if(S(Z),Z.length>0)if($===void 0)$=Z;else $+="/"+Z}if($===void 0)return".";return r($)}function w1($,z){if(S($),S(z),$===z)return"";if($=y($),z=y(z),$===z)return"";var Z=1;for(;Z<$.length;++Z)if($.charCodeAt(Z)!==47)break;var J=$.length,X=J-Z,Q=1;for(;Q<z.length;++Q)if(z.charCodeAt(Q)!==47)break;var Y=z.length,C=Y-Q,B=X<C?X:C,G=-1,V=0;for(;V<=B;++V){if(V===B){if(C>B){if(z.charCodeAt(Q+V)===47)return z.slice(Q+V+1);else if(V===0)return z.slice(Q+V)}else if(X>B){if($.charCodeAt(Z+V)===47)G=V;else if(V===0)G=0}break}var W=$.charCodeAt(Z+V),K=z.charCodeAt(Q+V);if(W!==K)break;else if(W===47)G=V}var f="";for(V=Z+G+1;V<=J;++V)if(V===J||$.charCodeAt(V)===47)if(f.length===0)f+="..";else f+="/..";if(f.length>0)return f+z.slice(Q+G);else{if(Q+=G,z.charCodeAt(Q)===47)++Q;return z.slice(Q)}}function S1($){return $}function L1($){if(S($),$.length===0)return".";var z=$.charCodeAt(0),Z=z===47,J=-1,X=!0;for(var Q=$.length-1;Q>=1;--Q)if(z=$.charCodeAt(Q),z===47){if(!X){J=Q;break}}else X=!1;if(J===-1)return Z?"/":".";if(Z&&J===1)return"//";return $.slice(0,J)}function j1($,z){if(z!==void 0&&typeof z!=="string")throw new TypeError('"ext" argument must be a string');S($);var Z=0,J=-1,X=!0,Q;if(z!==void 0&&z.length>0&&z.length<=$.length){if(z.length===$.length&&z===$)return"";var Y=z.length-1,C=-1;for(Q=$.length-1;Q>=0;--Q){var B=$.charCodeAt(Q);if(B===47){if(!X){Z=Q+1;break}}else{if(C===-1)X=!1,C=Q+1;if(Y>=0)if(B===z.charCodeAt(Y)){if(--Y===-1)J=Q}else Y=-1,J=C}}if(Z===J)J=C;else if(J===-1)J=$.length;return $.slice(Z,J)}else{for(Q=$.length-1;Q>=0;--Q)if($.charCodeAt(Q)===47){if(!X){Z=Q+1;break}}else if(J===-1)X=!1,J=Q+1;if(J===-1)return"";return $.slice(Z,J)}}function H1($){S($);var z=-1,Z=0,J=-1,X=!0,Q=0;for(var Y=$.length-1;Y>=0;--Y){var C=$.charCodeAt(Y);if(C===47){if(!X){Z=Y+1;break}continue}if(J===-1)X=!1,J=Y+1;if(C===46){if(z===-1)z=Y;else if(Q!==1)Q=1}else if(z!==-1)Q=-1}if(z===-1||J===-1||Q===0||Q===1&&z===J-1&&z===Z+1)return"";return $.slice(z,J)}function M1($){if($===null||typeof $!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof $);return L0("/",$)}function O1($){S($);var z={root:"",dir:"",base:"",ext:"",name:""};if($.length===0)return z;var Z=$.charCodeAt(0),J=Z===47,X;if(J)z.root="/",X=1;else X=0;var Q=-1,Y=0,C=-1,B=!0,G=$.length-1,V=0;for(;G>=X;--G){if(Z=$.charCodeAt(G),Z===47){if(!B){Y=G+1;break}continue}if(C===-1)B=!1,C=G+1;if(Z===46){if(Q===-1)Q=G;else if(V!==1)V=1}else if(Q!==-1)V=-1}if(Q===-1||C===-1||V===0||V===1&&Q===C-1&&Q===Y+1){if(C!==-1)if(Y===0&&J)z.base=z.name=$.slice(1,C);else z.base=z.name=$.slice(Y,C)}else{if(Y===0&&J)z.name=$.slice(1,Q),z.base=$.slice(1,C);else z.name=$.slice(Y,Q),z.base=$.slice(Y,C);z.ext=$.slice(Q,C)}if(Y>0)z.dir=$.slice(0,Y-1);else if(J)z.dir="/";return z}var q1="/",R1=":",I1,R;var a=w0(()=>{I1=(($)=>($.posix=$,$))({resolve:y,normalize:r,isAbsolute:N1,join:A1,relative:w1,_makeLong:S1,dirname:L1,basename:j1,extname:H1,format:M1,parse:O1,sep:q1,delimiter:R1,win32:null,posix:null}),R=I1});var E1=s((I0)=>{var j0=/[|\\{}()[\]^$+*?.]/g,H0=Object.prototype.hasOwnProperty,e=function($,z){return H0.apply($,[z])};I0.escapeRegExpChars=function($){if(!$)return"";return String($).replace(j0,"\\$&")};var M0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},O0=/[&<>'"]/g;function q0($){return M0[$]||$}var R0=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;I0.escapeXML=function($){return $==null?"":String($).replace(O0,q0)};function b1(){return Function.prototype.toString.call(this)+`;
`+R0}try{if(typeof Object.defineProperty==="function")Object.defineProperty(I0.escapeXML,"toString",{value:b1});else I0.escapeXML.toString=b1}catch($){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}I0.shallowCopy=function($,z){if(z=z||{},$!==null&&$!==void 0)for(var Z in z){if(!e(z,Z))continue;if(Z==="__proto__"||Z==="constructor")continue;$[Z]=z[Z]}return $};I0.shallowCopyFromList=function($,z,Z){if(Z=Z||[],z=z||{},$!==null&&$!==void 0)for(var J=0;J<Z.length;J++){var X=Z[J];if(typeof z[X]!="undefined"){if(!e(z,X))continue;if(X==="__proto__"||X==="constructor")continue;$[X]=z[X]}}return $};I0.cache={_data:{},set:function($,z){this._data[$]=z},get:function($){return this._data[$]},remove:function($){delete this._data[$]},reset:function(){this._data={}}};I0.hyphenToCamel=function($){return $.replace(/-[a-z]/g,function(z){return z[1].toUpperCase()})};I0.createNullProtoObjWherePossible=function(){if(typeof Object.create=="function")return function(){return Object.create(null)};if(!({__proto__:null}instanceof Object))return function(){return{__proto__:null}};return function(){return{}}}();I0.hasOwnOnlyObject=function($){var z=I0.createNullProtoObjWherePossible();for(var Z in $)if(e($,Z))z[Z]=$[Z];return z}});var P1=s((q4,v0)=>{v0.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.10",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^4.0.2","lru-cache":"^4.0.1",mocha:"^10.2.0","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"npx jake test"}}});var o1=s((h1)=>{var z1=(()=>({})),E=(a(),N0(T1)),U=E1(),g1=!1,x0=P1().version,k0="<",c0=">",y0="%",u1="locals",u0="ejs",m0="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",m1=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],h0=m1.concat("cache"),v1=/^\uFEFF/,$1=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;h1.cache=U.cache;h1.fileLoader=z1.readFileSync;h1.localsName=u1;h1.promiseImpl=new Function("return this;")().Promise;h1.resolveInclude=function($,z,Z){var{dirname:J,extname:X,resolve:Q}=E,Y=Q(Z?z:J(z),$),C=X($);if(!C)Y+=".ejs";return Y};function x1($,z){var Z;if(z.some(function(J){return Z=h1.resolveInclude($,J,!0),z1.existsSync(Z)}))return Z}function d0($,z){var Z,J,X=z.views,Q=/^[A-Za-z]+:\\|^\//.exec($);if(Q&&Q.length)if($=$.replace(/^\/*/,""),Array.isArray(z.root))Z=x1($,z.root);else Z=h1.resolveInclude($,z.root||"/",!0);else{if(z.filename){if(J=h1.resolveInclude($,z.filename),z1.existsSync(J))Z=J}if(!Z&&Array.isArray(X))Z=x1($,X);if(!Z&&typeof z.includer!=="function")throw new Error('Could not find the include file "'+z.escapeFunction($)+'"')}return Z}function P($,z){var Z,J=$.filename,X=arguments.length>1;if($.cache){if(!J)throw new Error("cache option requires a filename");if(Z=h1.cache.get(J),Z)return Z;if(!X)z=k1(J).toString().replace(v1,"")}else if(!X){if(!J)throw new Error("Internal EJS error: no file name or template provided");z=k1(J).toString().replace(v1,"")}if(Z=h1.compile(z,$),$.cache)h1.cache.set(J,Z);return Z}function i0($,z,Z){var J;if(!Z)if(typeof h1.promiseImpl=="function")return new h1.promiseImpl(function(X,Q){try{J=P($)(z),X(J)}catch(Y){Q(Y)}});else throw new Error("Please provide a callback function");else{try{J=P($)(z)}catch(X){return Z(X)}Z(null,J)}}function k1($){return h1.fileLoader($)}function l0($,z){var Z=U.shallowCopy(U.createNullProtoObjWherePossible(),z);if(Z.filename=d0($,Z),typeof z.includer==="function"){var J=z.includer($,Z.filename);if(J){if(J.filename)Z.filename=J.filename;if(J.template)return P(Z,J.template)}}return P(Z)}function c1($,z,Z,J,X){var Q=z.split(`
`),Y=Math.max(J-3,0),C=Math.min(Q.length,J+3),B=X(Z),G=Q.slice(Y,C).map(function(V,W){var K=W+Y+1;return(K==J?" >> ":"    ")+K+"| "+V}).join(`
`);throw $.path=B,$.message=(B||"ejs")+":"+J+`
`+G+`

`+$.message,$}function y1($){return $.replace(/;(\s*$)/,"$1")}h1.compile=function $(z,Z){var J;if(Z&&Z.scope){if(!g1)console.warn("`scope` option is deprecated and will be removed in EJS 3"),g1=!0;if(!Z.context)Z.context=Z.scope;delete Z.scope}return J=new A(z,Z),J.compile()};h1.render=function($,z,Z){var J=z||U.createNullProtoObjWherePossible(),X=Z||U.createNullProtoObjWherePossible();if(arguments.length==2)U.shallowCopyFromList(X,J,m1);return P(X,$)(J)};h1.renderFile=function(){var $=Array.prototype.slice.call(arguments),z=$.shift(),Z,J={filename:z},X,Q;if(typeof arguments[arguments.length-1]=="function")Z=$.pop();if($.length){if(X=$.shift(),$.length)U.shallowCopy(J,$.pop());else{if(X.settings){if(X.settings.views)J.views=X.settings.views;if(X.settings["view cache"])J.cache=!0;if(Q=X.settings["view options"],Q)U.shallowCopy(J,Q)}U.shallowCopyFromList(J,X,h0)}J.filename=z}else X=U.createNullProtoObjWherePossible();return i0(J,X,Z)};h1.Template=A;h1.clearCache=function(){h1.cache.reset()};function A($,z){var Z=U.hasOwnOnlyObject(z),J=U.createNullProtoObjWherePossible();if(this.templateText=$,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",J.client=Z.client||!1,J.escapeFunction=Z.escape||Z.escapeFunction||U.escapeXML,J.compileDebug=Z.compileDebug!==!1,J.debug=!!Z.debug,J.filename=Z.filename,J.openDelimiter=Z.openDelimiter||h1.openDelimiter||k0,J.closeDelimiter=Z.closeDelimiter||h1.closeDelimiter||c0,J.delimiter=Z.delimiter||h1.delimiter||y0,J.strict=Z.strict||!1,J.context=Z.context,J.cache=Z.cache||!1,J.rmWhitespace=Z.rmWhitespace,J.root=Z.root,J.includer=Z.includer,J.outputFunctionName=Z.outputFunctionName,J.localsName=Z.localsName||h1.localsName||u1,J.views=Z.views,J.async=Z.async,J.destructuredLocals=Z.destructuredLocals,J.legacyInclude=typeof Z.legacyInclude!="undefined"?!!Z.legacyInclude:!0,J.strict)J._with=!1;else J._with=typeof Z._with!="undefined"?Z._with:!0;this.opts=J,this.regex=this.createRegex()}A.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};A.prototype={createRegex:function(){var $=m0,z=U.escapeRegExpChars(this.opts.delimiter),Z=U.escapeRegExpChars(this.opts.openDelimiter),J=U.escapeRegExpChars(this.opts.closeDelimiter);return $=$.replace(/%/g,z).replace(/</g,Z).replace(/>/g,J),new RegExp($)},compile:function(){var $,z,Z=this.opts,J="",X="",Q=Z.escapeFunction,Y,C=Z.filename?JSON.stringify(Z.filename):"undefined";if(!this.source){if(this.generateSource(),J+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,Z.outputFunctionName){if(!$1.test(Z.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");J+="  var "+Z.outputFunctionName+` = __append;
`}if(Z.localsName&&!$1.test(Z.localsName))throw new Error("localsName is not a valid JS identifier.");if(Z.destructuredLocals&&Z.destructuredLocals.length){var B="  var __locals = ("+Z.localsName+` || {}),
`;for(var G=0;G<Z.destructuredLocals.length;G++){var V=Z.destructuredLocals[G];if(!$1.test(V))throw new Error("destructuredLocals["+G+"] is not a valid JS identifier.");if(G>0)B+=`,
  `;B+=V+" = __locals."+V}J+=B+`;
`}if(Z._with!==!1)J+="  with ("+Z.localsName+` || {}) {
`,X+=`  }
`;X+=`  return __output;
`,this.source=J+this.source+X}if(Z.compileDebug)$=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+C+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`;else $=this.source;if(Z.client){if($="escapeFn = escapeFn || "+Q.toString()+`;
`+$,Z.compileDebug)$="rethrow = rethrow || "+c1.toString()+`;
`+$}if(Z.strict)$=`"use strict";
`+$;if(Z.debug)console.log($);if(Z.compileDebug&&Z.filename)$=$+`
//# sourceURL=`+C+`
`;try{if(Z.async)try{Y=new Function("return (async function(){}).constructor;")()}catch(N){if(N instanceof SyntaxError)throw new Error("This environment does not support async/await");else throw N}else Y=Function;z=new Y(Z.localsName+", escapeFn, include, rethrow",$)}catch(N){if(N instanceof SyntaxError){if(Z.filename)N.message+=" in "+Z.filename;if(N.message+=` while compiling ejs

`,N.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,N.message+="https://github.com/RyanZim/EJS-Lint",!Z.async)N.message+=`
`,N.message+="Or, if you meant to create an async function, pass `async: true` as an option."}throw N}var W=Z.client?z:function N(T){var L=function(w,n){var p=U.shallowCopy(U.createNullProtoObjWherePossible(),T);if(n)p=U.shallowCopy(p,n);return l0(w,Z)(p)};return z.apply(Z.context,[T||U.createNullProtoObjWherePossible(),Q,L,c1])};if(Z.filename&&typeof Object.defineProperty==="function"){var K=Z.filename,f=E.basename(K,E.extname(K));try{Object.defineProperty(W,"name",{value:f,writable:!1,enumerable:!1,configurable:!0})}catch(N){}}return W},generateSource:function(){var $=this.opts;if($.rmWhitespace)this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"");this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var z=this,Z=this.parseTemplateText(),J=this.opts.delimiter,X=this.opts.openDelimiter,Q=this.opts.closeDelimiter;if(Z&&Z.length)Z.forEach(function(Y,C){var B;if(Y.indexOf(X+J)===0&&Y.indexOf(X+J+J)!==0){if(B=Z[C+2],!(B==J+Q||B=="-"+J+Q||B=="_"+J+Q))throw new Error('Could not find matching close tag for "'+Y+'".')}z.scanLine(Y)})},parseTemplateText:function(){var $=this.templateText,z=this.regex,Z=z.exec($),J=[],X;while(Z){if(X=Z.index,X!==0)J.push($.substring(0,X)),$=$.slice(X);J.push(Z[0]),$=$.slice(Z[0].length),Z=z.exec($)}if($)J.push($);return J},_addOutput:function($){if(this.truncate)$=$.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1;if(!$)return $;$=$.replace(/\\/g,"\\\\"),$=$.replace(/\n/g,"\\n"),$=$.replace(/\r/g,"\\r"),$=$.replace(/"/g,"\\\""),this.source+='    ; __append("'+$+`")
`},scanLine:function($){var z=this,Z=this.opts.delimiter,J=this.opts.openDelimiter,X=this.opts.closeDelimiter,Q=0;switch(Q=$.split(`
`).length-1,$){case J+Z:case J+Z+"_":this.mode=A.modes.EVAL;break;case J+Z+"=":this.mode=A.modes.ESCAPED;break;case J+Z+"-":this.mode=A.modes.RAW;break;case J+Z+"#":this.mode=A.modes.COMMENT;break;case J+Z+Z:this.mode=A.modes.LITERAL,this.source+='    ; __append("'+$.replace(J+Z+Z,J+Z)+`")
`;break;case Z+Z+X:this.mode=A.modes.LITERAL,this.source+='    ; __append("'+$.replace(Z+Z+X,Z+X)+`")
`;break;case Z+X:case"-"+Z+X:case"_"+Z+X:if(this.mode==A.modes.LITERAL)this._addOutput($);this.mode=null,this.truncate=$.indexOf("-")===0||$.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case A.modes.EVAL:case A.modes.ESCAPED:case A.modes.RAW:if($.lastIndexOf("//")>$.lastIndexOf(`
`))$+=`
`}switch(this.mode){case A.modes.EVAL:this.source+="    ; "+$+`
`;break;case A.modes.ESCAPED:this.source+="    ; __append(escapeFn("+y1($)+`))
`;break;case A.modes.RAW:this.source+="    ; __append("+y1($)+`)
`;break;case A.modes.COMMENT:break;case A.modes.LITERAL:this._addOutput($);break}}else this._addOutput($)}if(z.opts.compileDebug&&Q)this.currentLine+=Q,this.source+="    ; __line = "+this.currentLine+`
`}};h1.escapeXML=U.escapeXML;h1.__express=h1.renderFile;h1.VERSION=x0;h1.name=u0;if(typeof window!="undefined")window.ejs=h1});class k{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class c{root;constructor(){this.root=new k}pushMidl($,...z){let Z=this.root,J=$.split("/").filter(Boolean);if($==="/"){Z.handler.push(...z);return}for(let X of J){let Q=X;if(X.startsWith(":"))Q=":";if(!Z.children[Q])Z.children[Q]=new k;Z=Z.children[Q]}Z.handler.push(...z)}insert($,z){let Z=this.root,J=$.split("/").filter(Boolean);if($==="/"){Z.isEndOfWord=!0,Z.handler.push(z.handler),Z.path=$,Z.method.push(z.method);return}for(let X of J){let Q=!1,Y=X;if(X.startsWith(":"))Q=!0,Y=":";if(!Z.children[Y])Z.children[Y]=new k;Z=Z.children[Y],Z.isDynamic=Q,Z.pattern=X}Z.isEndOfWord=!0,Z.path=$,Z.method.push(z.method),Z.handler.push(z.handler)}search($,z){let Z=this.root,J=$.split("/").filter(Boolean),X=J.length;for(let C of J){let B=C;if(!Z.children[B])if(Z.children[":"])Z=Z.children[":"];else return null;else Z=Z.children[B]}let Q=Z.path.split("/").filter(Boolean);if(X!==Q.length)return null;if(Z.method.indexOf(z)!==-1)return{path:Z.path,handler:Z.handler[0],pattern:Z.pattern};return null}}function _($){switch($.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var J1=null;async function n1(){if(!J1){let $=await Promise.resolve().then(() => D0(o1(),1));J1=$.default||$}return J1}class g{req;server;pathname;routePattern;headers=new Headers;parsedQuery=null;parsedParams=null;parsedCookies=null;parsedBody=null;contextData={};urlObject=null;constructor($,z,Z,J=""){this.req=$,this.server=z,this.pathname=Z,this.routePattern=J}setHeader($,z){return this.headers.set($,z),this}removeHeader($){return this.headers.delete($),this}set($,z){return this.contextData[$]=z,this}get($){return this.contextData[$]}get ip(){return this.server.requestIP(this.req)?.address??null}get url(){if(!this.urlObject)this.urlObject=new URL(this.req.url);return this.urlObject}get query(){if(!this.parsedQuery)this.parsedQuery=this.url.search?Object.fromEntries(this.url.searchParams):{};return this.parsedQuery}get params(){if(!this.parsedParams&&this.routePattern)try{this.parsedParams=s1(this.routePattern,this.pathname)}catch($){let z=$ instanceof Error?$.message:String($);throw new Error(`Failed to extract route parameters: ${z}`)}return this.parsedParams??{}}get body(){if(this.req.method==="GET")return Promise.resolve({});if(!this.parsedBody)this.parsedBody=(async()=>{try{let $=await r1(this.req);if($.error)throw new Error($.error);return Object.keys($).length===0?null:$}catch($){throw new Error("Invalid request body format")}})();return this.parsedBody}text($,z=200){return new Response($,{status:z,headers:this.headers})}send($,z=200){let Z;if($ instanceof Uint8Array)Z="Uint8Array";else if($ instanceof ArrayBuffer)Z="ArrayBuffer";else Z=typeof $;let J=Z==="object"&&$!==null?JSON.stringify($):$;return new Response(J,{status:z,headers:this.headers})}json($,z=200){return Response.json($,{status:z,headers:this.headers})}file($,z,Z=200){let J=Bun.file($);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",z??_($));return new Response(J,{status:Z,headers:this.headers})}async ejs($,z={},Z=200){let J=await n1();try{let X=await Bun.file($).text(),Q=J.render(X,z),Y=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(Q,{status:Z,headers:Y})}catch(X){return console.error("EJS Rendering Error:",X),new Response("Error rendering template",{status:500})}}redirect($,z=302){return this.headers.set("Location",$),new Response(null,{status:z,headers:this.headers})}setCookie($,z,Z={}){let J=`${encodeURIComponent($)}=${encodeURIComponent(z)}`;if(Z.maxAge)J+=`; Max-Age=${Z.maxAge}`;if(Z.expires)J+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)J+=`; Path=${Z.path}`;if(Z.domain)J+=`; Domain=${Z.domain}`;if(Z.secure)J+="; Secure";if(Z.httpOnly)J+="; HttpOnly";if(Z.sameSite)J+=`; SameSite=${Z.sameSite}`;return this.headers.append("Set-Cookie",J),this}get cookies(){if(!this.parsedCookies){let $=this.req.headers.get("cookie");this.parsedCookies=$?p1($):{}}return this.parsedCookies}stream($){let z=new Headers(this.headers),Z=new ReadableStream({async start(J){await $(J),J.close()}});return new Response(Z,{headers:z})}yieldStream($){return new Response}}function $4($,z,Z,J){let X=null,Q=null,Y=null,C=null,B={},G=null;return{req:$,server:z,pathname:Z,headers:new Headers,setHeader(V,W){return this.headers.set(V,W),this},removeHeader(V){return this.headers.delete(V),this},set(V,W){return B[V]=W,this},get(V){return B[V]},get ip(){return this.server.requestIP($)?.address??null},get url(){if(!G)G=new URL($.url);return G},get query(){if(!X){if(!this.url.search)return{};X=Object.fromEntries(this.url.searchParams)}return X},get params(){if(!Q&&J)try{Q=s1(J,Z)}catch(V){let W=V instanceof Error?V.message:String(V);throw new Error(`Failed to extract route parameters: ${W}`)}return Q??{}},get body(){if($.method==="GET")return Promise.resolve({});if(!C)C=(async()=>{try{let V=await r1($);if(V.error)throw new Error(V.error);return Object.keys(V).length===0?null:V}catch(V){throw new Error("Invalid request body format")}})();return C},text(V,W=200){return new Response(V,{status:W,headers:this.headers})},send(V,W=200){let K;if(V instanceof Uint8Array)K="Uint8Array";else if(V instanceof ArrayBuffer)K="ArrayBuffer";else K=typeof V;let f=K==="object"&&V!==null?JSON.stringify(V):V;return new Response(f,{status:W,headers:this.headers})},json(V,W=200){return Response.json(V,{status:W,headers:this.headers})},file(V,W,K=200){let f=Bun.file(V);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",W??_(V));return new Response(f,{status:K,headers:this.headers})},async ejs(V,W={},K=200){let f=await n1();try{let N=await Bun.file(V).text(),T=f.render(N,W),L=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(T,{status:K,headers:L})}catch(N){return console.error("EJS Rendering Error:",N),new Response("Error rendering template",{status:500})}},redirect(V,W=302){return this.headers.set("Location",V),new Response(null,{status:W,headers:this.headers})},stream(V){let W=new Headers(this.headers),K=new ReadableStream({async start(f){await V(f),f.close()}});return new Response(K,{headers:W})},yieldStream(V){return new Response("not working stream yet.")},setCookie(V,W,K={}){let f=`${encodeURIComponent(V)}=${encodeURIComponent(W)}`;if(K.maxAge)f+=`; Max-Age=${K.maxAge}`;if(K.expires)f+=`; Expires=${K.expires.toUTCString()}`;if(K.path)f+=`; Path=${K.path}`;if(K.domain)f+=`; Domain=${K.domain}`;if(K.secure)f+="; Secure";if(K.httpOnly)f+="; HttpOnly";if(K.sameSite)f+=`; SameSite=${K.sameSite}`;return this.headers.append("Set-Cookie",f),this},get cookies(){if(!Y){let V=this.req.headers.get("cookie");Y=V?p1(V):{}}return Y}}}function p1($){return Object.fromEntries($.split(";").map((z)=>{let[Z,...J]=z.trim().split("=");return[Z,decodeURIComponent(J.join("="))]}))}function s1($,z){let Z={},J=$.split("/"),[X]=z.split("?"),Q=X.split("/");if(J.length!==Q.length)return null;for(let Y=0;Y<J.length;Y++){let C=J[Y];if(C.charCodeAt(0)===58)Z[C.slice(1)]=Q[Y]}return Z}async function r1($){let z=$.headers.get("Content-Type")||"";if(!z)return{};if($.headers.get("Content-Length")==="0"||!$.body)return{};if(z.startsWith("application/json"))return await $.json();if(z.startsWith("application/x-www-form-urlencoded")){let J=await $.text();return Object.fromEntries(new URLSearchParams(J))}if(z.startsWith("multipart/form-data")){let J=await $.formData(),X={};for(let[Q,Y]of J.entries())X[Q]=Y;return X}return{error:"Unknown request body type"}}async function j($,z,Z){if(!z?.length)return;for(let J=0;J<z.length;J++){let X=z[J](...Z),Q=X instanceof Promise?await X:X;if(Q&&$!=="onRequest")return Q}}async function a1($,z,Z){let J=$.globalMiddlewares;if(J.length)for(let Q of J){let Y=await Q(Z);if(Y)return Y}let X=$.middlewares.get(z);if(X&&X.length)for(let Q of X){let Y=await Q(Z);if(Y)return Y}return null}async function t1($,z,Z){for(let J of $){let X=await J(z,Z);if(X)return X}}async function h($,z,Z){let J=await Z4($,z,Z),X=J instanceof Promise?await J:J;if(X)return X}async function Z4($,z,Z){if(z.endsWith("/"))z=z.slice(0,-1);if(!$.filters.has(z))if($.filterFunction.length)for(let J of $.filterFunction){let X=await J(Z);if(X)return X}else return Response.json({error:"Protected route, authentication required"},{status:401})}async function d($,z,Z){if($.staticPath){let X=await z4($,Z,z);if(X)return X;let Q=$.trie.search("*",z.req.method);if(Q?.handler)return await Q.handler(z)}let J=$.routeNotFoundFunc(z);return J instanceof Promise?await J:J||M(404,`404 Route not found for ${Z}`)}function M($,z){return new Response(JSON.stringify({error:z}),{status:$,headers:{"Content-Type":"application/json"}})}async function z4($,z,Z){if(!$.staticPath)return null;let J=`${$.staticPath}${z}`;if(await Bun.file(J).exists()){let Q=_(J);return Z.file(J,Q,200)}return null}var i=($)=>$.constructor.name==="AsyncFunction",X1=($,z,Z,...J)=>{if(z.length>5)$.push(`
      for (let i = 0; i < diesel.hooks.${Z}.length; i++) {
        const result = diesel.hooks.${Z}[i](${J});
        const finalResult = result instanceof Promise ? await result : result;
        if (finalResult && '${Z}' !== 'onRequest') return finalResult
    }
  `);else z?.forEach((X,Q)=>{if(i(X))$.push(`
            const ${Z}${Q}Result = await diesel.hooks.${Z}[${Q}](${J})
            if (${Z}${Q}Result && '${Z}' !== 'onRequest') return ${Z}${Q}Result
            `);else $.push(`
            const ${Z}${Q}Result = diesel.hooks.${Z}[${Q}](${J})
             if (${Z}${Q}Result && '${Z}' !== 'onRequest') return ${Z}${Q}Result
            `)})},J4=($)=>{$.push(`
    let pathname;
    const start = req.url.indexOf('/', req.url.indexOf(':') + 4);
    let i = start;
    for (; i < req.url.length; i++) {
        const charCode = req.url.charCodeAt(i);
        if (charCode === 37) { // percent-encoded
            const queryIndex = req.url.indexOf('?', i);
            const path = req.url.slice(start, queryIndex === -1 ? undefined : queryIndex);
            pathname = tryDecodeURI(path.includes('%25') ? path.replace(/%25/g, '%2525') : path);
            break;
        } else if (charCode === 63) { // ?
            break;
        }
    }
    if (!pathname) {
      pathname = req.url.slice(start, i);
    }
  `)},X4=($,z)=>{if(z.length<=5)for(let Z=0;Z<z.length;Z++)if(i(z[Z]))$.push(`
          const resultMiddleware${Z} = await globalMiddlewares[${Z}](ctx);
          if (resultMiddleware${Z}) return resultMiddleware${Z};
      `);else $.push(`
        const resultMiddleware${Z} = globalMiddlewares[${Z}](ctx);
        if (resultMiddleware${Z}) return resultMiddleware${Z};
    `);else $.push(`
    for (let i = 0; i < globalMiddlewares.length; i++) {
      const result = await globalMiddlewares[i](ctx);
      if (result) return result;
    }
  `)},e1=($,z)=>{let Z=[],J=z.globalMiddlewares||[],X=$?.hasOnReqHook?z.hooks.onRequest:[],Q=$?.hasPreHandlerHook?z.hooks.preHandler:[],Y=$?.hasOnSendHook?z.hooks.onSend:[];if(J4(Z),Z.push(`
      const routeHandler = diesel.trie.search(pathname, req.method);
    `),X&&X.length>0)X1(Z,X,"onRequest","req","pathname","server");if(Z.push(`
          const ctx = new Context(req, server, pathname, routeHandler?.path)
    `),$?.hasMiddleware){if(J.length>0)X4(Z,J);if(z.middlewares.size>0)Z.push(`
      const local = diesel.middlewares.get(pathname)
      if (local && local.length) {
        for (const middleware of local) {
          const result = await middleware(ctx);
          if (result) return result;
        }
      }
        `)}if($.hasFilterEnabled)Z.push(`
        const filterResponse = await runFilter(diesel, pathname, ctx);
        if (filterResponse) return filterResponse;
      `);if(Z.push(`
      if (!routeHandler) return await handleRouteNotFound(diesel, ctx, pathname);
    `),$.hasPreHandlerHook)X1(Z,Q,"preHandler","ctx");if(Z.push(`
      const result = routeHandler.handler(ctx);
      const finalResult = result instanceof Promise ? await result : result;
    `),$.hasOnSendHook)X1(Z,Y,"onSend","ctx","finalResult");Z.push(`
      if (finalResult instanceof Response) return finalResult;
      return generateErrorResponse(500, "No response returned from handler.");
    `);let C=`
      return async function pipeline(req, server, diesel) {
          ${Z.join(`
`)}
      }
    `;return new Function("runFilter","handleRouteNotFound","generateErrorResponse","globalMiddlewares","Context",C)(h,d,M,J,g)},$0=($,z,Z,J,...X)=>{let Q=[],Y;if(typeof X[0]==="string"||typeof X[0]==="object")Y=X[0];let C=X,B=$?.hasMiddleware?z.globalMiddlewares:[],G=$?.hasMiddleware?z.middlewares.get(J)||[]:[],V=[...B,...G],W=$?.hasOnReqHook?z.hooks.onRequest:[],K=z.filters.has(J),f=z.filterFunction;if(W&&W?.length>0)Q.push(`
      const onRequestResult = await runHooks(
        "onRequest",
        onRequestHooks,
        [req, "${J}", server]
      );
      if (onRequestResult) return onRequestResult;
    `);if(V.length)Q.push(`
      const globalMiddlewareResponse = await executeBunMiddlewares(
        allMiddlewares,
        req,
        server
      );
      if (globalMiddlewareResponse) return globalMiddlewareResponse;
    `);if($.hasFilterEnabled){if(!K)Q.push(`if (${f.length}) {
        for (const filterFunction of filterFunctions) {
          const filterResult = await filterFunction(req, server);
          if (filterResult) return filterResult;
        }
      } else {
        return Response.json({ error: "Protected route, authentication required" }, { status: 401 });
      }`)}if(Q.push(`
            if ("${Z}" !== req.method)
        return new Response("Method Not Allowed", { status: 405 });
      `),typeof Y!=="undefined")if(typeof Y==="string")Q.push(`
        return new Response(${JSON.stringify(Y)});
      `);else{let L=JSON.stringify(Y);Q.push(`
        return new Response(${JSON.stringify(L)}, {
          headers: { "content-type": "application/json; charset=utf-8" }
        });
      `)}else if(C.length===1){let L=C[0];if(i(L))Q.push(`
        const response = await handlers[0](req, server);
        if (response instanceof Response) return response;
      `);else Q.push(`
        const response = handlers[0](req, server);
        if (response instanceof Response) return response;
      `)}else C.forEach((L,w)=>{if(i(L))Q.push(`
            const response${w} = await handlers[${w}](req, server);
            if (response${w} instanceof Response) return response${w};
        `);else Q.push(`
            const response${w} = handlers[${w}](req, server);
            if (response${w} instanceof Response) return response${w};
        `)});let N=`
    return async function(req, server) {
      ${Q.join(`
`)}
    }
  `;return new Function("executeBunMiddlewares","handlers","runHooks","filterFunctions","onRequestHooks","allMiddlewares",N)(t1,C,j,f,W,V)};class Q1 extends Error{res;status;constructor($=500,z){super(z?.message,{cause:z?.cause});this.name="HTTPException",this.res=z?.res,this.status=$}}a();var{default:K1}=(()=>({}));var D={reset:"\x1B[0m",info:"\x1B[36m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[34m",PUT:"\x1B[35m",DELETE:"\x1B[31m",PATCH:"\x1B[36m"}},Y1=($,z,Z)=>{let J=D[$]||D.reset,X=Z?.method?D.method[Z.method]||D.reset:D.reset,Q=Z?.status?Z.status>=500?D.error:Z.status>=400?D.warn:D.info:D.reset;console.log(`
${J}[${$.toUpperCase()}]${D.reset} ${z} - ${X}${Z?.method||""}${D.reset}`);let Y={timestamp:new Date().toISOString(),...Z,status:Z?.status?`${Q}${Z.status}${D.reset}`:void 0,method:Z?.method?`${X>J}${Z.method}${D.reset}`:void 0};console.log(JSON.stringify(Y,null,2)+`
`)},Z0=($)=>{let{app:z,logger:Z,logLevel:J="info",onRequest:X,onSend:Q,onError:Y}=$||{};z?.addHooks("onRequest",(C,B)=>{C.startTime=Date.now(),Z?.()??Y1(J,"Incoming Request",{method:C.method,url:B,headers:{"user-agent":C.headers.get("user-agent"),"content-type":C.headers.get("content-type")}}),X?.(C,B)}),z?.addHooks("onSend",async(C,B)=>{let G=`${Date.now()-C.req.startTime}ms`;Z?.()??Y1(J,"Response Sent",{method:C.req.method,url:C.url.toString(),status:B.status,duration:G,reqId:C.get?.("requestId"),headers:{"content-type":B.headers.get("content-type")}});let V=await Q?.(C);if(V instanceof Response)return V}),z?.addHooks("onError",async(C,B,G)=>{Z?.()??Y1("error","Unhandled Error",{method:B.method,url:G,status:500,error:C.message});let V=await Y?.(C,B,G);if(V instanceof Response)return V})},C1=($,z,Z,J=0,X,Q)=>{let Y=D.method[z]||D.reset,C=J>=500?D.error:J>=400?D.warn:D.info,B=Q?`[${Q}] `:"",G=$==="<--"?`${$} ${Y}${z}${D.reset} ${Z} ${B}`:`${$} ${Y}${z}${D.reset} ${Z} ${C}${J}${D.reset} ${X??""} ${B}`;console.log(G)},Q4=($)=>{let z=Date.now()-$;return z<1000?`${z}ms`:`${Math.round(z/1000)}s`},z0=($)=>{let{app:z,log:Z,onRequest:J,onSend:X,onError:Q}=$;z.addHooks("onRequest",(Y,C)=>{Y.startTime=Date.now(),Z?.()??C1("<--",Y.method,C),J?.(Y,C)}),z.addHooks("onSend",async(Y,C)=>{let{method:B,url:G}=Y.req,V=new URL(G).pathname,W=Y.get?.("requestId");Z?.()??C1("-->",B,V,C.status,Q4(Y.req.startTime),W);let K=await X?.(Y);if(K instanceof Response)return K}),z.addHooks("onError",async(Y,C,B)=>{Z?.()??C1(Y.message,C.method,B,500);let G=await Q?.(Y,C,B);if(G instanceof Response)return G})};function J0($,z){if(!$)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(Z)=>{try{let J=Z.cookies?.accessToken??Z.req?.headers?.get("Authorization");if(!J)return Z.json({message:"Unauthorized",error:"No token provided"},401);if(J.startsWith("Bearer "))J=J.slice(7);let X=$?.verify(J,z);if(!X)return Z.json({message:"Unauthorized",error:"Token could not be decoded"},401);Z.set("user",X)}catch(J){let X="Invalid token";if(J.name==="TokenExpiredError")X="Token expired";else if(J.name==="JsonWebTokenError")X="Malformed or tampered token";return Z.json({message:"Unauthorized",error:X},401)}}}function X0($,z,Z){if(!$)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!z)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(J)=>{try{let X=J.cookies?.accessToken??J.req?.headers?.get("Authorization");if(!X)return J.json({message:"Unauthorized",error:"No token provided"},401);if(X.startsWith("Bearer "))X=X.slice(7);let Q=$?.verify(X,Z);if(!Q)return J.json({message:"Unauthorized",error:"Token could not be decoded"},401);let Y=await z.findById(Q._id).select("-password -refreshToken");if(!Y)return J.json({message:"Unauthorized: User not found"},404);J.set("user",Y);return}catch(X){let Q="Invalid token";if(X.name==="TokenExpiredError")Q="Token expired";else if(X.name==="JsonWebTokenError")Q="Malformed or tampered token";return J.json({message:"Unauthorized",error:Q},401)}}}var Y4=($,z)=>{try{return z($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(Z)=>{try{return z(Z)}catch{return Z}})}},V1=($)=>Y4($,decodeURI),l=($)=>{let z=$.indexOf("/",$.indexOf(":")+4),Z=z;for(;Z<$.length;Z++){let J=$.charCodeAt(Z);if(J===37){let X=$.indexOf("?",Z),Q=$.slice(z,X===-1?void 0:X);return V1(Q.includes("%25")?Q.replace(/%25/g,"%2525"):Q)}else if(J===63)break}return $.slice(z,Z)};var G1=Symbol.for,O=Symbol("kCapture"),V0=G1("events.errorMonitor"),C4=Symbol("events.maxEventTargetListeners"),V4=Symbol("events.maxEventTargetListenersWarned"),Q0=G1("nodejs.rejection"),B4=G1("nodejs.rejection"),Y0=Array.prototype.slice,q=10,H=function $(z){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[O]=z?.captureRejections?Boolean(z?.captureRejections):F[O])this.emit=f4},F=H.prototype={};F._events=void 0;F._eventsCount=0;F._maxListeners=void 0;F.setMaxListeners=function $(z){return W1(z,"setMaxListeners",0),this._maxListeners=z,this};F.constructor=H;F.getMaxListeners=function $(){return this?._maxListeners??q};function B0($,z){var{_events:Z}=$;if(z[0]??=new Error("Unhandled error."),!Z)throw z[0];var J=Z[V0];if(J)for(var X of Y0.call(J))X.apply($,z);var Q=Z.error;if(!Q)throw z[0];for(var X of Y0.call(Q))X.apply($,z);return!0}function G4($,z,Z,J){z.then(void 0,function(X){queueMicrotask(()=>W4($,X,Z,J))})}function W4($,z,Z,J){if(typeof $[Q0]==="function")$[Q0](z,Z,...J);else try{$[O]=!1,$.emit("error",z)}finally{$[O]=!0}}var K4=function $(z,...Z){if(z==="error")return B0(this,Z);var{_events:J}=this;if(J===void 0)return!1;var X=J[z];if(X===void 0)return!1;let Q=X.length>1?X.slice():X;for(let Y=0,{length:C}=Q;Y<C;Y++){let B=Q[Y];switch(Z.length){case 0:B.call(this);break;case 1:B.call(this,Z[0]);break;case 2:B.call(this,Z[0],Z[1]);break;case 3:B.call(this,Z[0],Z[1],Z[2]);break;default:B.apply(this,Z);break}}return!0},f4=function $(z,...Z){if(z==="error")return B0(this,Z);var{_events:J}=this;if(J===void 0)return!1;var X=J[z];if(X===void 0)return!1;let Q=X.length>1?X.slice():X;for(let Y=0,{length:C}=Q;Y<C;Y++){let B=Q[Y],G;switch(Z.length){case 0:G=B.call(this);break;case 1:G=B.call(this,Z[0]);break;case 2:G=B.call(this,Z[0],Z[1]);break;case 3:G=B.call(this,Z[0],Z[1],Z[2]);break;default:G=B.apply(this,Z);break}if(G!==void 0&&typeof G?.then==="function"&&G.then===Promise.prototype.then)G4(this,G,z,Z)}return!0};F.emit=K4;F.addListener=function $(z,Z){v(Z);var J=this._events;if(!J)J=this._events={__proto__:null},this._eventsCount=0;else if(J.newListener)this.emit("newListener",z,Z.listener??Z);var X=J[z];if(!X)J[z]=[Z],this._eventsCount++;else{X.push(Z);var Q=this._maxListeners??q;if(Q>0&&X.length>Q&&!X.warned)G0(this,z,X)}return this};F.on=F.addListener;F.prependListener=function $(z,Z){v(Z);var J=this._events;if(!J)J=this._events={__proto__:null},this._eventsCount=0;else if(J.newListener)this.emit("newListener",z,Z.listener??Z);var X=J[z];if(!X)J[z]=[Z],this._eventsCount++;else{X.unshift(Z);var Q=this._maxListeners??q;if(Q>0&&X.length>Q&&!X.warned)G0(this,z,X)}return this};function G0($,z,Z){Z.warned=!0;let J=new Error(`Possible EventEmitter memory leak detected. ${Z.length} ${String(z)} listeners added to [${$.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);J.name="MaxListenersExceededWarning",J.emitter=$,J.type=z,J.count=Z.length,console.warn(J)}function W0($,z,...Z){this.removeListener($,z),z.apply(this,Z)}F.once=function $(z,Z){v(Z);let J=W0.bind(this,z,Z);return J.listener=Z,this.addListener(z,J),this};F.prependOnceListener=function $(z,Z){v(Z);let J=W0.bind(this,z,Z);return J.listener=Z,this.prependListener(z,J),this};F.removeListener=function $(z,Z){v(Z);var{_events:J}=this;if(!J)return this;var X=J[z];if(!X)return this;var Q=X.length;let Y=-1;for(let C=Q-1;C>=0;C--)if(X[C]===Z||X[C].listener===Z){Y=C;break}if(Y<0)return this;if(Y===0)X.shift();else X.splice(Y,1);if(X.length===0)delete J[z],this._eventsCount--;return this};F.off=F.removeListener;F.removeAllListeners=function $(z){var{_events:Z}=this;if(z&&Z){if(Z[z])delete Z[z],this._eventsCount--}else this._events={__proto__:null};return this};F.listeners=function $(z){var{_events:Z}=this;if(!Z)return[];var J=Z[z];if(!J)return[];return J.map((X)=>X.listener??X)};F.rawListeners=function $(z){var{_events:Z}=this;if(!Z)return[];var J=Z[z];if(!J)return[];return J.slice()};F.listenerCount=function $(z){var{_events:Z}=this;if(!Z)return 0;return Z[z]?.length??0};F.eventNames=function $(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};F[O]=!1;function F4($,z,Z){var J=Z?.signal;if(K0(J,"options.signal"),J?.aborted)throw new B1(void 0,{cause:J?.reason});let{resolve:X,reject:Q,promise:Y}=$newPromiseCapability(Promise),C=(V)=>{if($.removeListener(z,B),J!=null)o(J,"abort",G);Q(V)},B=(...V)=>{if(typeof $.removeListener==="function")$.removeListener("error",C);if(J!=null)o(J,"abort",G);X(V)};if(C0($,z,B,{once:!0}),z!=="error"&&typeof $.once==="function")$.once("error",C);function G(){o($,z,B),o($,"error",C),Q(new B1(void 0,{cause:J?.reason}))}if(J!=null)C0(J,"abort",G,{once:!0});return Y}function U4($,z){return $.listeners(z)}function D4($,...z){W1($,"setMaxListeners",0);var Z;if(z&&(Z=z.length))for(let J=0;J<Z;J++)z[J].setMaxListeners($);else q=$}function N4($,z){return $.listenerCount(z)}function o($,z,Z,J){if(typeof $.removeListener==="function")$.removeListener(z,Z);else $.removeEventListener(z,Z,J)}function C0($,z,Z,J){if(typeof $.on==="function")if(J.once)$.once(z,Z);else $.on(z,Z);else $.addEventListener(z,Z,J)}class B1 extends Error{constructor($="The operation was aborted",z=void 0){if(z!==void 0&&typeof z!=="object")throw I("options","Object",z);super($,z);this.code="ABORT_ERR",this.name="AbortError"}}function I($,z,Z){let J=new TypeError(`The "${$}" argument must be of type ${z}. Received ${Z}`);return J.code="ERR_INVALID_ARG_TYPE",J}function A4($,z,Z){let J=new RangeError(`The "${$}" argument is out of range. It must be ${z}. Received ${Z}`);return J.code="ERR_OUT_OF_RANGE",J}function K0($,z){if($!==void 0&&($===null||typeof $!=="object"||!("aborted"in $)))throw I(z,"AbortSignal",$)}function W1($,z,Z,J){if(typeof $!=="number")throw I(z,"number",$);if(Z!=null&&$<Z||J!=null&&$>J||(Z!=null||J!=null)&&Number.isNaN($))throw A4(z,`${Z!=null?`>= ${Z}`:""}${Z!=null&&J!=null?" && ":""}${J!=null?`<= ${J}`:""}`,$)}function v($){if(typeof $!=="function")throw new TypeError("The listener must be a function")}function w4($,z){if(typeof $!=="boolean")throw I(z,"boolean",$)}function S4($){return $?._maxListeners??q}function L4($,z){if($===void 0)throw I("signal","AbortSignal",$);if(K0($,"signal"),typeof z!=="function")throw I("listener","function",z);let Z;if($.aborted)queueMicrotask(()=>z());else $.addEventListener("abort",z,{__proto__:null,once:!0}),Z=()=>{$.removeEventListener("abort",z)};return{__proto__:null,[Symbol.dispose](){Z?.()}}}Object.defineProperties(H,{captureRejections:{get(){return F[O]},set($){w4($,"EventEmitter.captureRejections"),F[O]=$},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return q},set:($)=>{W1($,"defaultMaxListeners",0),q=$}},kMaxEventTargetListeners:{value:C4,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:V4,enumerable:!1,configurable:!1,writable:!1}});Object.assign(H,{once:F4,getEventListeners:U4,getMaxListeners:S4,setMaxListeners:D4,EventEmitter:H,usingDomains:!1,captureRejectionSymbol:B4,errorMonitor:V0,addAbortListener:L4,init:H,listenerCount:N4});class x{static instance;fecth;routes;tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;idleTimeOut;routeNotFoundFunc;prefixApiUrl;compileConfig;newPipelineArchitecture=!1;emitter;errorFormat;constructor({jwtSecret:$,baseApiUrl:z,enableFileRouting:Z,idleTimeOut:J,prefixApiUrl:X,onError:Q,logger:Y,pipelineArchitecture:C}={}){if(!x.instance)x.instance=this;if(C)this.newPipelineArchitecture=!0;if(this.errorFormat="json",this.emitter=new H,this.prefixApiUrl=X??"",this.fetch=this.fetch.bind(this),this.routes={},this.idleTimeOut=J??10,this.enableFileRouter=Z??!1,this.baseApiUrl=z||"",this.user_jwt_secret=$||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new c,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:[],preHandler:[],postHandler:[],onSend:[],onError:[],onClose:[]},Q)this.addHooks("onError",(B,G,V)=>{console.log("Got an exception:",B),console.log("Request Path:",V)});if(Y)this.useLogger({app:this,onError(B){console.error("Got an exception:",B)}});this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={},this.routeNotFoundFunc=()=>{},this.compileConfig=null}static router($){if(!this.instance)this.instance=new x;return new Proxy(this.instance,{get(z,Z,J){return(X,Q)=>{let Y=$+X;return z[Z](Y,Q)}}})}setupFilter(){return this.hasFilterEnabled=!0,{publicRoutes:(...$)=>{return this.FilterRoutes=$,this.setupFilter()},permitAll:()=>{for(let $ of this?.FilterRoutes){if($.endsWith("/"))$=$.slice(0,-1);this.filters.add($)}return this.FilterRoutes=null,this.setupFilter()},authenticate:($)=>{if($?.length)for(let z of $)this.filterFunction.push(z)},authenticateJwt:($)=>{this.filterFunction.push(J0($,this.user_jwt_secret))},authenticateJwtDB:($,z)=>{this.filterFunction.push(X0($,z,this.user_jwt_secret))}}}redirect($,z,Z){return this.any($,(J)=>{let X=J.params,Q=z;if(X)for(let C in X)Q=Q.replace(`:${C}`,X[C]);let Y=J.url.search;if(Y)Q+=Y;return J.redirect(Q,Z)}),this}serveStatic($){return this.staticPath=$,this}static($){return this.staticPath=$,this}staticHtml($){return this.staticFiles={...this.staticFiles,...$},this}addHooks($,z){if(typeof $!=="string")throw new Error("hookName must be a string");if(typeof z!=="function")throw new Error("callback must be a instance of function");switch($){case"onRequest":this.hooks.onRequest?.push(z);break;case"preHandler":this.hooks.preHandler?.push(z);break;case"postHandler":this.hooks.postHandler?.push(z);break;case"onSend":this.hooks.onSend?.push(z);break;case"onError":this.hooks.onError?.push(z);break;case"onClose":this.hooks.onClose?.push(z);break;default:throw new Error(`Unknown hook type: ${$}`)}return this}compile(){let $={hasMiddleware:!1,hasOnReqHook:!1,hasPreHandlerHook:!1,hasOnError:!1,hasPostHandlerHook:!1,hasOnSendHook:!1,hasFilterEnabled:!1};if(this.hasFilterEnabled)$.hasFilterEnabled=!0,this.hasFilterEnabled=!0;if(this?.globalMiddlewares?.length>0)$.hasMiddleware=!0,this.hasMiddleware=!0;for(let[z,Z]of this?.middlewares?.entries())if(Z.length>0){$.hasMiddleware=!0,this.hasMiddleware=!0;break}if(this?.enableFileRouter){let z=process.cwd(),Z=R.join(z,"src","routes");if(K1?.existsSync(Z))this.loadRoutes(Z,"")}if(this?.hooks?.onRequest&&this.hooks.onRequest.length>0)$.hasOnReqHook=!0,this.hasOnReqHook=!0;if(this?.hooks?.preHandler&&this.hooks.preHandler.length>0)$.hasPreHandlerHook=!0,this.hasPreHandlerHook=!0;if(this?.hooks?.postHandler&&this.hooks.postHandler?.length>0)$.hasPostHandlerHook=!0,this.hasPostHandlerHook=!0;if(this?.hooks?.onSend&&this.hooks.onSend?.length>0)$.hasOnSendHook=!0,this.hasOnSendHook=!0;if(this?.hooks?.onError&&this.hooks.onError?.length>0)$.hasOnError=!0,this.hasOnError=!0;return setTimeout(()=>{this.tempRoutes=null},2000),this.compileConfig=$,$}async registerFileRoutes($,z,Z){let J=await import($),X;if(Z===".ts")X=R.basename($,".ts");else if(Z===".js")X=R.basename($,".js");let Q=z+"/"+X;if(Q.endsWith("/index"))Q=z;else if(Q.endsWith("/api"))Q=z;Q=Q.replace(/\[(.*?)\]/g,":$1");let Y=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let C of Y)if(J[C]){let B=C.toLowerCase(),G=J[C];this[B](`${this.baseApiUrl}${Q}`,G)}}async loadRoutes($,z){let Z=await K1.promises.readdir($);for(let J of Z){let X=R.join($,J);if((await K1.promises.stat(X)).isDirectory())await this.loadRoutes(X,z+"/"+J);else if(J.endsWith(".ts"))await this.registerFileRoutes(X,z,".ts");else if(J.endsWith(".js"))await this.registerFileRoutes(X,z,".js")}}useLogger($){return z0($),this}useAdvancedLogger($){return Z0($),this}BunRoute($,z,...Z){if(!z||typeof z!=="string")throw new Error("give a path in string format");if(!this.compileConfig)this.compile();let J;if(typeof Z[0]==="string"||typeof Z[0]==="object")J=Z[0];if(typeof J!=="undefined"){let Q=typeof J==="string"?J:JSON.stringify(J)}let X=$0(this.compileConfig,this,$.toUpperCase(),z,...Z);return this.routes[z]=X,this}listen($,...z){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let Z="0.0.0.0",J=void 0,X={};for(let Y of z)if(typeof Y==="string")Z=Y;else if(typeof Y==="function")J=Y;else if(typeof Y==="object"&&Y!==null)X=Y;let Q={port:$,hostname:Z,idleTimeOut:this.idleTimeOut,fetch:this.fetch(),static:this.staticFiles};if(this.routes&&Object.keys(this.routes).length>0)Q.routes=this.routes;if(X.cert&&X.key)Q.certFile=X.cert,Q.keyFile=X.key;if(this.serverInstance=Bun?.serve(Q),J)J();return this.serverInstance}close($){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,$?$():console.log("Server has been stopped");else console.warn("Server is not running.")}fetch(){let $=this.compile();if(this.newPipelineArchitecture){let z=e1($,this);return(Z,J)=>{return z(Z,J,this).catch(async(X)=>{return console.error("Unhandled handler error:",X),await j("onError",this.hooks.onError,[X,Z,l(Z.url),J])||M(500,"Internal Server Error")})}}return this.handleRequests.bind(this)}async handleRequests($,z){let Z,J=$.url.indexOf("/",$.url.indexOf(":")+4),X=J;for(;X<$.url.length;X++){let C=$.url.charCodeAt(X);if(C===37){let B=$.url.indexOf("?",X),G=$.url.slice(J,B===-1?void 0:B);Z=V1(G.includes("%25")?G.replace(/%25/g,"%2525"):G);break}else if(C===63)break}if(!Z)Z=$.url.slice(J,X);let Q=this.trie.search(Z,$.method),Y=new g($,z,Z,Q?.path);try{if(this.hasOnReqHook)await j("onRequest",this.hooks.onRequest,[$,Z,z]);if(this.hasMiddleware){let G=await a1(this,Z,Y);if(G)return G}if(this.hasFilterEnabled){let G=await h(this,Z,Y);if(G)return G}if(!Q)return await d(this,Y,Z);if(this.hasPreHandlerHook){let G=await j("preHandler",this.hooks.preHandler,[Y]);if(G)return G}let C=Q.handler(Y),B=C instanceof Promise?await C:C;if(this.hasOnSendHook){let G=await j("onSend",this.hooks.onSend,[Y,B]);if(G)return G}if(B instanceof Response)return B}catch(C){return this.handleError(C,$,z)}return M(500,"No response returned from handler.")}async handleError($,z,Z){let X=this.errorFormat||"json",Q=l(z.url),Y=await j("onError",this.hooks.onError,[$,z,Q,Z]);if(Y)return Y;if($ instanceof Q1){if($.res)return $.res;return X==="json"?Response.json({error:$.message},{status:$.status}):new Response($.message,{status:$.status})}if(X==="json"){let C={error:$?.message??"Internal Server Error",...!1,path:Q};return Response.json(C,{status:500,headers:{"Content-Type":"application/json"}})}else{let C=`Error: ${$?.message??"Internal Server Error"}`;return new Response(C,{headers:{"Content-Type":"text/plain"},status:500})}}route($,z){$=$&&$.length>0?$:z?.prefixApiUrl;let Z=z?.tempRoutes??new Map;for(let[J,X]of Z.entries()){let Q=J.replace(/::\w+$/,""),Y=`${$}${Q}`;if(!this.middlewares.has(Y))this.middlewares.set(Y,[]);X.handlers.slice(0,-1).forEach((V)=>{let W=this.middlewares.get(Y);if(!W.includes(V))W.push(V)});let B=X.handlers[X.handlers.length-1],G=X.method;try{this.trie.insert(Y,{handler:B,method:G})}catch(V){console.error(`Error inserting ${Y}:`,V)}}return z=null,this}register($,z){return this.route($,z)}addRoute($,z,Z){if(typeof z!=="string")throw new Error(`Error in ${Z[Z.length-1]}: Path must be a string. Received: ${typeof z}`);if(typeof $!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof $}`);this.tempRoutes?.set(z+"::"+$,{method:$,handlers:Z});let J=Z.slice(0,-1),X=Z[Z.length-1];if(J.length>0){if(!this.middlewares.has(z))this.middlewares.set(z,[]);J.forEach((Q)=>{if(z==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...J])];else if(!this.middlewares.get(z)?.includes(Q))this.middlewares.get(z)?.push(Q)})}try{if($==="ANY"){let Q=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let Y of Q)this.trie.insert(z,{handler:X,method:Y})}this.trie.insert(z,{handler:X,method:$})}catch(Q){console.error(`Error inserting ${z}:`,Q)}}use($,z){if(Array.isArray($))$.forEach((J)=>{if(typeof J==="function")this.globalMiddlewares.push(J)});if(typeof $==="function"){if(this.globalMiddlewares.push($),Array.isArray(z))z.forEach((J)=>{this.globalMiddlewares.push(J)});return this}return(Array.isArray($)?$.filter((J)=>typeof J==="string"):[$].filter((J)=>typeof J==="string")).forEach((J)=>{if(!this.middlewares.has(J))this.middlewares.set(J,[]);if(z)(Array.isArray(z)?z:[z]).forEach((Q)=>{this.middlewares.get(J)?.push(Q)})}),this}get($,...z){return this.addRoute("GET",$,z),this}post($,...z){return this.addRoute("POST",$,z),this}put($,...z){return this.addRoute("PUT",$,z),this}patch($,...z){return this.addRoute("PATCH",$,z),this}delete($,...z){return this.addRoute("DELETE",$,z),this}any($,...z){return this.addRoute("ANY",$,z),this}head($,...z){return this.addRoute("HEAD",$,z),this}options($,...z){return this.addRoute("OPTIONS",$,z),this}propfind($,...z){return this.addRoute("PROPFIND",$,z),this}routeNotFound($){return this.routeNotFoundFunc=$,this}on($,z){this.emitter.on($,z)}emit($,...z){this.emitter.emit($,...z)}}export{x as default};
