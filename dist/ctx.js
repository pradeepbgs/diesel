var I=Object.create;var{getPrototypeOf:M,defineProperty:X,getOwnPropertyNames:N}=Object;var R=Object.prototype.hasOwnProperty;var U=(w,A,E)=>{E=w!=null?I(M(w)):{};let z=A||!w||!w.__esModule?X(E,"default",{value:w,enumerable:!0}):E;for(let F of N(w))if(!R.call(z,F))X(z,F,{get:()=>w[F],enumerable:!0});return z};var V=((w)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(w,{get:(A,E)=>(typeof require!=="undefined"?require:A)[E]}):w)(function(w){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+w+'" is not supported')});function Y(w){switch(w.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function W(w,A,E){let z=null,F=null,J=null,G=null,O={},Z=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]);return{req:w,server:A,url:E,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(f,g){return this.headers.set(f,g),this},removeHeader(f){return this.headers.delete(f),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!z)try{z=Object.fromEntries(this.url.searchParams)}catch(f){throw new Error("Failed to parse query parameters")}return z},get params(){if(!F&&this.req.routePattern)try{F=B(this.req.routePattern,this.url.pathname)}catch(f){throw new Error("Failed to extract route parameters")}return F??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!G)G=(async()=>{let f=await C(this.req);if(f.error)throw new Error(f.error);return Object.keys(f).length===0?null:f})();return G},set(f,g){return O[f]=g,this},get(f){return O[f]},text(f,g){if(g)this.status=g;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(f,{status:this.status,headers:this.headers})},send(f,g){if(g)this.status=g;let x;if(f instanceof Uint8Array)x="Uint8Array";else if(f instanceof ArrayBuffer)x="ArrayBuffer";else x=typeof f;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",Z.get(x)??"text/plain; charset=utf-8");let L=x==="object"&&f!==null?JSON.stringify(f):f;return new Response(L,{status:this.status,headers:this.headers})},json(f,g){if(g)this.status=g;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return Response.json(f,{status:this.status,headers:this.headers})},file(f,g,x){if(x)this.status=x;let L=Bun.file(f);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",g??Y(f));return new Response(L,{status:this.status,headers:this.headers})},async ejs(f,g={},x){if(x)this.status=x;let L;try{L=await import("ejs"),L=L.default||L}catch(K){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let K=await Bun.file(f).text(),$=L.render(K,g),j=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response($,{status:this.status,headers:j})}catch(K){return console.error("EJS Rendering Error:",K),new Response("Error rendering template",{status:500})}},redirect(f,g){if(g)this.status=g;else this.status=302;return this.headers.set("Location",f),new Response(null,{status:this.status,headers:this.headers})},stream(f){let g=new Headers(this.headers),x=new ReadableStream({async start(L){await f(L),L.close()}});return new Response(x,{headers:g})},yieldStream(f){return new Response({async*[Symbol.asyncIterator](){yield*f()}},{headers:this.headers})},setCookie(f,g,x={}){let L=`${encodeURIComponent(f)}=${encodeURIComponent(g)}`;if(x.maxAge)L+=`; Max-Age=${x.maxAge}`;if(x.expires)L+=`; Expires=${x.expires.toUTCString()}`;if(x.path)L+=`; Path=${x.path}`;if(x.domain)L+=`; Domain=${x.domain}`;if(x.secure)L+="; Secure";if(x.httpOnly)L+="; HttpOnly";if(x.sameSite)L+=`; SameSite=${x.sameSite}`;return this.headers.append("Set-Cookie",L),this},get cookies(){if(!J){let f=this.req.headers.get("cookie");J=f?_(f):{}}return J}}}function _(w){return Object.fromEntries(w.split(";").map((A)=>{let[E,...z]=A.trim().split("=");return[E,decodeURIComponent(z.join("="))]}))}function B(w,A){let E={},z=w.split("/"),[F]=A.split("?"),J=F.split("/");if(z.length!==J.length)return null;for(let G=0;G<z.length;G++)if(z[G].startsWith(":"))E[z[G].slice(1)]=J[G];return E}async function C(w){let A=w.headers.get("Content-Type");if(!A)return{};if(w.headers.get("Content-Length")==="0"||!w.body)return{};try{if(A.startsWith("application/json"))return await w.json();if(A.startsWith("application/x-www-form-urlencoded")){let z=await w.text();return Object.fromEntries(new URLSearchParams(z))}if(A.startsWith("multipart/form-data")){let z=await w.formData(),F={};for(let[J,G]of z.entries())F[J]=G;return F}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}export{W as default};
