var N1=Object.create;var{getPrototypeOf:F1,defineProperty:W,getOwnPropertyNames:T,getOwnPropertyDescriptor:R1}=Object,u=Object.prototype.hasOwnProperty;var L1=(f,v,g)=>{g=f!=null?N1(F1(f)):{};let A=v||!f||!f.__esModule?W(g,"default",{value:f,enumerable:!0}):g;for(let C of T(f))if(!u.call(A,C))W(A,C,{get:()=>f[C],enumerable:!0});return A},P=new WeakMap,D1=(f)=>{var v=P.get(f),g;if(v)return v;if(v=W({},"__esModule",{value:!0}),f&&typeof f==="object"||typeof f==="function")T(f).map((A)=>!u.call(v,A)&&W(v,A,{get:()=>f[A],enumerable:!(g=R1(f,A))||g.enumerable}));return P.set(f,v),v},D=(f,v)=>()=>(v||f((v={exports:{}}).exports,v),v.exports);var q1=(f,v)=>{for(var g in v)W(f,g,{get:v[g],enumerable:!0,configurable:!0,set:(A)=>v[g]=()=>A})};var O1=(f,v)=>()=>(f&&(v=f(f=0)),v);var x1=((f)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(f,{get:(v,g)=>(typeof require!=="undefined"?require:v)[g]}):f)(function(f){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+f+'" is not supported')});var t={};q1(t,{sep:()=>a,resolve:()=>H,relative:()=>r,posix:()=>o,parse:()=>s,normalize:()=>O,join:()=>m,isAbsolute:()=>h,format:()=>e,extname:()=>i,dirname:()=>l,delimiter:()=>p,default:()=>E1,basename:()=>n,_makeLong:()=>d});function j(f){if(typeof f!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function c(f,v){var g="",A=0,C=-1,w=0,K;for(var Y=0;Y<=f.length;++Y){if(Y<f.length)K=f.charCodeAt(Y);else if(K===47)break;else K=47;if(K===47){if(C===Y-1||w===1);else if(C!==Y-1&&w===2){if(g.length<2||A!==2||g.charCodeAt(g.length-1)!==46||g.charCodeAt(g.length-2)!==46){if(g.length>2){var $=g.lastIndexOf("/");if($!==g.length-1){if($===-1)g="",A=0;else g=g.slice(0,$),A=g.length-1-g.lastIndexOf("/");C=Y,w=0;continue}}else if(g.length===2||g.length===1){g="",A=0,C=Y,w=0;continue}}if(v){if(g.length>0)g+="/..";else g="..";A=2}}else{if(g.length>0)g+="/"+f.slice(C+1,Y);else g=f.slice(C+1,Y);A=Y-C-1}C=Y,w=0}else if(K===46&&w!==-1)++w;else w=-1}return g}function I1(f,v){var g=v.dir||v.root,A=v.base||(v.name||"")+(v.ext||"");if(!g)return A;if(g===v.root)return g+A;return g+f+A}function H(){var f="",v=!1,g;for(var A=arguments.length-1;A>=-1&&!v;A--){var C;if(A>=0)C=arguments[A];else{if(g===void 0)g=process.cwd();C=g}if(j(C),C.length===0)continue;f=C+"/"+f,v=C.charCodeAt(0)===47}if(f=c(f,!v),v)if(f.length>0)return"/"+f;else return"/";else if(f.length>0)return f;else return"."}function O(f){if(j(f),f.length===0)return".";var v=f.charCodeAt(0)===47,g=f.charCodeAt(f.length-1)===47;if(f=c(f,!v),f.length===0&&!v)f=".";if(f.length>0&&g)f+="/";if(v)return"/"+f;return f}function h(f){return j(f),f.length>0&&f.charCodeAt(0)===47}function m(){if(arguments.length===0)return".";var f;for(var v=0;v<arguments.length;++v){var g=arguments[v];if(j(g),g.length>0)if(f===void 0)f=g;else f+="/"+g}if(f===void 0)return".";return O(f)}function r(f,v){if(j(f),j(v),f===v)return"";if(f=H(f),v=H(v),f===v)return"";var g=1;for(;g<f.length;++g)if(f.charCodeAt(g)!==47)break;var A=f.length,C=A-g,w=1;for(;w<v.length;++w)if(v.charCodeAt(w)!==47)break;var K=v.length,Y=K-w,$=C<Y?C:Y,V=-1,z=0;for(;z<=$;++z){if(z===$){if(Y>$){if(v.charCodeAt(w+z)===47)return v.slice(w+z+1);else if(z===0)return v.slice(w+z)}else if(C>$){if(f.charCodeAt(g+z)===47)V=z;else if(z===0)V=0}break}var J=f.charCodeAt(g+z),Z=v.charCodeAt(w+z);if(J!==Z)break;else if(J===47)V=z}var G="";for(z=g+V+1;z<=A;++z)if(z===A||f.charCodeAt(z)===47)if(G.length===0)G+="..";else G+="/..";if(G.length>0)return G+v.slice(w+V);else{if(w+=V,v.charCodeAt(w)===47)++w;return v.slice(w)}}function d(f){return f}function l(f){if(j(f),f.length===0)return".";var v=f.charCodeAt(0),g=v===47,A=-1,C=!0;for(var w=f.length-1;w>=1;--w)if(v=f.charCodeAt(w),v===47){if(!C){A=w;break}}else C=!1;if(A===-1)return g?"/":".";if(g&&A===1)return"//";return f.slice(0,A)}function n(f,v){if(v!==void 0&&typeof v!=="string")throw new TypeError('"ext" argument must be a string');j(f);var g=0,A=-1,C=!0,w;if(v!==void 0&&v.length>0&&v.length<=f.length){if(v.length===f.length&&v===f)return"";var K=v.length-1,Y=-1;for(w=f.length-1;w>=0;--w){var $=f.charCodeAt(w);if($===47){if(!C){g=w+1;break}}else{if(Y===-1)C=!1,Y=w+1;if(K>=0)if($===v.charCodeAt(K)){if(--K===-1)A=w}else K=-1,A=Y}}if(g===A)A=Y;else if(A===-1)A=f.length;return f.slice(g,A)}else{for(w=f.length-1;w>=0;--w)if(f.charCodeAt(w)===47){if(!C){g=w+1;break}}else if(A===-1)C=!1,A=w+1;if(A===-1)return"";return f.slice(g,A)}}function i(f){j(f);var v=-1,g=0,A=-1,C=!0,w=0;for(var K=f.length-1;K>=0;--K){var Y=f.charCodeAt(K);if(Y===47){if(!C){g=K+1;break}continue}if(A===-1)C=!1,A=K+1;if(Y===46){if(v===-1)v=K;else if(w!==1)w=1}else if(v!==-1)w=-1}if(v===-1||A===-1||w===0||w===1&&v===A-1&&v===g+1)return"";return f.slice(v,A)}function e(f){if(f===null||typeof f!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof f);return I1("/",f)}function s(f){j(f);var v={root:"",dir:"",base:"",ext:"",name:""};if(f.length===0)return v;var g=f.charCodeAt(0),A=g===47,C;if(A)v.root="/",C=1;else C=0;var w=-1,K=0,Y=-1,$=!0,V=f.length-1,z=0;for(;V>=C;--V){if(g=f.charCodeAt(V),g===47){if(!$){K=V+1;break}continue}if(Y===-1)$=!1,Y=V+1;if(g===46){if(w===-1)w=V;else if(z!==1)z=1}else if(w!==-1)z=-1}if(w===-1||Y===-1||z===0||z===1&&w===Y-1&&w===K+1){if(Y!==-1)if(K===0&&A)v.base=v.name=f.slice(1,Y);else v.base=v.name=f.slice(K,Y)}else{if(K===0&&A)v.name=f.slice(1,w),v.base=f.slice(1,Y);else v.name=f.slice(K,w),v.base=f.slice(K,Y);v.ext=f.slice(w,Y)}if(K>0)v.dir=f.slice(0,K-1);else if(A)v.dir="/";return v}var a="/",p=":",o,E1;var f1=O1(()=>{o=((f)=>(f.posix=f,f))({resolve:H,normalize:O,isAbsolute:h,join:m,relative:r,_makeLong:d,dirname:l,basename:n,extname:i,format:e,parse:s,sep:a,delimiter:p,win32:null,posix:null}),E1=o});var A1=D((u1)=>{var S1=/[|\\{}()[\]^$+*?.]/g,y1=Object.prototype.hasOwnProperty,I=function(f,v){return y1.apply(f,[v])};u1.escapeRegExpChars=function(f){if(!f)return"";return String(f).replace(S1,"\\$&")};var _1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},k1=/[&<>'"]/g;function P1(f){return _1[f]||f}var T1=`var _ENCODE_HTML_RULES = {
      "&": "&amp;"
    , "<": "&lt;"
    , ">": "&gt;"
    , '"': "&#34;"
    , "'": "&#39;"
    }
  , _MATCH_HTML = /[&<>'"]/g;
function encode_char(c) {
  return _ENCODE_HTML_RULES[c] || c;
};
`;u1.escapeXML=function(f){return f==null?"":String(f).replace(k1,P1)};function g1(){return Function.prototype.toString.call(this)+`;
`+T1}try{if(typeof Object.defineProperty==="function")Object.defineProperty(u1.escapeXML,"toString",{value:g1});else u1.escapeXML.toString=g1}catch(f){console.warn("Unable to set escapeXML.toString (is the Function prototype frozen?)")}u1.shallowCopy=function(f,v){if(v=v||{},f!==null&&f!==void 0)for(var g in v){if(!I(v,g))continue;if(g==="__proto__"||g==="constructor")continue;f[g]=v[g]}return f};u1.shallowCopyFromList=function(f,v,g){if(g=g||[],v=v||{},f!==null&&f!==void 0)for(var A=0;A<g.length;A++){var C=g[A];if(typeof v[C]!="undefined"){if(!I(v,C))continue;if(C==="__proto__"||C==="constructor")continue;f[C]=v[C]}}return f};u1.cache={_data:{},set:function(f,v){this._data[f]=v},get:function(f){return this._data[f]},remove:function(f){delete this._data[f]},reset:function(){this._data={}}};u1.hyphenToCamel=function(f){return f.replace(/-[a-z]/g,function(v){return v[1].toUpperCase()})};u1.createNullProtoObjWherePossible=function(){if(typeof Object.create=="function")return function(){return Object.create(null)};if(!({__proto__:null}instanceof Object))return function(){return{__proto__:null}};return function(){return{}}}();u1.hasOwnOnlyObject=function(f){var v=u1.createNullProtoObjWherePossible();for(var g in f)if(I(f,g))v[g]=f[g];return v}});var C1=D((b0,n1)=>{n1.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"3.1.10",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",license:"Apache-2.0",bin:{ejs:"./bin/cli.js"},main:"./lib/ejs.js",jsdelivr:"ejs.min.js",unpkg:"ejs.min.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{jake:"^10.8.5"},devDependencies:{browserify:"^16.5.1",eslint:"^6.8.0","git-directory-deploy":"^1.5.1",jsdoc:"^4.0.2","lru-cache":"^4.0.1",mocha:"^10.2.0","uglify-js":"^3.3.16"},engines:{node:">=0.10.0"},scripts:{test:"npx jake test"}}});var j1=D((G1)=>{var y=(()=>({})),U=(f1(),D1(t)),Q=A1(),w1=!1,i1=C1().version,e1="<",s1=">",a1="%",J1="locals",p1="ejs",o1="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",V1=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],t1=V1.concat("cache"),z1=/^\uFEFF/,E=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;G1.cache=Q.cache;G1.fileLoader=y.readFileSync;G1.localsName=J1;G1.promiseImpl=new Function("return this;")().Promise;G1.resolveInclude=function(f,v,g){var{dirname:A,extname:C,resolve:w}=U,K=w(g?v:A(v),f),Y=C(f);if(!Y)K+=".ejs";return K};function K1(f,v){var g;if(v.some(function(A){return g=G1.resolveInclude(f,A,!0),y.existsSync(g)}))return g}function f0(f,v){var g,A,C=v.views,w=/^[A-Za-z]+:\\|^\//.exec(f);if(w&&w.length)if(f=f.replace(/^\/*/,""),Array.isArray(v.root))g=K1(f,v.root);else g=G1.resolveInclude(f,v.root||"/",!0);else{if(v.filename){if(A=G1.resolveInclude(f,v.filename),y.existsSync(A))g=A}if(!g&&Array.isArray(C))g=K1(f,C);if(!g&&typeof v.includer!=="function")throw new Error('Could not find the include file "'+v.escapeFunction(f)+'"')}return g}function B(f,v){var g,A=f.filename,C=arguments.length>1;if(f.cache){if(!A)throw new Error("cache option requires a filename");if(g=G1.cache.get(A),g)return g;if(!C)v=Y1(A).toString().replace(z1,"")}else if(!C){if(!A)throw new Error("Internal EJS error: no file name or template provided");v=Y1(A).toString().replace(z1,"")}if(g=G1.compile(v,f),f.cache)G1.cache.set(A,g);return g}function g0(f,v,g){var A;if(!g)if(typeof G1.promiseImpl=="function")return new G1.promiseImpl(function(C,w){try{A=B(f)(v),C(A)}catch(K){w(K)}});else throw new Error("Please provide a callback function");else{try{A=B(f)(v)}catch(C){return g(C)}g(null,A)}}function Y1(f){return G1.fileLoader(f)}function v0(f,v){var g=Q.shallowCopy(Q.createNullProtoObjWherePossible(),v);if(g.filename=f0(f,g),typeof v.includer==="function"){var A=v.includer(f,g.filename);if(A){if(A.filename)g.filename=A.filename;if(A.template)return B(g,A.template)}}return B(g)}function Z1(f,v,g,A,C){var w=v.split(`
`),K=Math.max(A-3,0),Y=Math.min(w.length,A+3),$=C(g),V=w.slice(K,Y).map(function(z,J){var Z=J+K+1;return(Z==A?" >> ":"    ")+Z+"| "+z}).join(`
`);throw f.path=$,f.message=($||"ejs")+":"+A+`
`+V+`

`+f.message,f}function $1(f){return f.replace(/;(\s*$)/,"$1")}G1.compile=function f(v,g){var A;if(g&&g.scope){if(!w1)console.warn("`scope` option is deprecated and will be removed in EJS 3"),w1=!0;if(!g.context)g.context=g.scope;delete g.scope}return A=new X(v,g),A.compile()};G1.render=function(f,v,g){var A=v||Q.createNullProtoObjWherePossible(),C=g||Q.createNullProtoObjWherePossible();if(arguments.length==2)Q.shallowCopyFromList(C,A,V1);return B(C,f)(A)};G1.renderFile=function(){var f=Array.prototype.slice.call(arguments),v=f.shift(),g,A={filename:v},C,w;if(typeof arguments[arguments.length-1]=="function")g=f.pop();if(f.length){if(C=f.shift(),f.length)Q.shallowCopy(A,f.pop());else{if(C.settings){if(C.settings.views)A.views=C.settings.views;if(C.settings["view cache"])A.cache=!0;if(w=C.settings["view options"],w)Q.shallowCopy(A,w)}Q.shallowCopyFromList(A,C,t1)}A.filename=v}else C=Q.createNullProtoObjWherePossible();return g0(A,C,g)};G1.Template=X;G1.clearCache=function(){G1.cache.reset()};function X(f,v){var g=Q.hasOwnOnlyObject(v),A=Q.createNullProtoObjWherePossible();if(this.templateText=f,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",A.client=g.client||!1,A.escapeFunction=g.escape||g.escapeFunction||Q.escapeXML,A.compileDebug=g.compileDebug!==!1,A.debug=!!g.debug,A.filename=g.filename,A.openDelimiter=g.openDelimiter||G1.openDelimiter||e1,A.closeDelimiter=g.closeDelimiter||G1.closeDelimiter||s1,A.delimiter=g.delimiter||G1.delimiter||a1,A.strict=g.strict||!1,A.context=g.context,A.cache=g.cache||!1,A.rmWhitespace=g.rmWhitespace,A.root=g.root,A.includer=g.includer,A.outputFunctionName=g.outputFunctionName,A.localsName=g.localsName||G1.localsName||J1,A.views=g.views,A.async=g.async,A.destructuredLocals=g.destructuredLocals,A.legacyInclude=typeof g.legacyInclude!="undefined"?!!g.legacyInclude:!0,A.strict)A._with=!1;else A._with=typeof g._with!="undefined"?g._with:!0;this.opts=A,this.regex=this.createRegex()}X.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};X.prototype={createRegex:function(){var f=o1,v=Q.escapeRegExpChars(this.opts.delimiter),g=Q.escapeRegExpChars(this.opts.openDelimiter),A=Q.escapeRegExpChars(this.opts.closeDelimiter);return f=f.replace(/%/g,v).replace(/</g,g).replace(/>/g,A),new RegExp(f)},compile:function(){var f,v,g=this.opts,A="",C="",w=g.escapeFunction,K,Y=g.filename?JSON.stringify(g.filename):"undefined";if(!this.source){if(this.generateSource(),A+=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
`,g.outputFunctionName){if(!E.test(g.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");A+="  var "+g.outputFunctionName+` = __append;
`}if(g.localsName&&!E.test(g.localsName))throw new Error("localsName is not a valid JS identifier.");if(g.destructuredLocals&&g.destructuredLocals.length){var $="  var __locals = ("+g.localsName+` || {}),
`;for(var V=0;V<g.destructuredLocals.length;V++){var z=g.destructuredLocals[V];if(!E.test(z))throw new Error("destructuredLocals["+V+"] is not a valid JS identifier.");if(V>0)$+=`,
  `;$+=z+" = __locals."+z}A+=$+`;
`}if(g._with!==!1)A+="  with ("+g.localsName+` || {}) {
`,C+=`  }
`;C+=`  return __output;
`,this.source=A+this.source+C}if(g.compileDebug)f=`var __line = 1
  , __lines = `+JSON.stringify(this.templateText)+`
  , __filename = `+Y+`;
try {
`+this.source+`} catch (e) {
  rethrow(e, __lines, __filename, __line, escapeFn);
}
`;else f=this.source;if(g.client){if(f="escapeFn = escapeFn || "+w.toString()+`;
`+f,g.compileDebug)f="rethrow = rethrow || "+Z1.toString()+`;
`+f}if(g.strict)f=`"use strict";
`+f;if(g.debug)console.log(f);if(g.compileDebug&&g.filename)f=f+`
//# sourceURL=`+Y+`
`;try{if(g.async)try{K=new Function("return (async function(){}).constructor;")()}catch(b){if(b instanceof SyntaxError)throw new Error("This environment does not support async/await");else throw b}else K=Function;v=new K(g.localsName+", escapeFn, include, rethrow",f)}catch(b){if(b instanceof SyntaxError){if(g.filename)b.message+=" in "+g.filename;if(b.message+=` while compiling ejs

`,b.message+=`If the above error is not helpful, you may want to try EJS-Lint:
`,b.message+="https://github.com/RyanZim/EJS-Lint",!g.async)b.message+=`
`,b.message+="Or, if you meant to create an async function, pass `async: true` as an option."}throw b}var J=g.client?v:function b(M){var R=function(H1,k){var L=Q.shallowCopy(Q.createNullProtoObjWherePossible(),M);if(k)L=Q.shallowCopy(L,k);return v0(H1,g)(L)};return v.apply(g.context,[M||Q.createNullProtoObjWherePossible(),w,R,Z1])};if(g.filename&&typeof Object.defineProperty==="function"){var Z=g.filename,G=U.basename(Z,U.extname(Z));try{Object.defineProperty(J,"name",{value:G,writable:!1,enumerable:!1,configurable:!0})}catch(b){}}return J},generateSource:function(){var f=this.opts;if(f.rmWhitespace)this.templateText=this.templateText.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"");this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var v=this,g=this.parseTemplateText(),A=this.opts.delimiter,C=this.opts.openDelimiter,w=this.opts.closeDelimiter;if(g&&g.length)g.forEach(function(K,Y){var $;if(K.indexOf(C+A)===0&&K.indexOf(C+A+A)!==0){if($=g[Y+2],!($==A+w||$=="-"+A+w||$=="_"+A+w))throw new Error('Could not find matching close tag for "'+K+'".')}v.scanLine(K)})},parseTemplateText:function(){var f=this.templateText,v=this.regex,g=v.exec(f),A=[],C;while(g){if(C=g.index,C!==0)A.push(f.substring(0,C)),f=f.slice(C);A.push(g[0]),f=f.slice(g[0].length),g=v.exec(f)}if(f)A.push(f);return A},_addOutput:function(f){if(this.truncate)f=f.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1;if(!f)return f;f=f.replace(/\\/g,"\\\\"),f=f.replace(/\n/g,"\\n"),f=f.replace(/\r/g,"\\r"),f=f.replace(/"/g,"\\\""),this.source+='    ; __append("'+f+`")
`},scanLine:function(f){var v=this,g=this.opts.delimiter,A=this.opts.openDelimiter,C=this.opts.closeDelimiter,w=0;switch(w=f.split(`
`).length-1,f){case A+g:case A+g+"_":this.mode=X.modes.EVAL;break;case A+g+"=":this.mode=X.modes.ESCAPED;break;case A+g+"-":this.mode=X.modes.RAW;break;case A+g+"#":this.mode=X.modes.COMMENT;break;case A+g+g:this.mode=X.modes.LITERAL,this.source+='    ; __append("'+f.replace(A+g+g,A+g)+`")
`;break;case g+g+C:this.mode=X.modes.LITERAL,this.source+='    ; __append("'+f.replace(g+g+C,g+C)+`")
`;break;case g+C:case"-"+g+C:case"_"+g+C:if(this.mode==X.modes.LITERAL)this._addOutput(f);this.mode=null,this.truncate=f.indexOf("-")===0||f.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case X.modes.EVAL:case X.modes.ESCAPED:case X.modes.RAW:if(f.lastIndexOf("//")>f.lastIndexOf(`
`))f+=`
`}switch(this.mode){case X.modes.EVAL:this.source+="    ; "+f+`
`;break;case X.modes.ESCAPED:this.source+="    ; __append(escapeFn("+$1(f)+`))
`;break;case X.modes.RAW:this.source+="    ; __append("+$1(f)+`)
`;break;case X.modes.COMMENT:break;case X.modes.LITERAL:this._addOutput(f);break}}else this._addOutput(f)}if(v.opts.compileDebug&&w)this.currentLine+=w,this.source+="    ; __line = "+this.currentLine+`
`}};G1.escapeXML=Q.escapeXML;G1.__express=G1.renderFile;G1.VERSION=i1;G1.name=p1;if(typeof window!="undefined")window.ejs=G1});function q(f){switch(f.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var _=null;async function W1(){if(!_){let f=await Promise.resolve().then(() => L1(j1(),1));_=f.default||f}return _}class J0{req;server;pathname;routePattern;headers=new Headers;parsedQuery=null;parsedParams=null;parsedCookies=null;parsedBody=null;contextData={};urlObject=null;constructor(f,v,g,A=""){this.req=f,this.server=v,this.pathname=g,this.routePattern=A}setHeader(f,v){return this.headers.set(f,v),this}removeHeader(f){return this.headers.delete(f),this}set(f,v){return this.contextData[f]=v,this}get(f){return this.contextData[f]}get ip(){return this.server.requestIP(this.req)?.address??null}get url(){if(!this.urlObject)this.urlObject=new URL(this.req.url);return this.urlObject}get query(){if(!this.parsedQuery)this.parsedQuery=this.url.search?Object.fromEntries(this.url.searchParams):{};return this.parsedQuery}get params(){if(!this.parsedParams&&this.routePattern)try{this.parsedParams=B1(this.routePattern,this.pathname)}catch(f){let v=f instanceof Error?f.message:String(f);throw new Error(`Failed to extract route parameters: ${v}`)}return this.parsedParams??{}}get body(){if(this.req.method==="GET")return Promise.resolve({});if(!this.parsedBody)this.parsedBody=(async()=>{try{let f=await M1(this.req);if(f.error)throw new Error(f.error);return Object.keys(f).length===0?null:f}catch(f){throw new Error("Invalid request body format")}})();return this.parsedBody}text(f,v=200){return new Response(f,{status:v,headers:this.headers})}send(f,v=200){let g;if(f instanceof Uint8Array)g="Uint8Array";else if(f instanceof ArrayBuffer)g="ArrayBuffer";else g=typeof f;let A=g==="object"&&f!==null?JSON.stringify(f):f;return new Response(A,{status:v,headers:this.headers})}json(f,v=200){return Response.json(f,{status:v,headers:this.headers})}file(f,v,g=200){let A=Bun.file(f);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",v??q(f));return new Response(A,{status:g,headers:this.headers})}async ejs(f,v={},g=200){let A=await W1();try{let C=await Bun.file(f).text(),w=A.render(C,v),K=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(w,{status:g,headers:K})}catch(C){return console.error("EJS Rendering Error:",C),new Response("Error rendering template",{status:500})}}redirect(f,v=302){return this.headers.set("Location",f),new Response(null,{status:v,headers:this.headers})}setCookie(f,v,g={}){let A=`${encodeURIComponent(f)}=${encodeURIComponent(v)}`;if(g.maxAge)A+=`; Max-Age=${g.maxAge}`;if(g.expires)A+=`; Expires=${g.expires.toUTCString()}`;if(g.path)A+=`; Path=${g.path}`;if(g.domain)A+=`; Domain=${g.domain}`;if(g.secure)A+="; Secure";if(g.httpOnly)A+="; HttpOnly";if(g.sameSite)A+=`; SameSite=${g.sameSite}`;return this.headers.append("Set-Cookie",A),this}get cookies(){if(!this.parsedCookies){let f=this.req.headers.get("cookie");this.parsedCookies=f?U1(f):{}}return this.parsedCookies}stream(f){let v=new Headers(this.headers),g=new ReadableStream({async start(A){await f(A),A.close()}});return new Response(g,{headers:v})}yieldStream(f){return new Response}}function V0(f,v,g,A){let C=null,w=null,K=null,Y=null,$={},V=null;return{req:f,server:v,pathname:g,headers:new Headers,setHeader(z,J){return this.headers.set(z,J),this},removeHeader(z){return this.headers.delete(z),this},set(z,J){return $[z]=J,this},get(z){return $[z]},get ip(){return this.server.requestIP(f)?.address??null},get url(){if(!V)V=new URL(f.url);return V},get query(){if(!C){if(!this.url.search)return{};C=Object.fromEntries(this.url.searchParams)}return C},get params(){if(!w&&A)try{w=B1(A,g)}catch(z){let J=z instanceof Error?z.message:String(z);throw new Error(`Failed to extract route parameters: ${J}`)}return w??{}},get body(){if(f.method==="GET")return Promise.resolve({});if(!Y)Y=(async()=>{try{let z=await M1(f);if(z.error)throw new Error(z.error);return Object.keys(z).length===0?null:z}catch(z){throw new Error("Invalid request body format")}})();return Y},text(z,J=200){return new Response(z,{status:J,headers:this.headers})},send(z,J=200){let Z;if(z instanceof Uint8Array)Z="Uint8Array";else if(z instanceof ArrayBuffer)Z="ArrayBuffer";else Z=typeof z;let G=Z==="object"&&z!==null?JSON.stringify(z):z;return new Response(G,{status:J,headers:this.headers})},json(z,J=200){return Response.json(z,{status:J,headers:this.headers})},file(z,J,Z=200){let G=Bun.file(z);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",J??q(z));return new Response(G,{status:Z,headers:this.headers})},async ejs(z,J={},Z=200){let G=await W1();try{let b=await Bun.file(z).text(),M=G.render(b,J),R=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(M,{status:Z,headers:R})}catch(b){return console.error("EJS Rendering Error:",b),new Response("Error rendering template",{status:500})}},redirect(z,J=302){return this.headers.set("Location",z),new Response(null,{status:J,headers:this.headers})},stream(z){let J=new Headers(this.headers),Z=new ReadableStream({async start(G){await z(G),G.close()}});return new Response(Z,{headers:J})},yieldStream(z){return new Response("not working stream yet.")},setCookie(z,J,Z={}){let G=`${encodeURIComponent(z)}=${encodeURIComponent(J)}`;if(Z.maxAge)G+=`; Max-Age=${Z.maxAge}`;if(Z.expires)G+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)G+=`; Path=${Z.path}`;if(Z.domain)G+=`; Domain=${Z.domain}`;if(Z.secure)G+="; Secure";if(Z.httpOnly)G+="; HttpOnly";if(Z.sameSite)G+=`; SameSite=${Z.sameSite}`;return this.headers.append("Set-Cookie",G),this},get cookies(){if(!K){let z=this.req.headers.get("cookie");K=z?U1(z):{}}return K}}}function U1(f){return Object.fromEntries(f.split(";").map((v)=>{let[g,...A]=v.trim().split("=");return[g,decodeURIComponent(A.join("="))]}))}function B1(f,v){let g={},A=f.split("/"),[C]=v.split("?"),w=C.split("/");if(A.length!==w.length)return null;for(let K=0;K<A.length;K++){let Y=A[K];if(Y.charCodeAt(0)===58)g[Y.slice(1)]=w[K]}return g}async function M1(f){let v=f.headers.get("Content-Type")||"";if(!v)return{};if(f.headers.get("Content-Length")==="0"||!f.body)return{};if(v.startsWith("application/json"))return await f.json();if(v.startsWith("application/x-www-form-urlencoded")){let A=await f.text();return Object.fromEntries(new URLSearchParams(A))}if(v.startsWith("multipart/form-data")){let A=await f.formData(),C={};for(let[w,K]of A.entries())C[w]=K;return C}return{error:"Unknown request body type"}}export{B1 as extractDynamicParams,V0 as default,J0 as Context};
